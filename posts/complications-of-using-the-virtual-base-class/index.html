<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Complications of Using the Virtual Base Class | Vishal Chovatiya</title>
<meta name=keywords content="complications-of-virtual-base-class,double-pointer-hack,downcasting,pointer-equivalence"><meta name=description content="In the previous article about How Does Virtual Base Class Works Internally? we have seen address resolution of virtual base class & why it&rsquo;s needed. But I have not discussed Complications of Using the Virtual Base Class. Which we will see in this article. This is going to be a bit complex & clumsy then learning the internal working of the virtual base class. But if you are not tired, then read forward."><meta name=author content="Vishal Chovatiya"><link rel=canonical href=https://vishalchovatiya.github.io/posts/complications-of-using-the-virtual-base-class/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=icon type=image/png sizes=16x16 href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=icon type=image/png sizes=32x32 href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=apple-touch-icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=mask-icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://vishalchovatiya.github.io/posts/complications-of-using-the-virtual-base-class/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Complications of Using the Virtual Base Class"><meta property="og:description" content="In the previous article about How Does Virtual Base Class Works Internally? we have seen address resolution of virtual base class & why it&rsquo;s needed. But I have not discussed Complications of Using the Virtual Base Class. Which we will see in this article. This is going to be a bit complex & clumsy then learning the internal working of the virtual base class. But if you are not tired, then read forward."><meta property="og:type" content="article"><meta property="og:url" content="https://vishalchovatiya.github.io/posts/complications-of-using-the-virtual-base-class/"><meta property="og:image" content="https://vishalchovatiya.github.io/images/memory-layout-of-C-objects.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-12T00:00:00+00:00"><meta property="article:modified_time" content="2019-09-12T00:00:00+00:00"><meta property="og:site_name" content="Vishal Chovatiya"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://vishalchovatiya.github.io/images/memory-layout-of-C-objects.png"><meta name=twitter:title content="Complications of Using the Virtual Base Class"><meta name=twitter:description content="In the previous article about How Does Virtual Base Class Works Internally? we have seen address resolution of virtual base class & why it&rsquo;s needed. But I have not discussed Complications of Using the Virtual Base Class. Which we will see in this article. This is going to be a bit complex & clumsy then learning the internal working of the virtual base class. But if you are not tired, then read forward."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://vishalchovatiya.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Complications of Using the Virtual Base Class","item":"https://vishalchovatiya.github.io/posts/complications-of-using-the-virtual-base-class/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Complications of Using the Virtual Base Class","name":"Complications of Using the Virtual Base Class","description":"In the previous article about How Does Virtual Base Class Works Internally? we have seen address resolution of virtual base class \u0026amp; why it\u0026rsquo;s needed. But I have not discussed Complications of Using the Virtual Base Class. Which we will see in this article. This is going to be a bit complex \u0026amp; clumsy then learning the internal working of the virtual base class. But if you are not tired, then read forward.","keywords":["complications-of-virtual-base-class","double-pointer-hack","downcasting","pointer-equivalence"],"articleBody":"In the previous article about How Does Virtual Base Class Works Internally? we have seen address resolution of virtual base class \u0026 why it’s needed. But I have not discussed Complications of Using the Virtual Base Class. Which we will see in this article. This is going to be a bit complex \u0026 clumsy then learning the internal working of the virtual base class. But if you are not tired, then read forward.\nI am re-posting the previous example here to refresh some memory:\n1 2 3 4 class Top { public: int t; }; class Left : virtual public Top { public: int l; }; class Right : virtual public Top { public: int r; }; class Bottom : public Left, public Right { public: int b; }; Class diagram 1 2 3 4 5 Top / \\ Left Right \\ / Bottom Complications of Downcasting While Using the Virtual Base Class As we have seen, casting of the object Bottom to Right(in other words, upcasting) requires adding offset to a pointer. One might be tempted to think that downcasting can then simply be implemented by subtracting the same offset. This process is not easy for the compiler as it seems. To understand this, let us go through an example. 1 2 3 4 5 6 class AnotherBottom : public Left, public Right { public: int ab1; int ab2; }; Bottom \u0026 AnotherBottom have the same inheritance hierarchy except for their own data members. Now consider the following code. 1 2 3 4 5 Bottom* bottom1 = new Bottom(); AnotherBottom* bottom2 = new AnotherBottom(); Top* top1 = bottom1; Top* top2 = bottom2; Left* left = static_cast\u003cLeft*\u003e(top1); Following is memory layout for Bottom \u0026 AnotherBottom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 | | | | |------------------------|\u003c---- Bottom |------------------------|\u003c---- AnotherBottom | Left::l | | Left::l | |------------------------| |------------------------| | Left::_vptr_Left | | Left::_vptr_Left | |------------------------| |------------------------| | Right::r | | Right::r | |------------------------| |------------------------| | Right::_vptr_Right | | Right::_vptr_Right | |------------------------| |------------------------| | Bottom::b | | AnotherBottom::ab1 | top1--\u003e|------------------------| |------------------------| | Top::t | | AnotherBottom::ab2 | |------------------------| top2-----\u003e|------------------------| | | | Top::t | |------------------------| | | Now consider how to implement the static_cast from top1 to left, while taking into account that we do not know whether top1 is pointing to an object of type Bottom or an object of type AnotherBottom. It can’t be done! The necessary offset depends on the runtime type of top1 (20 for Bottom and 24 for AnotherBottom). The compiler will complain: 1 error: cannot convert from a pointer to base class 'Top' to a pointer to derived class 'Left' because the base is virtual Since we need runtime information, we need to use a dynamic_cast instead: 1 Left* left = dynamic_cast\u003cLeft*\u003e(top1); However, the compiler is still unhappy: 1 error: cannot dynamic_cast 'top1' (of type 'class Top*')to type 'class Left*' (source type is not polymorphic) The problem is that a dynamic_cast (as well as the use of typeid) needs runtime type information about the object pointed to by top1. The compiler did not include that because it did not think that was necessary. To force the compiler to include that, we can add a virtual destructor to Top: 1 2 3 4 5 6 class Top { public: virtual ~Top() {} // This line creates magic for us int t; }; Thus, for a downcasting object having virtual base class we need to have at least one virtual function in the virtual base class. Double Pointer Hack For below code: 1 2 Bottom* b = new Bottom(); Right* r = b; We already know that the value of b gets adjusted by 8 bytes before it is assigned to r so that it points to the Right section of the Bottom object). Thus, we can legally assign a Bottom* to a Right*. What about Bottom** and Right**? 1 2 Bottom** bb = \u0026b; Right** rr = bb; Should the compiler accept this? A quick test will show that the compiler will complain: 1 error: invalid conversion from `Bottom**' to `Right**' Why? Suppose the compiler would accept the assignment of bb to rr. We can visualise the result as: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 |----------| --------\u003e |---------| | | | bb | | b | ------\u003e |------------------------|\u003c---- Bottom |----------| /----\u003e |---------| | Left::l | / |------------------------| / | Left::_vptr_Left | |----------| / |---------| ------\u003e |------------------------| | rr | | r | | Right::r | |----------| |---------| |------------------------| | Right::_vptr_Right | |------------------------| | Bottom::b | |------------------------| | Top::t | |------------------------| | | So, bb and rr both point to b, and b and r point to the appropriate sections of the Bottom object. Now consider what happens when we assign to *rr (note that the type of *rr is Right*, so this assignment is valid): 1 *rr = b; This is essentially the same assignment as the assignment to r above. Thus, the compiler will implement it the same way! In particular, it will adjust the value of b by 8 bytes before it assigns it to *rr. But *rr pointed to b! If we visualise the result again: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 |----------| --------\u003e |-----------| | | | bb | | b | |------------------------|\u003c---- Bottom |----------| /----\u003e |-----------|\\ | Left::l | / \\ |------------------------| / \\ | Left::_vptr_Left | |----------| / |-----------|---\\-----\u003e |------------------------| | rr | | r | | Right::r | |----------| |-----------| |------------------------| | Right::_vptr_Right | |------------------------| | Bottom::b | |------------------------| | Top::t | |------------------------| | | This is correct as long as we access the Bottom object through *rr, but as soon as we access it through b itself, all memory references will be off by 8 bytes — obviously a very undesirable situation. So, in summary, even if *a and *b are related by some subtyping relation, **a and **b are not. Constructors of Virtual Bases The compiler must guarantees that the constructor for all virtual bases of a class gets invoked, and get invoked only once. If you don’t explicitly call the constructors of your virtual base class (independent of how far up the tree they are), the compiler will automatically insert a call to their default constructors. This can lead to some unexpected results. Consider the same class hierarchy again we have been considering so far, extended with constructors: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 class Top { public: Top() { a = -1; } Top(int _a) { a = _a; } int a; }; class Left : virtual public Top { public: Left() { b = -2; } Left(int _a, int _b) : Top(_a) { b = _b; } int b; }; class Right : virtual public Top { public: Right() { c = -3; } Right(int _a, int _c) : Top(_a) { c = _c; } int c; }; class Bottom : public Left, public Right { public: Bottom() { d = -4; } Bottom(int _a, int _b, int _c, int _d) : Left(_a, _b), Right(_a, _c) { d = _d; } int d; }; What would you expect this to output: 1 2 Bottom bottom(1,2,3,4); printf(\"%d %d %d %d %d\\n\", bottom.Left::a, bottom.Right::a, bottom.b, bottom.c, bottom.d); You would probably get 1 -1 -1 2 3 4 I know you were expecting different. But if you trace the execution of the constructors, you will find 1 2 3 4 Top::Top() Left::Left(1,2) Right::Right(1,3) Bottom::Bottom(1,2,3,4) As explained above, the compiler has inserted a call to the default constructor in Bottom, before the execution of the other constructors. Then when Left tries to call its base class constructor(Top), we find that Top has already been initialised and the constructor does not get invoked. To avoid this situation, you should explicitly call the constructor of your virtual base(s): 1 2 3 4 Bottom(int _a, int _b, int _c, int _d): Top(_a), Left(_a,_b), Right(_a,_c) { d = _d; } Pointer Equivalence\nOnce again assuming the same (virtual) class hierarchy, would you expect this to print “Equal”? 1 2 3 4 5 Bottom* b = new Bottom(); Right* r = b; if(r == b) printf(\"Equal!\\n\"); Bear in mind that the two addresses are not actually equal (r is off by 8 bytes). However, that should be completely transparent to the user; so, the compiler actually subtracts the 8 bytes from r before comparing it to b; thus, the two addresses are considered equal. Although, this also stands true for the following code. 1 2 3 4 5 6 7 8 9 class base1{}; class base2{}; class derived : public base1, public base2{}; derived *d = new derived(); base2 *b2 = d; if(b2 == d) printf(\"Equal!\\n\"); Reference http://www.avabodh.com/cxxin/virtualbase.html https://stackoverflow.com/questions/21558/in-c-what-is-a-virtual-base-class https://web.archive.org/web/20160413064252/http://www.phpcompiler.org/articles/virtualinheritance.html Book: Inside C++ Object Model By Lippman ","wordCount":"1500","inLanguage":"en","image":"https://vishalchovatiya.github.io/images/memory-layout-of-C-objects.png","datePublished":"2019-09-12T00:00:00Z","dateModified":"2019-09-12T00:00:00Z","author":{"@type":"Person","name":"Vishal Chovatiya"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vishalchovatiya.github.io/posts/complications-of-using-the-virtual-base-class/"},"publisher":{"@type":"Organization","name":"Vishal Chovatiya","logo":{"@type":"ImageObject","url":"https://vishalchovatiya.github.io/images/trident_favicon.webp"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://vishalchovatiya.github.io/ accesskey=h title="Vishal Chovatiya (Alt + H)"><img src=https://vishalchovatiya.github.io/apple-touch-icon.png alt aria-label=logo height=35>Vishal Chovatiya</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://vishalchovatiya.github.io/pages/vishal-chovatiya title="About Me"><span>About Me</span></a></li><li><a href=https://vishalchovatiya.github.io/pages/start-here title="Start Here"><span>Start Here</span></a></li><li><a href=https://vishalchovatiya.github.io/posts/ title=Latest><span>Latest</span></a></li><li><a href=https://vishalchovatiya.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://vishalchovatiya.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://vishalchovatiya.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Complications of Using the Virtual Base Class</h1><div class=post-meta><span title='2019-09-12 00:00:00 +0000 UTC'>September 12, 2019</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1500 words&nbsp;·&nbsp;Vishal Chovatiya&nbsp;|&nbsp;<a href=https://github.com/vishalchovatiya/blog/blob/main/vishalchovatiya/content/posts/complications-of-using-the-virtual-base-class.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://vishalchovatiya.github.io/images/memory-layout-of-C-objects.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#complications-of-downcasting-while-using-the-virtual-base-class>Complications of Downcasting While Using the Virtual Base Class</a></li><li><a href=#double-pointer-hack><strong>Double Pointer Hack</strong></a></li><li><a href=#constructors-of-virtual-bases><strong>Constructors of Virtual Bases</strong></a></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><p>In the previous article about <a href=/posts/part-2-all-about-virtual-keyword-in-cpp-how-virtual-class-works-internally/>How Does Virtual Base Class Works Internally?</a> we have seen address resolution of virtual base class & why it&rsquo;s needed. But I have not discussed Complications of Using the Virtual Base Class. Which we will see in this article. This is going to be a bit complex & clumsy then learning the internal working of the virtual base class. But if you are not tired, then read forward.</p><p>I am re-posting the previous example here to refresh some memory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Top</span> <span class=p>{</span> <span class=k>public</span><span class=o>:</span> <span class=kt>int</span> <span class=n>t</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Left</span> <span class=o>:</span> <span class=k>virtual</span> <span class=k>public</span> <span class=n>Top</span> <span class=p>{</span> <span class=k>public</span><span class=o>:</span> <span class=kt>int</span> <span class=n>l</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Right</span> <span class=o>:</span> <span class=k>virtual</span> <span class=k>public</span> <span class=n>Top</span> <span class=p>{</span> <span class=k>public</span><span class=o>:</span> <span class=kt>int</span> <span class=n>r</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bottom</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Left</span><span class=p>,</span> <span class=k>public</span> <span class=n>Right</span> <span class=p>{</span> <span class=k>public</span><span class=o>:</span> <span class=kt>int</span> <span class=n>b</span><span class=p>;</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Class diagram</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    Top
</span></span><span class=line><span class=cl>   /   <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>Left   Right
</span></span><span class=line><span class=cl>   <span class=se>\ </span>  /
</span></span><span class=line><span class=cl>   Bottom
</span></span></code></pre></td></tr></table></div></div><h2 id=complications-of-downcasting-while-using-the-virtual-base-class>Complications of Downcasting While Using the Virtual Base Class<a hidden class=anchor aria-hidden=true href=#complications-of-downcasting-while-using-the-virtual-base-class>#</a></h2><ul><li>As we have seen, <a href=/posts/cpp-type-casting-with-example-for-c-developers/>casting</a> of the object <code>Bottom</code> to <code>Right</code>(in other words, upcasting) requires adding offset to a pointer. One might be tempted to think that downcasting can then simply be implemented by subtracting the same offset.</li><li>This process is not easy for the compiler as it seems. To understand this, let us go through an example.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>AnotherBottom</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Left</span><span class=p>,</span> <span class=k>public</span> <span class=n>Right</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>ab1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>ab2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>Bottom</code> & <code>AnotherBottom</code> have the same inheritance hierarchy except for their own data members. Now consider the following code.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Bottom</span><span class=o>*</span> <span class=n>bottom1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bottom</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>AnotherBottom</span><span class=o>*</span> <span class=n>bottom2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AnotherBottom</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Top</span><span class=o>*</span> <span class=n>top1</span> <span class=o>=</span> <span class=n>bottom1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Top</span><span class=o>*</span> <span class=n>top2</span> <span class=o>=</span> <span class=n>bottom2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Left</span><span class=o>*</span> <span class=n>left</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>Left</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>top1</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Following is memory layout for <code>Bottom</code> & <code>AnotherBottom</code></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>       |                        |                 |                        |
</span></span><span class=line><span class=cl>       |------------------------|&lt;---- Bottom     |------------------------|&lt;---- AnotherBottom
</span></span><span class=line><span class=cl>       |    Left::l             |                 |    Left::l             |
</span></span><span class=line><span class=cl>       |------------------------|                 |------------------------|
</span></span><span class=line><span class=cl>       |    Left::_vptr_Left    |                 |    Left::_vptr_Left    |
</span></span><span class=line><span class=cl>       |------------------------|                 |------------------------|
</span></span><span class=line><span class=cl>       |    Right::r            |                 |    Right::r            |
</span></span><span class=line><span class=cl>       |------------------------|                 |------------------------|
</span></span><span class=line><span class=cl>       |    Right::_vptr_Right  |                 |    Right::_vptr_Right  |
</span></span><span class=line><span class=cl>       |------------------------|                 |------------------------|
</span></span><span class=line><span class=cl>       |    Bottom::b           |                 |    AnotherBottom::ab1  |
</span></span><span class=line><span class=cl>top1--&gt;|------------------------|                 |------------------------|
</span></span><span class=line><span class=cl>       |    Top::t              |                 |    AnotherBottom::ab2  |
</span></span><span class=line><span class=cl>       |------------------------|       top2-----&gt;|------------------------|  
</span></span><span class=line><span class=cl>       |                        |                 |    Top::t              |
</span></span><span class=line><span class=cl>                                                  |------------------------|
</span></span><span class=line><span class=cl>                                                  |                        |
</span></span></code></pre></td></tr></table></div></div><ul><li>Now consider how to implement the <code>static_cast</code> from <code>top1</code> to <code>left</code>, while taking into account that we do not know whether <code>top1</code> is pointing to an object of type <code>Bottom</code> or an object of type <code>AnotherBottom</code>. It can&rsquo;t be done! The necessary offset depends on the runtime type of <code>top1</code> (20 for <code>Bottom</code> and 24 for <code>AnotherBottom</code>). The compiler will complain:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=nl>error</span><span class=p>:</span> <span class=n>cannot</span> <span class=n>convert</span> <span class=n>from</span> <span class=n>a</span> <span class=n>pointer</span> <span class=n>to</span> <span class=n>base</span> <span class=k>class</span> <span class=err>&#39;</span><span class=nc>Top</span><span class=err>&#39;</span> <span class=n>to</span> <span class=n>a</span> <span class=n>pointer</span> <span class=n>to</span> <span class=n>derived</span> <span class=k>class</span> <span class=err>&#39;</span><span class=nc>Left</span><span class=err>&#39;</span> <span class=n>because</span> <span class=n>the</span> <span class=n>base</span> <span class=n>is</span> <span class=k>virtual</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Since we need runtime information, we need to use a <a href=/posts/cpp-type-casting-with-example-for-c-developers/>dynamic_cast</a> instead:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Left</span><span class=o>*</span> <span class=n>left</span> <span class=o>=</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Left</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>top1</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>However, the compiler is still unhappy:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=nl>error</span><span class=p>:</span> <span class=n>cannot</span> <span class=k>dynamic_cast</span> <span class=err>&#39;</span><span class=n>top1</span><span class=err>&#39;</span> <span class=p>(</span><span class=n>of</span> <span class=n>type</span> <span class=err>&#39;</span><span class=k>class</span> <span class=nc>Top</span><span class=o>*</span><span class=err>&#39;</span><span class=p>)</span><span class=n>to</span> <span class=n>type</span> <span class=err>&#39;</span><span class=k>class</span> <span class=nc>Left</span><span class=o>*</span><span class=err>&#39;</span> <span class=p>(</span><span class=n>source</span> <span class=n>type</span> <span class=n>is</span> <span class=n>not</span> <span class=n>polymorphic</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>The problem is that a dynamic_cast (as well as the use of <code>typeid</code>) needs <a href=https://en.wikipedia.org/wiki/Run-time_type_information>runtime type information</a> about the object pointed to by <code>top1</code>. The compiler did not include that because it did not think that was necessary. To force the compiler to include that, we can add a virtual destructor to <code>Top</code>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Top</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=k>virtual</span> <span class=o>~</span><span class=n>Top</span><span class=p>()</span> <span class=p>{}</span> <span class=c1>// This line creates magic for us
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>int</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Thus, for a downcasting object having virtual base class we need to have at least one <a href=/posts/part-1-all-about-virtual-keyword-in-cpp-how-virtual-function-works-internally/>virtual function</a> in the virtual base class.</li></ul><h2 id=double-pointer-hack><strong>Double Pointer Hack</strong><a hidden class=anchor aria-hidden=true href=#double-pointer-hack>#</a></h2><ul><li>For below code:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Bottom</span><span class=o>*</span> <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bottom</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Right</span><span class=o>*</span> <span class=n>r</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>We already know that the value of <code>b</code> gets adjusted by 8 bytes before it is assigned to <code>r</code> so that it points to the <code>Right</code> section of the <code>Bottom</code> object). Thus, we can legally assign a <code>Bottom*</code> to a <code>Right*</code>. What about <code>Bottom**</code> and <code>Right**</code>?</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Bottom</span><span class=o>**</span> <span class=n>bb</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Right</span><span class=o>**</span> <span class=n>rr</span> <span class=o>=</span> <span class=n>bb</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Should the compiler accept this? A quick test will show that the compiler will complain:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=nl>error</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>conversion</span> <span class=n>from</span> <span class=err>`</span><span class=n>Bottom</span><span class=o>**</span><span class=err>&#39;</span> <span class=n>to</span> <span class=err>`</span><span class=n>Right</span><span class=o>**</span><span class=err>&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Why? Suppose the compiler would accept the assignment of <code>bb</code> to <code>rr</code>. We can visualise the result as:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  |----------| --------&gt; |---------|         |                        | 
</span></span><span class=line><span class=cl>  |    bb    |           |    b    | ------&gt; |------------------------|&lt;---- Bottom
</span></span><span class=line><span class=cl>  |----------|    /----&gt; |---------|         |    Left::l             |            
</span></span><span class=line><span class=cl>                 /                           |------------------------|            
</span></span><span class=line><span class=cl>                /                            |    Left::_vptr_Left    |            
</span></span><span class=line><span class=cl>  |----------| /         |---------| ------&gt; |------------------------|            
</span></span><span class=line><span class=cl>  |    rr    |           |    r    |         |    Right::r            |            
</span></span><span class=line><span class=cl>  |----------|           |---------|         |------------------------|            
</span></span><span class=line><span class=cl>                                             |    Right::_vptr_Right  |            
</span></span><span class=line><span class=cl>                                             |------------------------|            
</span></span><span class=line><span class=cl>                                             |    Bottom::b           |            
</span></span><span class=line><span class=cl>                                             |------------------------|            
</span></span><span class=line><span class=cl>                                             |    Top::t              |            
</span></span><span class=line><span class=cl>                                             |------------------------|           
</span></span><span class=line><span class=cl>                                             |                        |        
</span></span></code></pre></td></tr></table></div></div><ul><li>So, <code>bb</code> and <code>rr</code> both point to <code>b</code>, and <code>b</code> and <code>r</code> point to the appropriate sections of the <code>Bottom</code> object. Now consider what happens when we assign to <code>*rr</code> (note that the type of <code>*rr</code> is <code>Right*</code>, so this assignment is valid):</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>*</span><span class=n>rr</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>    
</span></span></code></pre></td></tr></table></div></div><ul><li>This is essentially the same assignment as the assignment to <code>r</code> above. Thus, the compiler will implement it the same way! In particular, it will adjust the value of <code>b</code> by 8 bytes before it assigns it to <code>*rr</code>. But <code>*rr</code> pointed to <code>b</code>! If we visualise the result again:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  |----------| --------&gt; |-----------|           |                        | 
</span></span><span class=line><span class=cl>  |    bb    |           |     b     |           |------------------------|&lt;---- Bottom 
</span></span><span class=line><span class=cl>  |----------|    /----&gt; |-----------|\          |    Left::l             |              
</span></span><span class=line><span class=cl>                 /                     \         |------------------------|              
</span></span><span class=line><span class=cl>                /                       \        |    Left::_vptr_Left    |              
</span></span><span class=line><span class=cl>  |----------| /         |-----------|---\-----&gt; |------------------------|              
</span></span><span class=line><span class=cl>  |    rr    |           |     r     |           |    Right::r            |              
</span></span><span class=line><span class=cl>  |----------|           |-----------|           |------------------------|              
</span></span><span class=line><span class=cl>                                                 |    Right::_vptr_Right  |              
</span></span><span class=line><span class=cl>                                                 |------------------------|              
</span></span><span class=line><span class=cl>                                                 |    Bottom::b           |              
</span></span><span class=line><span class=cl>                                                 |------------------------|              
</span></span><span class=line><span class=cl>                                                 |    Top::t              |              
</span></span><span class=line><span class=cl>                                                 |------------------------|           
</span></span><span class=line><span class=cl>                                                 |                        |  
</span></span></code></pre></td></tr></table></div></div><ul><li>This is correct as long as we access the <code>Bottom</code> object through <code>*rr</code>, but as soon as we access it through <code>b</code> itself, all memory references will be off by 8 bytes — obviously a very undesirable situation.</li><li>So, in summary, even if <code>*a</code> and <code>*b</code> are related by some subtyping relation, <code>**a</code> and <code>**b</code> are not.</li></ul><h2 id=constructors-of-virtual-bases><strong>Constructors of Virtual Bases</strong><a hidden class=anchor aria-hidden=true href=#constructors-of-virtual-bases>#</a></h2><ul><li>The compiler must guarantees that the constructor for all virtual bases of a class gets invoked, and get invoked <strong>only once</strong>. If you don&rsquo;t explicitly call the constructors of your virtual base class (independent of how far up the tree they are), the compiler will automatically insert a call to their default constructors.</li><li>This can lead to some unexpected results. Consider the same class hierarchy again we have been considering so far, extended with constructors:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Top</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>Top</span><span class=p>()</span> <span class=p>{</span> <span class=n>a</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=p>}</span> 
</span></span><span class=line><span class=cl>   <span class=n>Top</span><span class=p>(</span><span class=kt>int</span> <span class=n>_a</span><span class=p>)</span> <span class=p>{</span> <span class=n>a</span> <span class=o>=</span> <span class=n>_a</span><span class=p>;</span> <span class=p>}</span> 
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Left</span> <span class=o>:</span> <span class=k>virtual</span> <span class=k>public</span> <span class=n>Top</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>Left</span><span class=p>()</span> <span class=p>{</span> <span class=n>b</span> <span class=o>=</span> <span class=o>-</span><span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=n>Left</span><span class=p>(</span><span class=kt>int</span> <span class=n>_a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_b</span><span class=p>)</span> <span class=o>:</span> <span class=n>Top</span><span class=p>(</span><span class=n>_a</span><span class=p>)</span> <span class=p>{</span> <span class=n>b</span> <span class=o>=</span> <span class=n>_b</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Right</span> <span class=o>:</span> <span class=k>virtual</span> <span class=k>public</span> <span class=n>Top</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>Right</span><span class=p>()</span> <span class=p>{</span> <span class=n>c</span> <span class=o>=</span> <span class=o>-</span><span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=n>Right</span><span class=p>(</span><span class=kt>int</span> <span class=n>_a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_c</span><span class=p>)</span> <span class=o>:</span> <span class=n>Top</span><span class=p>(</span><span class=n>_a</span><span class=p>)</span> <span class=p>{</span> <span class=n>c</span> <span class=o>=</span> <span class=n>_c</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bottom</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Left</span><span class=p>,</span> <span class=k>public</span> <span class=n>Right</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>Bottom</span><span class=p>()</span> <span class=p>{</span> <span class=n>d</span> <span class=o>=</span> <span class=o>-</span><span class=mi>4</span><span class=p>;</span> <span class=p>}</span> 
</span></span><span class=line><span class=cl>   <span class=n>Bottom</span><span class=p>(</span><span class=kt>int</span> <span class=n>_a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_b</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_c</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_d</span><span class=p>)</span> <span class=o>:</span> <span class=n>Left</span><span class=p>(</span><span class=n>_a</span><span class=p>,</span> <span class=n>_b</span><span class=p>),</span> <span class=n>Right</span><span class=p>(</span><span class=n>_a</span><span class=p>,</span> <span class=n>_c</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=n>d</span> <span class=o>=</span> <span class=n>_d</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>What would you expect this to output:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Bottom</span> <span class=nf>bottom</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d %d %d %d %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>bottom</span><span class=p>.</span><span class=n>Left</span><span class=o>::</span><span class=n>a</span><span class=p>,</span> <span class=n>bottom</span><span class=p>.</span><span class=n>Right</span><span class=o>::</span><span class=n>a</span><span class=p>,</span> <span class=n>bottom</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>bottom</span><span class=p>.</span><span class=n>c</span><span class=p>,</span> <span class=n>bottom</span><span class=p>.</span><span class=n>d</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>You would probably get</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span> <span class=o>-</span><span class=mi>1</span> <span class=mi>2</span> <span class=mi>3</span> <span class=mi>4</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>I know you were expecting different. But if you trace the execution of the constructors, you will find</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Top</span><span class=o>::</span><span class=n>Top</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Left</span><span class=o>::</span><span class=n>Left</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Right</span><span class=o>::</span><span class=n>Right</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Bottom</span><span class=o>::</span><span class=n>Bottom</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>As explained above, the compiler has inserted a call to the default constructor in <code>Bottom</code>, before the execution of the other constructors. Then when Left tries to call its base class constructor(<code>Top</code>), we find that <code>Top</code> has already been initialised and the constructor does not get invoked.</li><li>To avoid this situation, you should explicitly call the constructor of your virtual base(s):</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Bottom</span><span class=p>(</span><span class=kt>int</span> <span class=n>_a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_b</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_c</span><span class=p>,</span> <span class=kt>int</span> <span class=n>_d</span><span class=p>)</span><span class=o>:</span> <span class=n>Top</span><span class=p>(</span><span class=n>_a</span><span class=p>),</span> <span class=n>Left</span><span class=p>(</span><span class=n>_a</span><span class=p>,</span><span class=n>_b</span><span class=p>),</span> <span class=n>Right</span><span class=p>(</span><span class=n>_a</span><span class=p>,</span><span class=n>_c</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>   <span class=n>d</span> <span class=o>=</span> <span class=n>_d</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Pointer Equivalence</strong></p><ul><li>Once again assuming the same (virtual) class hierarchy, would you expect this to print “Equal”?</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Bottom</span><span class=o>*</span> <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bottom</span><span class=p>();</span> 
</span></span><span class=line><span class=cl><span class=n>Right</span><span class=o>*</span> <span class=n>r</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Equal!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Bear in mind that the two addresses are not actually equal (<code>r</code> is off by 8 bytes). However, that should be completely transparent to the user; so, the compiler actually subtracts the 8 bytes from <code>r</code> before comparing it to <code>b</code>; thus, the two addresses are considered equal.</li><li>Although, this also stands true for the following code.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8>8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>base1</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>base2</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>derived</span> <span class=o>:</span> <span class=k>public</span> <span class=n>base1</span><span class=p>,</span> <span class=k>public</span> <span class=n>base2</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>derived</span> <span class=o>*</span><span class=n>d</span> <span class=o>=</span> <span class=k>new</span> <span class=n>derived</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>base2</span> <span class=o>*</span><span class=n>b2</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>b2</span> <span class=o>==</span> <span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Equal!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul><li><a href=http://www.avabodh.com/cxxin/virtualbase.html>http://www.avabodh.com/cxxin/virtualbase.html</a></li><li><a href=https://stackoverflow.com/questions/21558/in-c-what-is-a-virtual-base-class>https://stackoverflow.com/questions/21558/in-c-what-is-a-virtual-base-class</a></li><li><a href=https://web.archive.org/web/20160413064252/http://www.phpcompiler.org/articles/virtualinheritance.html>https://web.archive.org/web/20160413064252/http://www.phpcompiler.org/articles/virtualinheritance.html</a></li><li>Book: Inside C++ Object Model By Lippman</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://vishalchovatiya.github.io/tags/complications-of-virtual-base-class/>Complications-of-Virtual-Base-Class</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-pointer-hack/>Double-Pointer-Hack</a></li><li><a href=https://vishalchovatiya.github.io/tags/downcasting/>Downcasting</a></li><li><a href=https://vishalchovatiya.github.io/tags/pointer-equivalence/>Pointer-Equivalence</a></li></ul><nav class=paginav><a class=prev href=https://vishalchovatiya.github.io/posts/cpp-type-casting-with-example-for-c-developers/><span class=title>« Prev</span><br><span>C++ Type Casting With Example for C Developers</span>
</a><a class=next href=https://vishalchovatiya.github.io/posts/part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/><span class=title>Next »</span><br><span>Part 3: All About Virtual Keyword in C++: How Does Virtual Destructor Works?</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on x" href="https://x.com/intent/tweet/?text=Complications%20of%20Using%20the%20Virtual%20Base%20Class&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f&amp;hashtags=complications-of-virtual-base-class%2cdouble-pointer-hack%2cdowncasting%2cpointer-equivalence"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f&amp;title=Complications%20of%20Using%20the%20Virtual%20Base%20Class&amp;summary=Complications%20of%20Using%20the%20Virtual%20Base%20Class&amp;source=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f&title=Complications%20of%20Using%20the%20Virtual%20Base%20Class"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on whatsapp" href="https://api.whatsapp.com/send?text=Complications%20of%20Using%20the%20Virtual%20Base%20Class%20-%20https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on telegram" href="https://telegram.me/share/url?text=Complications%20of%20Using%20the%20Virtual%20Base%20Class&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Complications of Using the Virtual Base Class on ycombinator" href="https://news.ycombinator.com/submitlink?t=Complications%20of%20Using%20the%20Virtual%20Base%20Class&u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fcomplications-of-using-the-virtual-base-class%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://vishalchovatiya.github.io/>Vishal Chovatiya</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>