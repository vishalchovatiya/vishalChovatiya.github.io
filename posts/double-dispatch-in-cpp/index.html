<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer | Vishal Chovatiya</title>
<meta name=keywords content="base-class-pointer-to-derived-class-object-c,base-class-reference-derived-class-object-c,benefits-of-double-dispatch-mechanism,c-double-dispatch-polymorphism,double-dispatch-c,double-dispatch-c-definition,double-dispatch-c-example,double-dispatch-c-stack-overflow,double-dispatch-in-c,double-dispatch-in-modern-c-using-stdvariant-stdvisit,double-dispatch-pattern-c,double-dispatch-polymorphism-c,double-dispatch-visitor-pattern-c,dual-dispatch-in-c,exploiting-polymorphism-instead-of-double-dispatch,how-does-double-dispatch-mechanism-work,more-functional-modular-approach-to-double-dispatch,motivation-for-double-dispatch,problems-with-the-single-dispatch-approach,recover-original-type-of-the-object-pointed-by-base-class-pointer,run-time-type-identification-double-dispatch,single-dispatch,usecase-of-double-dispatch-mechanism,visitor-pattern-c,what-is-double-dispatch-in-c"><meta name=description content="Double Dispatch in C++ is a mechanism that dispatches a function call to different concrete functions depending on the runtime types of two objects involved in the call. In more simple words, its function calling using two different virtual tables of respective two objects. I know this sounds cryptic, but don&rsquo;t worry I will come to double dispatch solution after trying most of the naive solution so that you will come away with the full understanding of concept without having needless confusions."><meta name=author content="Vishal Chovatiya"><link rel=canonical href=https://vishalchovatiya.github.io/posts/double-dispatch-in-cpp/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=icon type=image/png sizes=16x16 href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=icon type=image/png sizes=32x32 href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=apple-touch-icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=mask-icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://vishalchovatiya.github.io/posts/double-dispatch-in-cpp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer"><meta property="og:description" content="Double Dispatch in C++ is a mechanism that dispatches a function call to different concrete functions depending on the runtime types of two objects involved in the call. In more simple words, its function calling using two different virtual tables of respective two objects. I know this sounds cryptic, but don&rsquo;t worry I will come to double dispatch solution after trying most of the naive solution so that you will come away with the full understanding of concept without having needless confusions."><meta property="og:type" content="article"><meta property="og:url" content="https://vishalchovatiya.github.io/posts/double-dispatch-in-cpp/"><meta property="og:image" content="https://vishalchovatiya.github.io/images/double-dispatch-in-C-visitor-design-pattern-www_vishalchovatiya_com.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-11T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-11T00:00:00+00:00"><meta property="og:site_name" content="Vishal Chovatiya"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://vishalchovatiya.github.io/images/double-dispatch-in-C-visitor-design-pattern-www_vishalchovatiya_com.png"><meta name=twitter:title content="Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer"><meta name=twitter:description content="Double Dispatch in C++ is a mechanism that dispatches a function call to different concrete functions depending on the runtime types of two objects involved in the call. In more simple words, its function calling using two different virtual tables of respective two objects. I know this sounds cryptic, but don&rsquo;t worry I will come to double dispatch solution after trying most of the naive solution so that you will come away with the full understanding of concept without having needless confusions."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://vishalchovatiya.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer","item":"https://vishalchovatiya.github.io/posts/double-dispatch-in-cpp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer","name":"Double Dispatch in C\u002b\u002b: Recover Original Type of the Object Pointed by Base Class Pointer","description":"Double Dispatch in C++ is a mechanism that dispatches a function call to different concrete functions depending on the runtime types of two objects involved in the call. In more simple words, its function calling using two different virtual tables of respective two objects. I know this sounds cryptic, but don\u0026rsquo;t worry I will come to double dispatch solution after trying most of the naive solution so that you will come away with the full understanding of concept without having needless confusions.","keywords":["base-class-pointer-to-derived-class-object-c","base-class-reference-derived-class-object-c","benefits-of-double-dispatch-mechanism","c-double-dispatch-polymorphism","double-dispatch-c","double-dispatch-c-definition","double-dispatch-c-example","double-dispatch-c-stack-overflow","double-dispatch-in-c","double-dispatch-in-modern-c-using-stdvariant-stdvisit","double-dispatch-pattern-c","double-dispatch-polymorphism-c","double-dispatch-visitor-pattern-c","dual-dispatch-in-c","exploiting-polymorphism-instead-of-double-dispatch","how-does-double-dispatch-mechanism-work","more-functional-modular-approach-to-double-dispatch","motivation-for-double-dispatch","problems-with-the-single-dispatch-approach","recover-original-type-of-the-object-pointed-by-base-class-pointer","run-time-type-identification-double-dispatch","single-dispatch","usecase-of-double-dispatch-mechanism","visitor-pattern-c","what-is-double-dispatch-in-c"],"articleBody":"Double Dispatch in C++ is a mechanism that dispatches a function call to different concrete functions depending on the runtime types of two objects involved in the call. In more simple words, its function calling using two different virtual tables of respective two objects. I know this sounds cryptic, but don’t worry I will come to double dispatch solution after trying most of the naive solution so that you will come away with the full understanding of concept without having needless confusions.\nMotivation At first, a pointer to a base class made sense; you didn’t need to know the actual derived class. So you decided to expose a single collection of base class pointers to your clients like so: 1 2 3 4 5 struct Animal { virtual const char *name() = 0; }; using AnimalList = vector\u003cAnimal*\u003e; As you added your first few classes, your assumptions were validated; you never needed to know the actual type. 1 2 3 4 5 6 7 struct Cat : Animal { const char *name() { return \"Cat\"; } }; struct Dog : Animal { const char *name() { return \"Dog\"; } }; But the requirements change. One day the client came to you and said “I’m trying to model a person that is afraid of dogs, so they run away when they see one. But they love cats, so they try to pet them when they see them.” Dammit. Now your assumptions are wrong. You do need to know the type. And you’re under pressure to meet a deadline. Run-Time Type Identification Then you thought “Well there’s only two types of animals, this isn’t so bad”. So you wrote code like this: 1 2 3 4 5 6 7 8 9 10 11 struct Person { void ReactTo(Animal *_animal) { if (dynamic_cast\u003cDog *\u003e(_animal)) RunAwayFrom(_animal); else if (dynamic_cast\u003cCat *\u003e(_animal)) TryToPet(_animal); } void RunAwayFrom(Animal *_animal) { cout \u003c\u003c \"Run Away From \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } void TryToPet(Animal *_animal) { cout \u003c\u003c \"Try To Pet \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } }; Then the client said that if the Animal was a Horse, they wanted to try to ride it. 1 2 3 4 5 6 7 8 void Person::ReactTo(Animal *_animal) { if (dynamic_cast\u003cDog *\u003e(_animal)) RunAwayFrom(_animal); else if (dynamic_cast\u003cCat *\u003e(_animal)) TryToPet(_animal); else if (dynamic_cast\u003cHorse *\u003e(_animal)) TryToRide(_animal); } You see this is going crazy. At some point in future, you might not like working with your own code. We’ve all been there. Nonetheless, the trend continued for some time until you may found yourself with a mess like this: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 void Person::ReactTo(Animal *_animal) { if (dynamic_cast\u003cDog *\u003e(_animal) || dynamic_cast\u003cGerbil *\u003e(_animal)) { if (dynamic_cast\u003cDog *\u003e(_animal) \u0026\u0026 dynamic_cast\u003cDog\u003e()-\u003eGetBreed() == DogBreed.Daschund) // Daschund's are the exception TryToPet(_animal); else RunAwayFrom(_animal); } else if (dynamic_cast\u003cCat *\u003e(_animal) || dynamic_cast\u003cPig *\u003e(_animal)) TryToPet(_animal); else if (dynamic_cast\u003cHorse *\u003e(_animal)) TryToRide(_animal); else if (dynamic_cast\u003cLizard *\u003e(_animal)) TryToFeed(_animal); else if (dynamic_cast\u003cMole *\u003e(_animal)) Attack(_animal) // etc. } This list is getting pretty long, you thought to yourself one day. All these dynamic_cast\u003c\u003e() seem wrong, and they’re kind of slow as well. So on a side note of refactorization, you come up with a solution which identifies typeid(), this is a bit faster than dynamic_cast\u003c\u003e() but still, it’s not optimum performance. Exploiting Polymorphism As someone from your senior/mentor suggests you to use an enum with polymorphic methods to identify type \u0026 you wrote following code: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 enum class AnimalType { Dog, Cat }; struct Animal { virtual const char *name() = 0; virtual AnimalType type() = 0; }; struct Cat : Animal { const char *name() { return \"Cat\"; } AnimalType type() { return AnimalType::Cat; } }; struct Dog : Animal { const char *name() { return \"Dog\"; } AnimalType type() { return AnimalType::Dog; } }; struct Person { void ReactTo(Animal *_animal) { if (_animal-\u003etype() == AnimalType::Cat) TryToPet(_animal); else if (_animal-\u003etype() == AnimalType::Dog) RunAwayFrom(_animal); } void RunAwayFrom(Animal *_animal) { cout \u003c\u003c \"Run Away From \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } void TryToPet(Animal *_animal) { cout \u003c\u003c \"Try To Pet \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } }; int main() { Person p; Animal *animal_0 = new Dog; p.ReactTo(animal_0); Animal *animal_1 = new Cat; p.ReactTo(animal_1); return 0; } You may get the performance improvement, but still, you will be left with a long list of if/else-if. More Functional \u0026 Modular Approach 1 2 3 4 5 6 7 8 9 10 11 12 13 using PersonMethodPtr = void (Person::*)(Animal *); using ReactionHash = unordered_map\u003cAnimalType, PersonMethodPtr\u003e; void Person::ReactTo(Animal *_animal) { static const ReactionHash reactionFunctions{ {AnimalType::Cat, \u0026TryToPet}, {AnimalType::Dog, \u0026RunAwayFrom}, // etc. }; reactionFunctions[_animal-\u003etype()](_animal); } But here you are indirectly writing your own virtual table(a very bad virtual table) which may not provide any performance gain at all, thanks to the overhead of hashing \u0026 lookup. Moreover, you are paying a little extra in memory to store your lookup table. Single-Dispatch So rather than keeping any identifier for each type or RTTI, we can use a middle man to route function call to appropriate behaviour. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 struct Animal { virtual string name() = 0; virtual void Visit(class ReactVisitor *visitor) = 0; }; struct ReactVisitor { class Person *person = nullptr; }; struct Person { void ReactTo(Animal *_animal) { ReactVisitor visitor{this}; _animal-\u003eVisit(\u0026visitor); } void RunAwayFrom(Animal *_animal) { cout \u003c\u003c \"Run Away From \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } void TryToPet(Animal *_animal) { cout \u003c\u003c \"Try To Pet \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } }; struct Cat : public Animal { string name() { return \"Cat\"; } void Visit(ReactVisitor *visitor) { visitor-\u003eperson-\u003eTryToPet(this); } }; struct Dog : public Animal { string name() { return \"Dog\"; } void Visit(ReactVisitor *visitor) { visitor-\u003eperson-\u003eRunAwayFrom(this); } }; int main() { Person p; vector\u003cAnimal*\u003e animals = {new Dog, new Cat}; for(auto\u0026\u0026 animal : animals) p.ReactTo(animal); return 0; } To keep the middle man to a route function call, we have to add visit(ReactVisitor *) method which accepts middle man i.e. ReactVisitor as a parameter. Then we add appropriate behaviour to each type of Animal i.e. Dog \u0026 Cat. Problems With the Single Dispatch Approach Why should the Dog class dictate how a Person reacts to it? We have leaked implementation details of the Person class and therefore have violated encapsulation. What if the Person class has other behaviours they want to implement? Are we really going to add a new virtual method on the base class for each of them? The solution to the above problem will lead us to use Double-Dispatch Mechanism.\nDouble Dispatch in C++ We can overcome the shortcoming of Single-Dispatch by adding one more layer of indirection(i.e. AnimalVisitor). 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 /* -------------------------------- Added Visitor Classes ------------------------------- */ struct AnimalVisitor { virtual void Visit(struct Cat *) = 0; virtual void Visit(struct Dog *) = 0; }; struct ReactVisitor : AnimalVisitor { ReactVisitor(struct Person *p) : person{p} {} void Visit(struct Cat *c); void Visit(struct Dog *d); struct Person *person = nullptr; }; /* --------------------------------------------------------------------------------------- */ struct Animal { virtual string name() = 0; virtual void Visit(struct AnimalVisitor *visitor) = 0; }; struct Cat : Animal { string name() { return \"Cat\"; } void Visit(AnimalVisitor *visitor) { visitor-\u003eVisit(this); } // 2nd dispatch \u003c\u003c--------- }; struct Dog : Animal { string name() { return \"Dog\"; } void Visit(AnimalVisitor *visitor) { visitor-\u003eVisit(this); } // 2nd dispatch \u003c\u003c--------- }; struct Person { void ReactTo(Animal *_animal) { ReactVisitor visitor{this}; _animal-\u003eVisit(\u0026visitor); // 1st dispatch \u003c\u003c--------- } void RunAwayFrom(Animal *_animal) { cout \u003c\u003c \"Run Away From \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } void TryToPet(Animal *_animal) { cout \u003c\u003c \"Try To Pet \" \u003c\u003c _animal-\u003ename() \u003c\u003c endl; } }; /* -------------------------------- Added Visitor Methods ------------------------------- */ void ReactVisitor::Visit(Cat *c) { // Finally comes here \u003c\u003c------------- person-\u003eTryToPet(c); } void ReactVisitor::Visit(Dog *d) { // Finally comes here \u003c\u003c------------- person-\u003eRunAwayFrom(d); } /* --------------------------------------------------------------------------------------- */ int main() { Person p; for(auto\u0026\u0026 animal : vector\u003cAnimal*\u003e{new Dog, new Cat}) p.ReactTo(animal); return 0; } As you can see above, rather depending directly on ReactVisitor, we have taken AnimalVisitor as one more layer of indirection. And visit(AnimalVisitor *) method in Cat \u0026 Dog class accept AnimalVisitor as a parameter. This gives us two benefits, i). we do not have to write person’s behaviour in Cat \u0026 Dog class, so we are not breaking the rule of encapsulation, and ii). we are clubbing the reaction of Person in a separate class(i.e. ReactVisitor), so we are encouraging the Single Responsibility Principle. How does Double Dispatch Mechanism work? I know so things are getting complex, but it is reasonably complex I would say. Function stack frame \u0026 single image of function calling chain with code snippet will simplify it a lot.\nFrom Person::ReactTo, we call Animal::visit, which will dispatch to the appropriate overridden visit i.e. either Cat::visit or Dog::visit. From the overridden Cat::visit(AnimalVisitor*), we call AnimalVisitor::visit, which will again dispatch to the appropriate overridden i.e. either ReactionVisitor::visit(Cat*) or ReactionVisitor::visit(Dog*)`. Alternate Approach to Double Dispatch in Modern C++ using std::variant \u0026 std::visit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 struct Animal { virtual string name() = 0; }; struct Cat : Animal { string name() { return \"Cat\"; } }; struct Dog : Animal { string name() { return \"Dog\"; } }; struct Person { void RunAwayFrom(Animal *animal) { cout \u003c\u003c \"Run Away From \" \u003c\u003c animal-\u003ename() \u003c\u003c endl; } void TryToPet(Animal *animal) { cout \u003c\u003c \"Try To Pet \" \u003c\u003c animal-\u003ename() \u003c\u003c endl; } }; struct ReactVisitor { void operator()(Cat *c) { person-\u003eTryToPet(c); } void operator()(Dog *d){ person-\u003eRunAwayFrom(d); } Person *person = nullptr; }; using animal_ptr = std::variant\u003cCat*, Dog*\u003e; int main() { Person p; ReactVisitor rv{\u0026p}; for(auto\u0026\u0026 animal : vector\u003canimal_ptr\u003e({new Dog, new Cat})) std::visit(rv, animal); return 0; } So for those of you who are not familiar with the std::variant, you can consider it as a union. And line std::variant, suggest that you can use/assign/access either Cat* or Dog* at a time. And Modern C++ provide us std::visit which accept callable i.e. ReactVisitor in our case having overloaded function operator for each type and std::variant. You also make use of lambda functions rather using functor i.e. ReactVisitor. Benefits of Double Dispatch Mechanism Adhering Single Responsibility Principle meaning separating type-specific logic in the separate entity/class. In our case, ReactVisitor only handles the reaction for different Animal types. Adhering Open-Closed Principle meaning new functionality can be added without touching any class headers once we inserted visit() method for hierarchy, For example, if you want to add sound()method for each different Animal, you can create SoundVisitor \u0026 rest of the edit goes as same ReactVisitor. This will be much useful when you already have done the unit-testing for your entire hierarchy, and now you do not want to touch that \u0026 wants to add new functionality. Performance over dynamic_cast, typeid()and check for enum/string comparison. Usecase of Double Dispatch Mechanism Sorting a mixed set of objects: You can implement filtering with double-dispatch. E.g., “Give me all theCats from a vector”. You can add additional functionality to the whole inheritance hierarchy without modifying it over \u0026 over E.g. if you want to add sound()method for each different Animal, you can create SoundVisitor \u0026 rest of the edit goes as same ReactVisitor. Event handling systems that use both the event type and the type of the receptor object in order to call the correct event handling routine. Adaptive collision algorithms usually require that collisions between different objects be handled in different ways. A typical example is in a game environment where the collision between a spaceship and an asteroid is computed differently from the collision between a spaceship and a space station. Conclusion Each solution has its advantages and issues, and choosing one depends on the exact needs of your project. C++ presents unique challenges in designing such high-level abstractions because it’s comparatively rigid and statically typed. Abstractions in C++ also tend to strive to be as cheap as possible in terms of runtime performance and memory consumption, which adds another dimension of complexity to the problem.\nReference This article becomes by-product while I was writing about classic Visitor Design Pattern because without double dispatch mechanism in C++ classic visitor doesn’t exist. Most of the credit for this article \u0026 images goes to Andy G. The code snippets you see in this article is simplified not sophisticated.\n","wordCount":"2184","inLanguage":"en","image":"https://vishalchovatiya.github.io/images/double-dispatch-in-C-visitor-design-pattern-www_vishalchovatiya_com.png","datePublished":"2020-04-11T00:00:00Z","dateModified":"2020-04-11T00:00:00Z","author":{"@type":"Person","name":"Vishal Chovatiya"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vishalchovatiya.github.io/posts/double-dispatch-in-cpp/"},"publisher":{"@type":"Organization","name":"Vishal Chovatiya","logo":{"@type":"ImageObject","url":"https://vishalchovatiya.github.io/images/trident_favicon.webp"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://vishalchovatiya.github.io/ accesskey=h title="Vishal Chovatiya (Alt + H)"><img src=https://vishalchovatiya.github.io/apple-touch-icon.png alt aria-label=logo height=35>Vishal Chovatiya</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://vishalchovatiya.github.io/pages/vishal-chovatiya title="About Me"><span>About Me</span></a></li><li><a href=https://vishalchovatiya.github.io/pages/start-here title="Start Here"><span>Start Here</span></a></li><li><a href=https://vishalchovatiya.github.io/posts/ title=Latest><span>Latest</span></a></li><li><a href=https://vishalchovatiya.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://vishalchovatiya.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://vishalchovatiya.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer</h1><div class=post-meta><span title='2020-04-11 00:00:00 +0000 UTC'>April 11, 2020</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2184 words&nbsp;·&nbsp;Vishal Chovatiya&nbsp;|&nbsp;<a href=https://github.com/vishalchovatiya/blog/blob/main/vishalchovatiya/content/posts/double-dispatch-in-cpp.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://vishalchovatiya.github.io/images/double-dispatch-in-C-visitor-design-pattern-www_vishalchovatiya_com.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#motivation>Motivation</a></li><li><a href=#run-time-type-identification>Run-Time Type Identification</a></li><li><a href=#exploiting-polymorphism>Exploiting Polymorphism</a></li><li><a href=#more-functional--modular-approach>More Functional & Modular Approach</a></li><li><a href=#single-dispatch>Single-Dispatch</a><ul><li><a href=#problems-with-the-single-dispatch-approach>Problems With the Single Dispatch Approach</a></li></ul></li><li><a href=#double-dispatch-in-c>Double Dispatch in C++</a></li><li><a href=#how-does-double-dispatch-mechanism-work>How does Double Dispatch Mechanism work?</a></li><li><a href=#alternate-approach-to-double-dispatch-in-modern-c-using-stdvariant--stdvisit>Alternate Approach to Double Dispatch in Modern C++ using std::variant & std::visit</a></li><li><a href=#benefits-of-double-dispatch-mechanism>Benefits of Double Dispatch Mechanism</a></li><li><a href=#usecase-of-double-dispatch-mechanism>Usecase of Double Dispatch Mechanism</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><p>Double Dispatch in C++ is a mechanism that dispatches <strong><em>a function call to different concrete functions depending on the runtime types of two objects involved in the call</em></strong>.  In more simple words, its function calling using two different virtual tables of respective two objects. I know this sounds cryptic, but don&rsquo;t worry I will come to double dispatch solution after trying most of the naive solution so that you will come away with the full understanding of concept without having needless confusions.</p><h2 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h2><ul><li>At first, a pointer to a base class made sense; you didn’t need to know the actual derived class. So you decided to expose a single collection of base class pointers to your clients like so:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=nf>name</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>AnimalList</span> <span class=o>=</span> <span class=n>vector</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>*&gt;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>As you added your first few classes, your assumptions were validated; you never needed to know the actual type.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Cat&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Dog&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>But the requirements change.</li><li>One day the client came to you and said &ldquo;I’m trying to model a person that is afraid of dogs, so they run away when they see one. But they love cats, so they try to pet them when they see them.&rdquo;</li><li>Dammit. Now your assumptions are wrong. You do need to know the type. And you’re under pressure to meet a deadline.</li></ul><h2 id=run-time-type-identification>Run-Time Type Identification<a hidden class=anchor aria-hidden=true href=#run-time-type-identification>#</a></h2><ul><li>Then you thought &ldquo;Well there’s only two types of animals, this isn’t so bad&rdquo;. So you wrote code like this:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Dog</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>RunAwayFrom</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Cat</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>TryToPet</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RunAwayFrom</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Run Away From &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>TryToPet</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Try To Pet &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Then the client said that if the <code>Animal</code> was a <code>Horse</code>, they wanted to try to ride it.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6>6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7>7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>Person</span><span class=o>::</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Dog</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>RunAwayFrom</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Cat</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>TryToPet</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Horse</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>TryToRide</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>You see this is going crazy. At some point in future, you might not like working with your own code. We&rsquo;ve all been there. Nonetheless, the trend continued for some time until you may found yourself with a mess like this:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>Person</span><span class=o>::</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Dog</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>)</span> <span class=o>||</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Gerbil</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Dog</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>()</span><span class=o>-&gt;</span><span class=n>GetBreed</span><span class=p>()</span> <span class=o>==</span> <span class=n>DogBreed</span><span class=p>.</span><span class=n>Daschund</span><span class=p>)</span> <span class=c1>// Daschund&#39;s are the exception
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>TryToPet</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=nf>RunAwayFrom</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Cat</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>)</span> <span class=o>||</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Pig</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>TryToPet</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Horse</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>TryToRide</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Lizard</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>TryToFeed</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Mole</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>_animal</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>Attack</span><span class=p>(</span><span class=n>_animal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// etc.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>This list is getting pretty long, you thought to yourself one day. All these <a href=/posts/cpp-type-casting-with-example-for-c-developers/>dynamic_cast&lt;>()</a> seem wrong, and they&rsquo;re kind of slow as well. So on a side note of refactorization, you come up with a solution which identifies <code>typeid()</code>, this is a bit faster than <a href=/posts/cpp-type-casting-with-example-for-c-developers/><code>dynamic_cast&lt;>()</code></a> but still, it&rsquo;s not optimum performance.</li></ul><h2 id=exploiting-polymorphism>Exploiting Polymorphism<a hidden class=anchor aria-hidden=true href=#exploiting-polymorphism>#</a></h2><ul><li>As someone from your senior/mentor suggests you to use an enum with polymorphic methods to identify type & you wrote following code:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>enum</span> <span class=k>class</span> <span class=nc>AnimalType</span> <span class=p>{</span> <span class=n>Dog</span><span class=p>,</span> <span class=n>Cat</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=nf>name</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>AnimalType</span> <span class=nf>type</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Cat&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>AnimalType</span> <span class=nf>type</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>AnimalType</span><span class=o>::</span><span class=n>Cat</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Dog&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>AnimalType</span> <span class=nf>type</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>AnimalType</span><span class=o>::</span><span class=n>Dog</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>_animal</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>()</span> <span class=o>==</span> <span class=n>AnimalType</span><span class=o>::</span><span class=n>Cat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>TryToPet</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>_animal</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>()</span> <span class=o>==</span> <span class=n>AnimalType</span><span class=o>::</span><span class=n>Dog</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>RunAwayFrom</span><span class=p>(</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RunAwayFrom</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Run Away From &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>TryToPet</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Try To Pet &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Person</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Animal</span> <span class=o>*</span><span class=n>animal_0</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Dog</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>animal_0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Animal</span> <span class=o>*</span><span class=n>animal_1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Cat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>animal_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>You may get the performance improvement, but still, you will be left with a long list of <code>if/else-if</code>.</li></ul><h2 id=more-functional--modular-approach>More Functional & Modular Approach<a hidden class=anchor aria-hidden=true href=#more-functional--modular-approach>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>using</span> <span class=n>PersonMethodPtr</span> <span class=o>=</span> <span class=kt>void</span> <span class=p>(</span><span class=n>Person</span><span class=o>::*</span><span class=p>)(</span><span class=n>Animal</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>ReactionHash</span> <span class=o>=</span> <span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>AnimalType</span><span class=p>,</span> <span class=n>PersonMethodPtr</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Person</span><span class=o>::</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>const</span> <span class=n>ReactionHash</span> <span class=n>reactionFunctions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>AnimalType</span><span class=o>::</span><span class=n>Cat</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>TryToPet</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>AnimalType</span><span class=o>::</span><span class=n>Dog</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>RunAwayFrom</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>// etc.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>reactionFunctions</span><span class=p>[</span><span class=n>_animal</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>()](</span><span class=n>_animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>But here you are indirectly writing your own <a href=/posts/part-1-all-about-virtual-keyword-in-cpp-how-virtual-function-works-internally/>virtual table</a>(a very bad virtual table) which may not provide any performance gain at all, thanks to the overhead of hashing & lookup. Moreover, you are paying a little extra in memory to store your lookup table.</li></ul><h2 id=single-dispatch>Single-Dispatch<a hidden class=anchor aria-hidden=true href=#single-dispatch>#</a></h2><ul><li>So rather than keeping any identifier for each type or RTTI, we can use a middle man to route function call to appropriate behaviour.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33>33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34>34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35>35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36>36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37>37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38>38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=k>class</span> <span class=nc>ReactVisitor</span> <span class=o>*</span><span class=n>visitor</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ReactVisitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Person</span> <span class=o>*</span><span class=n>person</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ReactVisitor</span> <span class=n>visitor</span><span class=p>{</span><span class=k>this</span><span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>Visit</span><span class=p>(</span><span class=o>&amp;</span><span class=n>visitor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RunAwayFrom</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Run Away From &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>TryToPet</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Try To Pet &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Cat&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=n>ReactVisitor</span> <span class=o>*</span><span class=n>visitor</span><span class=p>)</span> <span class=p>{</span> <span class=n>visitor</span><span class=o>-&gt;</span><span class=n>person</span><span class=o>-&gt;</span><span class=n>TryToPet</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Dog&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=n>ReactVisitor</span> <span class=o>*</span><span class=n>visitor</span><span class=p>)</span> <span class=p>{</span> <span class=n>visitor</span><span class=o>-&gt;</span><span class=n>person</span><span class=o>-&gt;</span><span class=n>RunAwayFrom</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Person</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>vector</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>*&gt;</span> <span class=n>animals</span> <span class=o>=</span> <span class=p>{</span><span class=k>new</span> <span class=n>Dog</span><span class=p>,</span> <span class=k>new</span> <span class=n>Cat</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=nl>animal</span> <span class=p>:</span> <span class=n>animals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=p>.</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>animal</span><span class=p>);</span>    
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>To keep the middle man to a route function call, we have to add <code>visit(ReactVisitor *)</code> method which accepts middle man i.e. <code>ReactVisitor</code> as a parameter. Then we add appropriate behaviour to each type of <code>Animal</code> i.e. <code>Dog</code> & <code>Cat</code>.</li></ul><h3 id=problems-with-the-single-dispatch-approach>Problems With the Single Dispatch Approach<a hidden class=anchor aria-hidden=true href=#problems-with-the-single-dispatch-approach>#</a></h3><ol><li>Why should the <code>Dog</code> class dictate how a <code>Person</code> reacts to it? We have leaked implementation details of the <code>Person</code> class and therefore have violated encapsulation.</li><li>What if the <code>Person</code> class has other behaviours they want to implement? Are we really going to add a new <a href=/posts/part-1-all-about-virtual-keyword-in-cpp-how-virtual-function-works-internally/>virtual method</a> on the base class for each of them?</li></ol><p>The solution to the above problem will lead us to use Double-Dispatch Mechanism.</p><h2 id=double-dispatch-in-c>Double Dispatch in C++<a hidden class=anchor aria-hidden=true href=#double-dispatch-in-c>#</a></h2><ul><li>We can overcome the shortcoming of Single-Dispatch by adding one more layer of indirection(i.e. <code>AnimalVisitor</code>).</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* -------------------------------- Added Visitor Classes ------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>AnimalVisitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>*</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>*</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ReactVisitor</span> <span class=o>:</span> <span class=n>AnimalVisitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ReactVisitor</span><span class=p>(</span><span class=k>struct</span> <span class=nc>Person</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span> <span class=o>:</span> <span class=n>person</span><span class=p>{</span><span class=n>p</span><span class=p>}</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>*</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>*</span><span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>Person</span> <span class=o>*</span><span class=n>person</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=cm>/* --------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=k>struct</span> <span class=nc>AnimalVisitor</span> <span class=o>*</span><span class=n>visitor</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>      
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Cat&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=n>AnimalVisitor</span> <span class=o>*</span><span class=n>visitor</span><span class=p>)</span> <span class=p>{</span> <span class=n>visitor</span><span class=o>-&gt;</span><span class=n>Visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span> <span class=c1>// 2nd dispatch &lt;&lt;---------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Dog&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Visit</span><span class=p>(</span><span class=n>AnimalVisitor</span> <span class=o>*</span><span class=n>visitor</span><span class=p>)</span> <span class=p>{</span> <span class=n>visitor</span><span class=o>-&gt;</span><span class=n>Visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span> <span class=c1>// 2nd dispatch &lt;&lt;---------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>ReactTo</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ReactVisitor</span> <span class=n>visitor</span><span class=p>{</span><span class=k>this</span><span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>Visit</span><span class=p>(</span><span class=o>&amp;</span><span class=n>visitor</span><span class=p>);</span>   <span class=c1>// 1st dispatch &lt;&lt;---------
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RunAwayFrom</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Run Away From &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>TryToPet</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>_animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Try To Pet &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* -------------------------------- Added Visitor Methods ------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>ReactVisitor</span><span class=o>::</span><span class=n>Visit</span><span class=p>(</span><span class=n>Cat</span> <span class=o>*</span><span class=n>c</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// Finally comes here &lt;&lt;-------------
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>person</span><span class=o>-&gt;</span><span class=n>TryToPet</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>ReactVisitor</span><span class=o>::</span><span class=n>Visit</span><span class=p>(</span><span class=n>Dog</span> <span class=o>*</span><span class=n>d</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// Finally comes here &lt;&lt;-------------
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>person</span><span class=o>-&gt;</span><span class=n>RunAwayFrom</span><span class=p>(</span><span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* --------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Person</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=nl>animal</span> <span class=p>:</span> <span class=n>vector</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>*&gt;</span><span class=p>{</span><span class=k>new</span> <span class=n>Dog</span><span class=p>,</span> <span class=k>new</span> <span class=n>Cat</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=p>.</span><span class=n>ReactTo</span><span class=p>(</span><span class=n>animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>As you can see above, rather depending directly on <code>ReactVisitor</code>, we have taken <code>AnimalVisitor</code> as one more layer of indirection. And <code>visit(AnimalVisitor *)</code> method in <code>Cat</code> & <code>Dog</code> class accept <code>AnimalVisitor</code> as a parameter.</li><li>This gives us two benefits, i). we do not have to write person&rsquo;s behaviour in <code>Cat</code> & <code>Dog</code> class, so we are not breaking the rule of encapsulation, and ii). we are clubbing the reaction of Person in a separate class(i.e. <code>ReactVisitor</code>), so we are encouraging the <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a>.</li></ul><h2 id=how-does-double-dispatch-mechanism-work>How does Double Dispatch Mechanism work?<a hidden class=anchor aria-hidden=true href=#how-does-double-dispatch-mechanism-work>#</a></h2><p>I know so things are getting complex, but it is reasonably complex I would say. Function stack frame & single image of function calling chain with code snippet will simplify it a lot.</p><p><img loading=lazy src=/images/double-dispatch-cpp-stack-frame-vishal-chovatiya.gif#center alt></p><ul><li>From <code>Person::ReactTo</code>, we call <code>Animal::visit</code>, which will dispatch to the appropriate overridden visit i.e. either <code>Cat::visit</code> or <code>Dog::visit</code>.</li><li>From the overridden <code>Cat::visit(AnimalVisitor*)</code>, we call <code>AnimalVisitor::visit</code>, which will again dispatch to the appropriate overridden i.e. either <code>ReactionVisitor::visit(Cat*) or </code>ReactionVisitor::visit(Dog*)`.</li></ul><h2 id=alternate-approach-to-double-dispatch-in-modern-c-using-stdvariant--stdvisit>Alternate Approach to Double Dispatch in Modern C++ using std::variant & std::visit<a hidden class=anchor aria-hidden=true href=#alternate-approach-to-double-dispatch-in-modern-c-using-stdvariant--stdvisit>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33>33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Cat</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Cat&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Dog</span> <span class=o>:</span> <span class=n>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=nf>name</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&#34;Dog&#34;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RunAwayFrom</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Run Away From &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>TryToPet</span><span class=p>(</span><span class=n>Animal</span> <span class=o>*</span><span class=n>animal</span><span class=p>)</span> <span class=p>{</span> <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Try To Pet &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>animal</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ReactVisitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>operator</span><span class=p>()(</span><span class=n>Cat</span> <span class=o>*</span><span class=n>c</span><span class=p>)</span> <span class=p>{</span> <span class=n>person</span><span class=o>-&gt;</span><span class=n>TryToPet</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>operator</span><span class=p>()(</span><span class=n>Dog</span> <span class=o>*</span><span class=n>d</span><span class=p>){</span> <span class=n>person</span><span class=o>-&gt;</span><span class=n>RunAwayFrom</span><span class=p>(</span><span class=n>d</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>Person</span> <span class=o>*</span><span class=n>person</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>animal_ptr</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>*</span><span class=p>,</span> <span class=n>Dog</span><span class=o>*&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Person</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ReactVisitor</span> <span class=n>rv</span><span class=p>{</span><span class=o>&amp;</span><span class=n>p</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=nl>animal</span> <span class=p>:</span> <span class=n>vector</span><span class=o>&lt;</span><span class=n>animal_ptr</span><span class=o>&gt;</span><span class=p>({</span><span class=k>new</span> <span class=n>Dog</span><span class=p>,</span> <span class=k>new</span> <span class=n>Cat</span><span class=p>}))</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>visit</span><span class=p>(</span><span class=n>rv</span><span class=p>,</span> <span class=n>animal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>So for those of you who are not familiar with the <code>std::variant</code>, you can consider it as a union. And line <code>std::variant&lt;Cat*, Dog*></code>, suggest that you can use/assign/access either <code>Cat*</code> or <code>Dog*</code> at a time.</li><li>And <a href=/posts/21-new-features-of-modern-cpp-to-use-in-your-project/>Modern C++</a> provide us <code>std::visit</code> which accept callable i.e. <code>ReactVisitor</code> in our case having overloaded function operator for each type and <code>std::variant</code>. You also make use of <a href=/posts/learn-lambda-function-in-cpp-with-example/>lambda functions</a> rather using functor i.e. <code>ReactVisitor</code>.</li></ul><h2 id=benefits-of-double-dispatch-mechanism>Benefits of Double Dispatch Mechanism<a hidden class=anchor aria-hidden=true href=#benefits-of-double-dispatch-mechanism>#</a></h2><ol><li>Adhering <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a> meaning separating type-specific logic in the separate entity/class. In our case, <code>ReactVisitor</code> only handles the reaction for different Animal types.</li><li>Adhering <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a> meaning new functionality can be added without touching any class headers once we inserted <code>visit()</code> method for hierarchy, For example, if you want to add <code>sound()</code>method for each different Animal, you can create <code>SoundVisitor</code> & rest of the edit goes as same <code>ReactVisitor</code>.</li><li>This will be much useful when you already have done the unit-testing for your entire hierarchy, and now you do not want to touch that & wants to add new functionality.</li><li>Performance over <code>dynamic_cast</code>, <code>typeid()</code>and check for <code>enum</code>/<code>string</code> comparison.</li></ol><h2 id=usecase-of-double-dispatch-mechanism>Usecase of Double Dispatch Mechanism<a hidden class=anchor aria-hidden=true href=#usecase-of-double-dispatch-mechanism>#</a></h2><ol><li>Sorting a mixed set of objects: You can implement filtering with double-dispatch. E.g., &ldquo;Give me all the<code>Cats</code> from a <code>vector&lt;Animal*></code>&rdquo;.</li><li>You can add additional functionality to the whole inheritance hierarchy without modifying it over & over E.g. if you want to add <code>sound()</code>method for each different Animal, you can create <code>SoundVisitor</code> & rest of the edit goes as same <code>ReactVisitor</code>.</li><li>Event handling systems that use both the event type and the type of the receptor object in order to call the correct event handling routine.</li><li><a href=https://en.wikipedia.org/wiki/Double_dispatch#Double_dispatch_in_C++>Adaptive collision algorithms</a> usually require that collisions between different objects be handled in different ways. A typical example is in a game environment where the collision between a spaceship and an asteroid is computed differently from the collision between a spaceship and a space station.</li></ol><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Each solution has its advantages and issues, and choosing one depends on the exact needs of your project. C++ presents unique challenges in designing such high-level abstractions because it&rsquo;s comparatively rigid and statically typed. Abstractions in C++ also tend to strive to be as cheap as possible in terms of runtime performance and memory consumption, which adds another dimension of complexity to the problem.</p><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><p>This article becomes by-product while I was writing about classic <a href=/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/>Visitor Design Pattern</a> because without double dispatch mechanism in C++ classic visitor doesn&rsquo;t exist. Most of the credit for this article & images goes to <a href=https://gieseanw.wordpress.com/2018/12/29/reuse-double-dispatch/>Andy G</a>. The code snippets you see in this article is simplified not sophisticated.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://vishalchovatiya.github.io/tags/base-class-pointer-to-derived-class-object-c/>Base-Class-Pointer-to-Derived-Class-Object-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/base-class-reference-derived-class-object-c/>Base-Class-Reference-Derived-Class-Object-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/benefits-of-double-dispatch-mechanism/>Benefits-of-Double-Dispatch-Mechanism</a></li><li><a href=https://vishalchovatiya.github.io/tags/c-double-dispatch-polymorphism/>C-Double-Dispatch-Polymorphism</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-c/>Double-Dispatch-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-c-definition/>Double-Dispatch-C-Definition</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-c-example/>Double-Dispatch-C-Example</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-c-stack-overflow/>Double-Dispatch-C-Stack-Overflow</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-in-c/>Double-Dispatch-in-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-in-modern-c-using-stdvariant-stdvisit/>Double-Dispatch-in-Modern-C-Using-Stdvariant-Stdvisit</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-pattern-c/>Double-Dispatch-Pattern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-polymorphism-c/>Double-Dispatch-Polymorphism-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-visitor-pattern-c/>Double-Dispatch-Visitor-Pattern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/dual-dispatch-in-c/>Dual-Dispatch-in-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/exploiting-polymorphism-instead-of-double-dispatch/>Exploiting-Polymorphism-Instead-of-Double-Dispatch</a></li><li><a href=https://vishalchovatiya.github.io/tags/how-does-double-dispatch-mechanism-work/>How-Does-Double-Dispatch-Mechanism-Work</a></li><li><a href=https://vishalchovatiya.github.io/tags/more-functional-modular-approach-to-double-dispatch/>More-Functional-Modular-Approach-to-Double-Dispatch</a></li><li><a href=https://vishalchovatiya.github.io/tags/motivation-for-double-dispatch/>Motivation-for-Double-Dispatch</a></li><li><a href=https://vishalchovatiya.github.io/tags/problems-with-the-single-dispatch-approach/>Problems-With-the-Single-Dispatch-Approach</a></li><li><a href=https://vishalchovatiya.github.io/tags/recover-original-type-of-the-object-pointed-by-base-class-pointer/>Recover-Original-Type-of-the-Object-Pointed-by-Base-Class-Pointer</a></li><li><a href=https://vishalchovatiya.github.io/tags/run-time-type-identification-double-dispatch/>Run-Time-Type-Identification-Double-Dispatch</a></li><li><a href=https://vishalchovatiya.github.io/tags/single-dispatch/>Single-Dispatch</a></li><li><a href=https://vishalchovatiya.github.io/tags/usecase-of-double-dispatch-mechanism/>Usecase-of-Double-Dispatch-Mechanism</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-pattern-c/>Visitor-Pattern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/what-is-double-dispatch-in-c/>What-Is-Double-Dispatch-in-C</a></li></ul><nav class=paginav><a class=prev href=https://vishalchovatiya.github.io/posts/watchdog-timer/><span class=title>« Prev</span><br><span>Watchdog Timer(WDT) & Window Watchdog Timer(WWDT)</span>
</a><a class=next href=https://vishalchovatiya.github.io/posts/liskovs-substitution-principle-in-cpp-solid-as-a-rock/><span class=title>Next »</span><br><span>Liskov's Substitution Principle in C++ | SOLID as a Rock</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on x" href="https://x.com/intent/tweet/?text=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f&amp;hashtags=base-class-pointer-to-derived-class-object-c%2cbase-class-reference-derived-class-object-c%2cbenefits-of-double-dispatch-mechanism%2cc-double-dispatch-polymorphism%2cdouble-dispatch-c%2cdouble-dispatch-c-definition%2cdouble-dispatch-c-example%2cdouble-dispatch-c-stack-overflow%2cdouble-dispatch-in-c%2cdouble-dispatch-in-modern-c-using-stdvariant-stdvisit%2cdouble-dispatch-pattern-c%2cdouble-dispatch-polymorphism-c%2cdouble-dispatch-visitor-pattern-c%2cdual-dispatch-in-c%2cexploiting-polymorphism-instead-of-double-dispatch%2chow-does-double-dispatch-mechanism-work%2cmore-functional-modular-approach-to-double-dispatch%2cmotivation-for-double-dispatch%2cproblems-with-the-single-dispatch-approach%2crecover-original-type-of-the-object-pointed-by-base-class-pointer%2crun-time-type-identification-double-dispatch%2csingle-dispatch%2cusecase-of-double-dispatch-mechanism%2cvisitor-pattern-c%2cwhat-is-double-dispatch-in-c"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f&amp;title=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer&amp;summary=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer&amp;source=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f&title=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on whatsapp" href="https://api.whatsapp.com/send?text=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer%20-%20https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on telegram" href="https://telegram.me/share/url?text=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch in C++: Recover Original Type of the Object Pointed by Base Class Pointer on ycombinator" href="https://news.ycombinator.com/submitlink?t=Double%20Dispatch%20in%20C%2b%2b%3a%20Recover%20Original%20Type%20of%20the%20Object%20Pointed%20by%20Base%20Class%20Pointer&u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-in-cpp%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://vishalchovatiya.github.io/>Vishal Chovatiya</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>