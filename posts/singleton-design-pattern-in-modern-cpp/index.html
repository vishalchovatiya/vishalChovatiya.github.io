<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Singleton Design Pattern in Modern C&#43;&#43; · Vishal Chovatiya
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Vishal Chovatiya">
<meta name="description" content="In software engineering, Creational Design Patterns deal with object creation mechanisms, i.e. try to create objects in a manner suitable to the situation. The basic or ordinary form of object creation could result in design problems or added complexity to the design. In this article of the Creational Design Patterns, we&rsquo;re going to take a look at the much-hated &amp; commonly asked design pattern in a programming interview. That is Singleton Design Pattern in Modern C&#43;&#43; which criticizes for its extensibility &amp; testability.">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Singleton Design Pattern in Modern C&#43;&#43;">
  <meta name="twitter:description" content="In software engineering, Creational Design Patterns deal with object creation mechanisms, i.e. try to create objects in a manner suitable to the situation. The basic or ordinary form of object creation could result in design problems or added complexity to the design. In this article of the Creational Design Patterns, we’re going to take a look at the much-hated &amp; commonly asked design pattern in a programming interview. That is Singleton Design Pattern in Modern C&#43;&#43; which criticizes for its extensibility &amp; testability.">

<meta property="og:url" content="http://localhost:1313/posts/singleton-design-pattern-in-modern-cpp/">
  <meta property="og:site_name" content="Vishal Chovatiya">
  <meta property="og:title" content="Singleton Design Pattern in Modern C&#43;&#43;">
  <meta property="og:description" content="In software engineering, Creational Design Patterns deal with object creation mechanisms, i.e. try to create objects in a manner suitable to the situation. The basic or ordinary form of object creation could result in design problems or added complexity to the design. In this article of the Creational Design Patterns, we’re going to take a look at the much-hated &amp; commonly asked design pattern in a programming interview. That is Singleton Design Pattern in Modern C&#43;&#43; which criticizes for its extensibility &amp; testability.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-04-06T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-04-06T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/singleton-design-pattern-in-modern-cpp/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">








 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>




<body class="preload-transitions colorscheme-light">
  

  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Vishal Chovatiya
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Latest</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/pages/start-here">Start Here</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/cpp/">C/C&#43;&#43;</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/linux-system-programming/">Linux System Programming</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/misc/">Misc</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/singleton-design-pattern-in-modern-cpp/">
              Singleton Design Pattern in Modern C&#43;&#43;
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2020-04-06T00:00:00Z">
                April 6, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              8-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/cpp/">Cpp</a>
      <span class="separator">•</span>
    <a href="/categories/design-patterns/">Design-Patterns</a>
      <span class="separator">•</span>
    <a href="/categories/software-engineering/">Software-Engineering</a></div>

          
        </div>
      </header>

      <div class="post-content">
        
          <img src="/images/Singleton-Design-Pattern-in-Modern-C-vishal-chovatiya.png" alt="Featured image"/>
        
        <p>In software engineering, Creational Design Patterns deal with object creation mechanisms, i.e. try to create objects in a manner suitable to the situation. The basic or ordinary form of object creation could result in design problems or added complexity to the design. In this article of the Creational Design Patterns, we&rsquo;re going to take a look at the much-hated &amp; commonly asked design pattern in a programming interview. That is Singleton Design Pattern in Modern C++ which criticizes for its extensibility &amp; testability. I will also cover the Multiton Design Pattern which quite contrary to Singleton.</p>
<p>By the way, If you haven’t check out my other articles on Creational Design Patterns, then here is the list:</p>
<ol>
<li><a href="/posts//factory-design-pattern-in-modern-cpp/" >Factory</a></li>
<li><a href="/posts//builder-design-pattern-in-modern-cpp/" >Builder</a></li>
<li><a href="/posts//prototype-design-pattern-in-modern-cpp/" >Prototype</a></li>
<li><a href="/posts//singleton-design-pattern-in-modern-cpp/" >Singleton</a></li>
</ol>
<p>The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like <code>override</code>, <code>final</code>, <code>public</code>(while inheritance) just to make code compact &amp; consumable(most of the time) in single standard screen size. I also prefer <code>struct</code> instead of <code>class</code> just to save line by not writing &ldquo;<code>public:</code>&rdquo; sometimes and also miss <a href="/posts//part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/" >virtual destructor</a>, constructor, <a href="/posts//all-about-copy-constructor-in-cpp-with-example/" >copy constructor</a>, prefix <code>std::</code>, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.</p>
<p><strong><em>Note:</em></strong></p>
<ul>
<li>If you stumbled here directly, then I would suggest you go through <a href="/posts//what-is-design-pattern/" >What is design pattern?</a> first, even if it is trivial. I believe it will encourage you to explore more on this topic.</li>
<li>All of this code you encounter in this series of articles are compiled using C++20(though I have used <a href="/posts//21-new-features-of-modern-cpp-to-use-in-your-project/" >Modern C++</a> features up to C++17 in most cases). So if you don&rsquo;t have access to the latest compiler you can use <a href="https://wandbox.org/"  class="external-link" target="_blank" rel="noopener">https://wandbox.org/</a> which has preinstalled boost library as well.</li>
</ul>
<h2 id="intent">
  Intent
  <a class="heading-link" href="#intent">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<blockquote>
<p><strong><em>To ensure one &amp; only one instance of a class exist at any point in time.</em></strong></p>
</blockquote>
<ul>
<li>The Singleton Design Pattern ensures that a class has only one instance and provides a global point of access to that instance. This is useful when exactly one object need to coordinate actions across the system.</li>
<li>So, essentially, the Singleton Design Pattern is nothing more than specifying a lifetime.</li>
</ul>
<h2 id="singleton-design-pattern-c-example">
  Singleton Design Pattern C++ Example
  <a class="heading-link" href="#singleton-design-pattern-c-example">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>The motivation for using a Singleton Design Pattern is fairly obvious. Some components in our system only need to have a single instance. For example, a database that loads up from its constructor into memory &amp; then gives out information about its contents. Once it&rsquo;s loaded up you don&rsquo;t really want more than one instance of it because there is no point.</li>
<li>And you also want to prevent your clients/API-users from making any additional copies of that <a href="/posts/inside-the-cpp-object-model/" >object</a>. Following is a trivial example of the Singleton Design Pattern in C++.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">/* country.txt 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Japan
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">1000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">India
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">2000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">America
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">123500
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SingletonDatabase</span> {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>map<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string, <span style="color:#66d9ef">int32_t</span><span style="color:#f92672">&gt;</span>  m_country;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SingletonDatabase() {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>ifstream ifs(<span style="color:#e6db74">&#34;country.txt&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>string city, population;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (getline(ifs, city)) {
</span></span><span style="display:flex;"><span>            getline(ifs, population);
</span></span><span style="display:flex;"><span>            m_country[city] <span style="color:#f92672">=</span> stoi(population);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    SingletonDatabase(SingletonDatabase <span style="color:#66d9ef">const</span> <span style="color:#f92672">&amp;</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">delete</span>;
</span></span><span style="display:flex;"><span>    SingletonDatabase <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(SingletonDatabase <span style="color:#66d9ef">const</span> <span style="color:#f92672">&amp;</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">delete</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> SingletonDatabase <span style="color:#f92672">&amp;</span>get() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">static</span> SingletonDatabase db;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> db;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int32_t</span> <span style="color:#a6e22e">get_population</span>(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>name) { <span style="color:#66d9ef">return</span> m_country[name]; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    SingletonDatabase<span style="color:#f92672">::</span>get().get_population(<span style="color:#e6db74">&#34;Japan&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>Some of the things to note here from the design perspective are:</p>
<ul>
<li>
<p>Private constructor</p>
</li>
<li>
<p>Deleted <a href="/posts/all-about-copy-constructor-in-cpp-with-example/" >copy constructor</a> &amp; <a href="/posts/2-wrong-way-to-learn-copy-assignment-operator-in-cpp-with-example/" >copy assignment operator</a></p>
</li>
<li>
<p>Static object creation &amp; static method to access</p>
</li>
</ul>
</li>
</ul>
<h2 id="the-problem-of-testability-with-singleton">
  The Problem of Testability With Singleton
  <a class="heading-link" href="#the-problem-of-testability-with-singleton">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>So we have our Singleton database and let&rsquo;s suppose that we decide to use this database to do some research and we actually made a new class called a <code>SingletonRecordFinder</code> which is going to find the total population from the collection of city names provided in the argument as follow.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">SingletonRecordFinder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int32_t</span> <span style="color:#a6e22e">total_population</span>(<span style="color:#66d9ef">const</span> vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;&amp;</span>   countries) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int32_t</span> result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;</span>country : countries)
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">+=</span> SingletonDatabase<span style="color:#f92672">::</span>get().get_population(country);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><ul>
<li>But let&rsquo;s suppose that we decide that we want to test the <code>SingletonRecordFinder</code> and this is where all the problems show up.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> countries<span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Japan&#34;</span>, <span style="color:#e6db74">&#34;India&#34;</span>}; <span style="color:#75715e">// Strongly tied to data base entries
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>TEST(<span style="color:#ae81ff">1000000</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2000000</span>, SingletonRecordFinder<span style="color:#f92672">::</span>total_population(countries));
</span></span></code></pre></div><ul>
<li>Unfortunately, because we are strongly tied to the real database and there is no way to substitute this database. I have to use the values taken from the actual file. And when later on these entries change, your test will start failing as you may have not updated the code. And this going to be a continuous problem.</li>
<li>Moreover, this is not going to be a unit-test rather it is integration test as we are not only testing our code but also a production database which is not good design.</li>
<li>Surely there is a better way of actually implementing this particular construct so that we can still use the singleton but if need we can supply an alternative to the singleton implementation with some dummy data of our own.</li>
</ul>
<h2 id="singleton-design-pattern-with-dependency-injection">
  Singleton Design Pattern With Dependency Injection
  <a class="heading-link" href="#singleton-design-pattern-with-dependency-injection">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>The problem that we&rsquo;re encountering in the testing of the <code>SingletonRecordFinder</code> is to do with the fact that we have a dependency upon essentially the details of how a database provides its data because we&rsquo;re depending directly on the singleton database and the fact that it&rsquo;s a singleton.</li>
<li>So why don&rsquo;t we use a little bit of <a href="https://en.wikipedia.org/wiki/Dependency_injection"  class="external-link" target="_blank" rel="noopener">dependency injection</a> on an interface or abstract class!</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Database</span> { <span style="color:#75715e">// Dependency 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">int32_t</span> <span style="color:#a6e22e">get_population</span>(<span style="color:#66d9ef">const</span> string<span style="color:#f92672">&amp;</span> country) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SingletonDatabase</span> <span style="color:#f92672">:</span> Database {
</span></span><span style="display:flex;"><span>    map<span style="color:#f92672">&lt;</span>string, <span style="color:#66d9ef">int32_t</span><span style="color:#f92672">&gt;</span>    m_countries;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SingletonDatabase() {
</span></span><span style="display:flex;"><span>        ifstream <span style="color:#a6e22e">ifs</span>(<span style="color:#e6db74">&#34;countries.txt&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        string city, population;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (getline(ifs, city)) {
</span></span><span style="display:flex;"><span>            getline(ifs, population);
</span></span><span style="display:flex;"><span>            m_countries[city] <span style="color:#f92672">=</span> stoi(population);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    SingletonDatabase(SingletonDatabase <span style="color:#66d9ef">const</span> <span style="color:#f92672">&amp;</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">delete</span>;
</span></span><span style="display:flex;"><span>    SingletonDatabase <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(SingletonDatabase <span style="color:#66d9ef">const</span> <span style="color:#f92672">&amp;</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">delete</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> SingletonDatabase <span style="color:#f92672">&amp;</span>get() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">static</span> SingletonDatabase db;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> db;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int32_t</span> <span style="color:#a6e22e">get_population</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>country) { <span style="color:#66d9ef">return</span> m_countries[country]; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DummyDatabase</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Database {
</span></span><span style="display:flex;"><span>    map<span style="color:#f92672">&lt;</span>string, <span style="color:#66d9ef">int32_t</span><span style="color:#f92672">&gt;</span>    m_countries;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    DummyDatabase() <span style="color:#f92672">:</span> m_countries{{<span style="color:#e6db74">&#34;alpha&#34;</span>, <span style="color:#ae81ff">1</span>}, {<span style="color:#e6db74">&#34;beta&#34;</span>, <span style="color:#ae81ff">2</span>}, {<span style="color:#e6db74">&#34;gamma&#34;</span>, <span style="color:#ae81ff">3</span>}} {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int32_t</span> <span style="color:#a6e22e">get_population</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>country) { <span style="color:#66d9ef">return</span> m_countries[country]; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Testing class ------------------------------------------------------------ */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConfigurableRecordFinder</span> {
</span></span><span style="display:flex;"><span>    Database<span style="color:#f92672">&amp;</span>       m_db;  <span style="color:#75715e">// Dependency Injection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ConfigurableRecordFinder(Database <span style="color:#f92672">&amp;</span>db) <span style="color:#f92672">:</span> m_db{db} {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int32_t</span> <span style="color:#a6e22e">total_population</span>(<span style="color:#66d9ef">const</span> vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&amp;</span>countries) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int32_t</span> result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;</span>country : countries)
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">+=</span> m_db.get_population(country);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* ------------------------------------------------------------------------- */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    DummyDatabase db;
</span></span><span style="display:flex;"><span>    ConfigurableRecordFinder rf(db);
</span></span><span style="display:flex;"><span>    rf.total_population({<span style="color:#e6db74">&#34;Japan&#34;</span>, <span style="color:#e6db74">&#34;India&#34;</span>, <span style="color:#e6db74">&#34;America&#34;</span>});
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Due to Dependency Injection i.e. <code>Database</code> interface, our both following issues are resolved:
<ol>
<li>We have done a proper unit test rather an integration test,</li>
<li>Now our testing class is not directly tie-up to Singleton. So no need to change our unit-test over &amp; over in accordance with a database change.</li>
</ol>
</li>
</ul>
<h2 id="multiton-design-pattern">
  Multiton Design Pattern
  <a class="heading-link" href="#multiton-design-pattern">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>Multiton is a variation to singleton but not directly linked to it. Remember that singleton prevents you to have additional instances while Multiton Design Pattern sets up kind of key-value pair along with the limitation for the number of instance creation.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Importance</span> { PRIMARY, SECONDARY, TERTIARY };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T, <span style="color:#66d9ef">typename</span> Key <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>string<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Multiton</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> shared_ptr<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> get(<span style="color:#66d9ef">const</span> Key <span style="color:#f92672">&amp;</span>key) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> m_instances.find(key); it <span style="color:#f92672">!=</span> m_instances.end()) { <span style="color:#75715e">// C++17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> it<span style="color:#f92672">-&gt;</span>second; 
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> m_instances[key] <span style="color:#f92672">=</span> make_shared<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> map<span style="color:#f92672">&lt;</span>Key, shared_ptr<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span>  m_instances;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T, <span style="color:#66d9ef">typename</span> Key<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>map<span style="color:#f92672">&lt;</span>Key, shared_ptr<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span>     Multiton<span style="color:#f92672">&lt;</span>T, Key<span style="color:#f92672">&gt;::</span>m_instances; <span style="color:#75715e">// Just initialization of static data member
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Printer</span> {
</span></span><span style="display:flex;"><span>    Printer() { cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Total instances so far = &#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#f92672">++</span>InstCnt <span style="color:#f92672">&lt;&lt;</span> endl; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> InstCnt;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> Printer<span style="color:#f92672">::</span>InstCnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">using</span> mt <span style="color:#f92672">=</span> Multiton<span style="color:#f92672">&lt;</span>Printer, Importance<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> main <span style="color:#f92672">=</span> mt<span style="color:#f92672">::</span>get(Importance<span style="color:#f92672">::</span>PRIMARY);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> aux <span style="color:#f92672">=</span> mt<span style="color:#f92672">::</span>get(Importance<span style="color:#f92672">::</span>SECONDARY);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> aux2 <span style="color:#f92672">=</span> mt<span style="color:#f92672">::</span>get(Importance<span style="color:#f92672">::</span>SECONDARY); <span style="color:#75715e">// Will not create additional instances
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>So as you can see we have three printers i.e. primary, secondary &amp; tertiary whose access &amp; instantiation is controlled by <code>Multiton</code>. Rest of the code is self-explanatory I hope.</li>
</ul>
<h2 id="benefits-of-singleton-design-pattern">
  Benefits of Singleton Design Pattern
  <a class="heading-link" href="#benefits-of-singleton-design-pattern">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ol>
<li>The Singleton Design Pattern is quite helpful for application configurations as configurations may need to be accessible globally, and future expansions to the application configurations can be consolidated at single place.</li>
<li>A second common use of this class is in updating old code to work in a new architecture. Since developers may have used globals liberally, moving them into a single class and making it a singleton, can be an intermediary step to bring the program inline to the stronger object-oriented structure.</li>
<li>Singleton Design Pattern also enhance the maintainability as it provides a single point of access to a particular instance.</li>
</ol>
<h2 id="summary-by-faqs">
  Summary by FAQs
  <a class="heading-link" href="#summary-by-faqs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>What is so bad about the Singleton Design Pattern?</strong></p>
<ul>
<li>Singleton object holds the state for the lifetime of the application. Which is bad for testing since you can end up with a situation where tests need to be ordered which is a big no-no for unit tests. Why? Because each unit test should be independent of the other.</li>
<li>Singleton object causes code to be tightly coupled. This makes guessing the expected result under test scenarios rather difficult as we have seen above in database example. But you can overcome it by using Dependency Injection along with Singleton Design Pattern.</li>
<li>Imagine the situation where you have a concurrent application accessing Singleton object from every part of your application, It just mashes up things or slows it down if you use a mutex or any other synchronization primitives.</li>
</ul>
<p><strong>What is the correct way to implement Singleton Design Pattern?</strong></p>
<p>The right way to implement Singleton is by dependency injection, So instead of directly depending on a singleton, you might want to consider it depending on an abstraction(e.g. an interface). I would also encourage you to use synchronization primitives(like a mutex, semaphores, etc) to control access.</p>
<p><strong>When should you use the Singleton Design Pattern?</strong></p>
<ul>
<li>Usually, Singleton is used in hardware interface usage limitation. For example, Printers are limited in numbers, so in such case, a singleton or multiton design pattern is used to manage access.</li>
<li>Singleton Design Pattern is also widely employed in managing configuration or properties file to manage access.</li>
<li>We can use the cache as a singleton object as it can have a global point of reference and for all future calls to the cache object, the client application will use the in-memory <a href="/posts/memory-layout-of-cpp-object/" >object</a>.</li>
</ul>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Vishal Chovatiya 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
