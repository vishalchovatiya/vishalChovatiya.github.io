<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>State Design Pattern in Modern C++ | Vishal Chovatiya</title>
<meta name=keywords content="benefits-of-state-design-pattern,classical-state-design-pattern,difference-between-switch-case-statement-state-machine-implemented-by-switch-case-syntax,functional-approach-to-state-design-pattern,how-to-use-state-pattern-rapidly-correctly,modular-approach-to-state-design-pattern,state-design-pattern-c,state-design-pattern-examples-in-c,state-design-pattern-in-modern-c,state-machine,state-machine-design-pattern-c-example,state-machine-design-using-stdvisit-stdvariant,state-pattern-c,state-pattern-c-example,state-pattern-cpp,use-cases-of-state-design-pattern"><meta name=description content="A State Design Pattern is a type of Behavioural Design Pattern that defines objects behaviour(defined as a state) based on some event happens. And that can be the internal or external event. For example, if you design an ATM machine using the State Design Pattern, the external event could be someone inserted debit/credit card & internal event could be a user timeout. So in nutshell, the State Design Pattern in Modern C++ is a systematic way to implement certain behaviour on a particular event considering the context."><meta name=author content="Vishal Chovatiya"><link rel=canonical href=https://vishalchovatiya.github.io/posts/state-design-pattern-in-modern-cpp/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=icon type=image/png sizes=16x16 href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=icon type=image/png sizes=32x32 href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=apple-touch-icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><link rel=mask-icon href=https://vishalchovatiya.github.io/images/trident_favicon.webp><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://vishalchovatiya.github.io/posts/state-design-pattern-in-modern-cpp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="State Design Pattern in Modern C++"><meta property="og:description" content="A State Design Pattern is a type of Behavioural Design Pattern that defines objects behaviour(defined as a state) based on some event happens. And that can be the internal or external event. For example, if you design an ATM machine using the State Design Pattern, the external event could be someone inserted debit/credit card & internal event could be a user timeout. So in nutshell, the State Design Pattern in Modern C++ is a systematic way to implement certain behaviour on a particular event considering the context."><meta property="og:type" content="article"><meta property="og:url" content="https://vishalchovatiya.github.io/posts/state-design-pattern-in-modern-cpp/"><meta property="og:image" content="https://vishalchovatiya.github.io/images/State-Design-Pattern-in-Modern-C-vishal-chovatiya.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-02T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-02T00:00:00+00:00"><meta property="og:site_name" content="Vishal Chovatiya"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://vishalchovatiya.github.io/images/State-Design-Pattern-in-Modern-C-vishal-chovatiya.png"><meta name=twitter:title content="State Design Pattern in Modern C++"><meta name=twitter:description content="A State Design Pattern is a type of Behavioural Design Pattern that defines objects behaviour(defined as a state) based on some event happens. And that can be the internal or external event. For example, if you design an ATM machine using the State Design Pattern, the external event could be someone inserted debit/credit card & internal event could be a user timeout. So in nutshell, the State Design Pattern in Modern C++ is a systematic way to implement certain behaviour on a particular event considering the context."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://vishalchovatiya.github.io/posts/"},{"@type":"ListItem","position":2,"name":"State Design Pattern in Modern C++","item":"https://vishalchovatiya.github.io/posts/state-design-pattern-in-modern-cpp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"State Design Pattern in Modern C++","name":"State Design Pattern in Modern C\u002b\u002b","description":"A State Design Pattern is a type of Behavioural Design Pattern that defines objects behaviour(defined as a state) based on some event happens. And that can be the internal or external event. For example, if you design an ATM machine using the State Design Pattern, the external event could be someone inserted debit/credit card \u0026amp; internal event could be a user timeout. So in nutshell, the State Design Pattern in Modern C++ is a systematic way to implement certain behaviour on a particular event considering the context.","keywords":["benefits-of-state-design-pattern","classical-state-design-pattern","difference-between-switch-case-statement-state-machine-implemented-by-switch-case-syntax","functional-approach-to-state-design-pattern","how-to-use-state-pattern-rapidly-correctly","modular-approach-to-state-design-pattern","state-design-pattern-c","state-design-pattern-examples-in-c","state-design-pattern-in-modern-c","state-machine","state-machine-design-pattern-c-example","state-machine-design-using-stdvisit-stdvariant","state-pattern-c","state-pattern-c-example","state-pattern-cpp","use-cases-of-state-design-pattern"],"articleBody":"A State Design Pattern is a type of Behavioural Design Pattern that defines objects behaviour(defined as a state) based on some event happens. And that can be the internal or external event. For example, if you design an ATM machine using the State Design Pattern, the external event could be someone inserted debit/credit card \u0026 internal event could be a user timeout. So in nutshell, the State Design Pattern in Modern C++ is a systematic way to implement certain behaviour on a particular event considering the context.\nBy the way, If you haven’t check out my other articles on Behavioural Design Patterns, then here is the list:\nChain of responsibility Command Interpreter Iterator Mediator Memento Observer State Strategy Template Method Visitor The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like override, final, public(while inheritance) just to make code compact \u0026 consumable(most of the time) in single standard screen size. I also prefer struct instead of class just to save line by not writing “public:” sometimes and also miss virtual destructor, constructor, copy constructor, prefix std::, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.\nNote:\nIf you stumbled here directly, then I would suggest you go through What is design pattern? first, even if it is trivial. I believe it will encourage you to explore more on this topic. All of this code you encounter in this series of articles are compiled using C++20(though I have used Modern C++ features up to C++17 in most cases). So if you don’t have access to the latest compiler you can use https://wandbox.org/ which has preinstalled boost library as well. Intent To implement the object’s behaviour determined by its state.\nA State Design Pattern is to implement the object’s behaviour depending upon its state which also clarifies the transition from one state to another state. A formalized construct which manages states \u0026 transition is called a state machine. The State Design Pattern solves two main problems: An object should change its behaviour when its internal state changes. State-specific behaviour should define independently(i.e. in class). So, adding new states should not affect the behaviour of existing states. State Design Pattern Examples in C++ Consider the above simple diagram to model three different states along with respective triggers for the transition. We will first see the classical approach where we implement state transition using polymorphism \u0026 then move to Modern \u0026 Modular approach which involves std::variant \u0026 std::visit. Classical State Design Pattern 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 /* --------------------------------- Events ------------------------------------------ */ enum event { connect, connected, disconnect, timeout }; inline ostream \u0026operator\u003c\u003c(ostream \u0026os, const event \u0026e) { switch (e) { case event::connect: os \u003c\u003c \"connect\"; break; case event::connected: os \u003c\u003c \"connected\"; break; case event::disconnect: os \u003c\u003c \"disconnect\"; break; case event::timeout: os \u003c\u003c \"timeout\"; break; } return os; } /* ------------------------------------------------------------------------------------- */ struct State { virtual unique_ptr\u003cState\u003e on_event(event e) = 0; }; /* --------------------------------- States ------------------------------------------ */ struct Idle : State { unique_ptr\u003cState\u003e on_event(event e); }; struct Connecting : State { unique_ptr\u003cState\u003e on_event(event e); private: uint32_t m_trial = 0; static constexpr uint8_t m_max_trial = 3; }; struct Connected : State { unique_ptr\u003cState\u003e on_event(event e); }; /* ------------------------------------------------------------------------------------- */ /* ------------------------------- Transitions ---------------------------------------- */ unique_ptr\u003cState\u003e Idle::on_event(event e) { cout \u003c\u003c \"Idle -\u003e \" \u003c\u003c e \u003c\u003c endl; if (e == event::connect) return make_unique\u003cConnecting\u003e(); return nullptr; } unique_ptr\u003cState\u003e Connecting::on_event(event e) { cout \u003c\u003c \"Connecting -\u003e \" \u003c\u003c e \u003c\u003c endl; switch (e) { case event::connected: return make_unique\u003cConnected\u003e(); case event::timeout: return ++m_trial \u003c m_max_trial ? nullptr : make_unique\u003cIdle\u003e(); } return nullptr; } unique_ptr\u003cState\u003e Connected::on_event(event e) { cout \u003c\u003c \"Connected -\u003e \" \u003c\u003c e \u003c\u003c endl; if (e == event::disconnect) return make_unique\u003cIdle\u003e(); return nullptr; } /* ------------------------------------------------------------------------------------- */ struct Bluetooth { unique_ptr\u003cState\u003e m_curr_state = make_unique\u003cIdle\u003e(); void dispatch(event e) { auto new_state = m_curr_state-\u003eon_event(e); if (new_state) m_curr_state = move(new_state); } template \u003ctypename... Events\u003e void establish_connection(Events... e) { (dispatch(e), ...); } }; int main() { Bluetooth bl; bl.establish_connection(event::connect, event::timeout, event::connected, event::disconnect); return EXIT_SUCCESS; } /* Idle -\u003e connect Connecting -\u003e timeout Connecting -\u003e connected Connected -\u003e disconnect */ Two subtle part here to take into the account is How we modelled triggers(i.e. events) \u0026 states, by considering state machine diagram. And how we have fired steps to establish the connection using Variadic Template Method \u0026 Fold expression. Rest of the code is self-explainable though. Functional Approach to State Design Pattern State Design Pattern is bizarre design patterns if you look at the classic definition of it. You will see something very different from how we actually build state machines nowadays so it’s a completely different paradigm. Now we see more Modern \u0026 Functional approach to address this problem. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 /* --------------------------------- Events ------------------------------------------ */ struct EventConnect { string m_address; }; struct EventConnected { }; struct EventDisconnect { }; struct EventTimeout { }; using Event = variant\u003cEventConnect, EventConnected, EventDisconnect, EventTimeout\u003e; /* ------------------------------------------------------------------------------------- */ /* --------------------------------- States ------------------------------------------ */ struct Idle { }; struct Connecting { string m_address; uint32_t m_trial = 0; static constexpr uint8_t m_max_trial = 3; }; struct Connected { }; using State = variant\u003cIdle, Connecting, Connected\u003e; /* ------------------------------------------------------------------------------------- */ /* ------------------------------- Transitions ---------------------------------------- */ struct Transitions { optional\u003cState\u003e operator()(Idle \u0026, const EventConnect \u0026e) { cout \u003c\u003c \"Idle -\u003e Connect\" \u003c\u003c endl; return Connecting{e.m_address}; } optional\u003cState\u003e operator()(Connecting \u0026, const EventConnected \u0026) { cout \u003c\u003c \"Connecting -\u003e Connected\" \u003c\u003c endl; return Connected{}; } optional\u003cState\u003e operator()(Connecting \u0026s, const EventTimeout \u0026) { cout \u003c\u003c \"Connecting -\u003e Timeout\" \u003c\u003c endl; return ++s.m_trial \u003c Connecting::m_max_trial ? nullopt : optional\u003cState\u003e(Idle{}); } optional\u003cState\u003e operator()(Connected \u0026, const EventDisconnect \u0026) { cout \u003c\u003c \"Connected -\u003e Disconnect\" \u003c\u003c endl; return Idle{}; } template \u003ctypename State_t, typename Event_t\u003e optional\u003cState\u003e operator()(State_t \u0026, const Event_t \u0026) const { cout \u003c\u003c \"Unkown\" \u003c\u003c endl; return nullopt; } }; /* ------------------------------------------------------------------------------------- */ template \u003ctypename StateVariant, typename EventVariant, typename Transitions\u003e struct Bluetooth { StateVariant m_curr_state; void dispatch(const EventVariant \u0026Event) { optional\u003cStateVariant\u003e new_state = visit(Transitions{}, m_curr_state, Event); if (new_state) m_curr_state = *move(new_state); } template \u003ctypename... Events\u003e void establish_connection(Events... e) { (dispatch(e), ...); } }; int main() { Bluetooth\u003cState, Event, Transitions\u003e bl; bl.establish_connection(EventConnect{\"AA:BB:CC:DD\"}, EventTimeout{}, EventConnected{}, EventDisconnect{}); return EXIT_SUCCESS; } /* Idle -\u003e Connect Connecting -\u003e Timeout Connecting -\u003e Connected Connected -\u003e Disconnect */ A classical approach is not loosely coupled between events \u0026 states if you compare the above example. The changes in the sequence of events or adding new events will impact the condition part of states implemented in on_event()which violates the Open-Closed Principle. But in the case of Functional approach events \u0026 states are not related or coupled. Rather it works in combination defined in the transition class. This gives a lot of flexibility along with preserving the Single Responsibility Principle \u0026 Open-Closed Principle. Modular Approach to State Design Pattern We have already seen the Functional approach to State Design Pattern with Modern C++ above which is very practical \u0026 scalable. But still, there are some of the devs who are not using C++17 yet. So we will consider a modular approach to this by implementing the transition table with different example this time. I’m going to model a phone call \u0026 phone can be in several different states. And I’m going to model those states not as entire types but just as members. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 enum class State { OffHook, Connecting, Connected, OnHold, OnHook }; inline ostream\u0026 operator\u003c\u003c(ostream\u0026 os, State\u0026 s) { switch (s) { case State::OffHook: os \u003c\u003c \"off the hook\"; break; case State::Connecting: os \u003c\u003c \"connecting\"; break; case State::Connected: os \u003c\u003c \"connected\"; break; case State::OnHold: os \u003c\u003c \"on hold\"; break; case State::OnHook: os \u003c\u003c \"on the hook\"; break; } return os; } enum class Trigger { CallDialed, HungUp, CallConnected, PlacedOnHold, TakenOffHold, LeftMessage, StopUsingPhone }; inline ostream\u0026 operator\u003c\u003c(ostream\u0026 os, Trigger\u0026 t) { switch (t) { case Trigger::CallDialed: os \u003c\u003c \"call dialed\"; break; case Trigger::HungUp: os \u003c\u003c \"hung up\"; break; case Trigger::CallConnected: os \u003c\u003c \"call connected\"; break; case Trigger::PlacedOnHold: os \u003c\u003c \"placed on hold\"; break; case Trigger::TakenOffHold: os \u003c\u003c \"taken off hold\"; break; case Trigger::LeftMessage: os \u003c\u003c \"left message\"; break; case Trigger::StopUsingPhone: os \u003c\u003c \"putting phone on hook\"; break; } return os; } int main() { map\u003cState, vector\u003cpair\u003cTrigger, State\u003e\u003e\u003e transition_table; transition_table[State::OffHook] = { { Trigger::CallDialed, State::Connecting }, { Trigger::StopUsingPhone, State::OnHook } }; transition_table[State::Connecting] = { { Trigger::HungUp, State::OffHook }, { Trigger::CallConnected, State::Connected } }; transition_table[State::Connected] = { { Trigger::LeftMessage, State::OffHook }, { Trigger::HungUp, State::OffHook }, { Trigger::PlacedOnHold, State::OnHold } }; transition_table[State::OnHold] = { { Trigger::TakenOffHold, State::Connected }, { Trigger::HungUp, State::OffHook } }; State currentState{State::OffHook}; State exitState{State::OnHook}; for (;;) { cout \u003c\u003c \"The phone is currently \" \u003c\u003c currentState \u003c\u003c endl; cout \u003c\u003c \"Select a trigger:\\n\"; uint32_t i = 0; for (auto item: transition_table[currentState]) cout \u003c\u003c i++ \u003c\u003c \". \" \u003c\u003c item.first \u003c\u003c \"\\n\"; uint32_t input; cin \u003e\u003e input; currentState = transition_table[currentState][input].second; // Caution: index out of range not checked if (currentState == exitState) break; } cout \u003c\u003c \"We are done using the phone\"\u003c\u003cendl; return EXIT_SUCCESS; } /* The phone is currently off the hook Select a trigger: 0. call dialed 1. putting phone on hook 0 \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c INPUT The phone is currently connecting Select a trigger: 0. hung up 1. call connected 1 \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c INPUT The phone is currently connected Select a trigger: 0. left message 1. hung up 2. placed on hold 0 \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c INPUT The phone is currently off the hook Select a trigger: 0. call dialed 1. putting phone on hook 1 \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c INPUT We are done using the phone */ So as you can see, we have modelled state \u0026 triggers as enums with the overloaded streaming operator. A typical phone call process changes the states in the following fashion; if the phone is off the hook; it can connecting; connected to somebody, or it can on-hold. Once connected, you left the message \u0026 you put the phone back on the hook when you’re done talking. Now we need an essential part i.e. triggers to drive the show, you can think of them as events which cause you to transition from one state to another. And to connect these states \u0026 triggers, we have done its mapping as std::map named as transition_table. You can consider it as rules of the game. So this is how you can very quickly hand-roll your own state machine by simply defining a set of states. Similarly, a set of triggers \u0026 transition table which kind of relates the rules for going from one state to another state using a particular trigger. And then you orchestrate that state machine and you get your results. Benefits of State Design Pattern The State Design Pattern minimizes conditional complexity, eliminating the need for if/else-if and switch statements in objects that have different behaviour requirements unique to different state transitions. As we have seen, If you are able to represent the object’s state machine diagram. It’s fairly easy to convert the diagram into the Finite State Machine using Functional \u0026 Modular approach. The State Design Pattern also improves Cohesion. Since state-specific behaviours aggregated into the separate classes \u0026 placed in one location in the code. Moreover, the State Design Pattern also helps in unit testing as adding new behaviour/states won’t affect existing behaviours/states, you do not need to retest the whole system. This is a very helpful case in agile development models. Summary by FAQs Difference between switch case statement \u0026 state machine implemented by switch case syntax.\nOrdinary switch case statement does not handle transition rather it just to particular activity based on case type.\nMost of the object’s behaviour determined by its data member. Then why is this a separate design pattern?\nWell in the representation of the Gang of Four the State Design Pattern basically suggests that the state of the system kind of controls the way that it operates and it also ties to this idea of Finite State Machine. And as I said earlier State Design Pattern is a systematic \u0026 sophisticated way to implement Finite State Machine.\nUse cases of State Design Pattern.\nATM machine, Timers, TV remote, Protocols, etc. Basically, anything that reflects different behaviour on different inputs.\nHow to use state pattern rapidly \u0026 correctly?\nFunctional approach seen above is the best way which treats states, events, transitions as a completely separate component.\n","wordCount":"2304","inLanguage":"en","image":"https://vishalchovatiya.github.io/images/State-Design-Pattern-in-Modern-C-vishal-chovatiya.png","datePublished":"2020-04-02T00:00:00Z","dateModified":"2020-04-02T00:00:00Z","author":{"@type":"Person","name":"Vishal Chovatiya"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vishalchovatiya.github.io/posts/state-design-pattern-in-modern-cpp/"},"publisher":{"@type":"Organization","name":"Vishal Chovatiya","logo":{"@type":"ImageObject","url":"https://vishalchovatiya.github.io/images/trident_favicon.webp"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://vishalchovatiya.github.io/ accesskey=h title="Vishal Chovatiya (Alt + H)"><img src=https://vishalchovatiya.github.io/apple-touch-icon.png alt aria-label=logo height=35>Vishal Chovatiya</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://vishalchovatiya.github.io/pages/vishal-chovatiya title="About Me"><span>About Me</span></a></li><li><a href=https://vishalchovatiya.github.io/pages/start-here title="Start Here"><span>Start Here</span></a></li><li><a href=https://vishalchovatiya.github.io/posts/ title=Latest><span>Latest</span></a></li><li><a href=https://vishalchovatiya.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://vishalchovatiya.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://vishalchovatiya.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">State Design Pattern in Modern C++</h1><div class=post-meta><span title='2020-04-02 00:00:00 +0000 UTC'>April 2, 2020</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2304 words&nbsp;·&nbsp;Vishal Chovatiya&nbsp;|&nbsp;<a href=https://github.com/vishalchovatiya/blog/blob/main/vishalchovatiya/content/posts/state-design-pattern-in-modern-cpp.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://vishalchovatiya.github.io/images/State-Design-Pattern-in-Modern-C-vishal-chovatiya.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#intent>Intent</a></li><li><a href=#state-design-pattern-examples-in-c>State Design Pattern Examples in C++</a><ul><li><a href=#classical-state-design-pattern>Classical State Design Pattern</a></li><li><a href=#functional-approach-to-state-design-pattern>Functional Approach to State Design Pattern</a></li><li><a href=#modular-approach-to-state-design-pattern>Modular Approach to State Design Pattern</a></li></ul></li><li><a href=#benefits-of-state-design-pattern>Benefits of State Design Pattern</a></li><li><a href=#summary-by-faqs>Summary by FAQs</a></li></ul></nav></div></details></div><div class=post-content><p>A State Design Pattern is a type of Behavioural Design Pattern that defines objects behaviour(defined as a state) based on some event happens. And that can be the internal or external event. For example, if you design an ATM machine using the State Design Pattern, the external event could be someone inserted debit/credit card & internal event could be a user timeout. So in nutshell, the State Design Pattern in Modern C++ is a <strong><em>systematic way to implement certain behaviour on a particular event considering the context</em></strong>.</p><p>By the way, If you haven’t check out my other articles on Behavioural Design Patterns, then here is the list:</p><ol><li><a href=/posts//chain-of-responsibility-design-pattern-in-modern-cpp/>Chain of responsibility</a></li><li><a href=/posts//command-design-pattern-in-modern-cpp/>Command</a></li><li><a href=/posts//interpreter-design-pattern-in-modern-cpp/>Interpreter</a></li><li><a href=/posts//iterator-design-pattern-in-modern-cpp/>Iterator</a></li><li><a href=/posts//mediator-design-pattern-in-modern-cpp/>Mediator</a></li><li><a href=/posts//memento-design-pattern-in-modern-cpp/>Memento</a></li><li><a href=/posts//observer-design-pattern-in-modern-cpp/>Observer</a></li><li><a href=/posts//state-design-pattern-in-modern-cpp/>State</a></li><li><a href=/posts//strategy-design-pattern-in-modern-cpp/>Strategy</a></li><li><a href=/posts//template-method-design-pattern-in-modern-cpp/>Template Method</a></li><li><a href=/posts//double-dispatch-visitor-design-pattern-in-modern-cpp/>Visitor</a></li></ol><p>The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like <code>override</code>, <code>final</code>, <code>public</code>(while inheritance) just to make code compact & consumable(most of the time) in single standard screen size. I also prefer <code>struct</code> instead of <code>class</code> just to save line by not writing &ldquo;<code>public:</code>&rdquo; sometimes and also miss <a href=/posts//part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/>virtual destructor</a>, constructor, <a href=/posts//all-about-copy-constructor-in-cpp-with-example/>copy constructor</a>, prefix <code>std::</code>, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.</p><p><strong><em>Note:</em></strong></p><ul><li>If you stumbled here directly, then I would suggest you go through <a href=/posts//what-is-design-pattern/>What is design pattern?</a> first, even if it is trivial. I believe it will encourage you to explore more on this topic.</li><li>All of this code you encounter in this series of articles are compiled using C++20(though I have used <a href=/posts//21-new-features-of-modern-cpp-to-use-in-your-project/>Modern C++</a> features up to C++17 in most cases). So if you don&rsquo;t have access to the latest compiler you can use <a href=https://wandbox.org/>https://wandbox.org/</a> which has preinstalled boost library as well.</li></ul><h2 id=intent>Intent<a hidden class=anchor aria-hidden=true href=#intent>#</a></h2><blockquote><p><strong><em>To implement the object&rsquo;s behaviour determined by its state.</em></strong></p></blockquote><ul><li>A State Design Pattern is to implement the <a href=/posts/inside-the-cpp-object-model/>object</a>&rsquo;s behaviour depending upon its state which also clarifies the transition from one state to another state. <strong><em>A formalized construct which manages states & transition is called a state machine</em></strong>.</li><li>The State Design Pattern solves two main problems:<ol><li>An object should change its behaviour when its internal state changes.</li><li>State-specific behaviour should define independently(i.e. in class). So, adding new states should not affect the behaviour of existing states.</li></ol></li></ul><h2 id=state-design-pattern-examples-in-c>State Design Pattern Examples in C++<a hidden class=anchor aria-hidden=true href=#state-design-pattern-examples-in-c>#</a></h2><p><img loading=lazy src=/images/State-Design-Pattern-Example-in-C-www_vishalchovatiya_com.png#center alt></p><ul><li>Consider the above simple diagram to model three different states along with respective triggers for the transition. We will first see the classical approach where we implement state transition using polymorphism & then move to Modern & Modular approach which involves <a href=https://en.cppreference.com/w/cpp/utility/variant>std::variant</a> & <a href=https://en.cppreference.com/w/cpp/utility/variant/visit>std::visit</a>.</li></ul><h3 id=classical-state-design-pattern>Classical State Design Pattern<a hidden class=anchor aria-hidden=true href=#classical-state-design-pattern>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27>27</a>
</span><span class=lnt id=hl-0-28><a class=lnlinks href=#hl-0-28>28</a>
</span><span class=lnt id=hl-0-29><a class=lnlinks href=#hl-0-29>29</a>
</span><span class=lnt id=hl-0-30><a class=lnlinks href=#hl-0-30>30</a>
</span><span class=lnt id=hl-0-31><a class=lnlinks href=#hl-0-31>31</a>
</span><span class=lnt id=hl-0-32><a class=lnlinks href=#hl-0-32>32</a>
</span><span class=lnt id=hl-0-33><a class=lnlinks href=#hl-0-33>33</a>
</span><span class=lnt id=hl-0-34><a class=lnlinks href=#hl-0-34>34</a>
</span><span class=lnt id=hl-0-35><a class=lnlinks href=#hl-0-35>35</a>
</span><span class=lnt id=hl-0-36><a class=lnlinks href=#hl-0-36>36</a>
</span><span class=lnt id=hl-0-37><a class=lnlinks href=#hl-0-37>37</a>
</span><span class=lnt id=hl-0-38><a class=lnlinks href=#hl-0-38>38</a>
</span><span class=lnt id=hl-0-39><a class=lnlinks href=#hl-0-39>39</a>
</span><span class=lnt id=hl-0-40><a class=lnlinks href=#hl-0-40>40</a>
</span><span class=lnt id=hl-0-41><a class=lnlinks href=#hl-0-41>41</a>
</span><span class=lnt id=hl-0-42><a class=lnlinks href=#hl-0-42>42</a>
</span><span class=lnt id=hl-0-43><a class=lnlinks href=#hl-0-43>43</a>
</span><span class=lnt id=hl-0-44><a class=lnlinks href=#hl-0-44>44</a>
</span><span class=lnt id=hl-0-45><a class=lnlinks href=#hl-0-45>45</a>
</span><span class=lnt id=hl-0-46><a class=lnlinks href=#hl-0-46>46</a>
</span><span class=lnt id=hl-0-47><a class=lnlinks href=#hl-0-47>47</a>
</span><span class=lnt id=hl-0-48><a class=lnlinks href=#hl-0-48>48</a>
</span><span class=lnt id=hl-0-49><a class=lnlinks href=#hl-0-49>49</a>
</span><span class=lnt id=hl-0-50><a class=lnlinks href=#hl-0-50>50</a>
</span><span class=lnt id=hl-0-51><a class=lnlinks href=#hl-0-51>51</a>
</span><span class=lnt id=hl-0-52><a class=lnlinks href=#hl-0-52>52</a>
</span><span class=lnt id=hl-0-53><a class=lnlinks href=#hl-0-53>53</a>
</span><span class=lnt id=hl-0-54><a class=lnlinks href=#hl-0-54>54</a>
</span><span class=lnt id=hl-0-55><a class=lnlinks href=#hl-0-55>55</a>
</span><span class=lnt id=hl-0-56><a class=lnlinks href=#hl-0-56>56</a>
</span><span class=lnt id=hl-0-57><a class=lnlinks href=#hl-0-57>57</a>
</span><span class=lnt id=hl-0-58><a class=lnlinks href=#hl-0-58>58</a>
</span><span class=lnt id=hl-0-59><a class=lnlinks href=#hl-0-59>59</a>
</span><span class=lnt id=hl-0-60><a class=lnlinks href=#hl-0-60>60</a>
</span><span class=lnt id=hl-0-61><a class=lnlinks href=#hl-0-61>61</a>
</span><span class=lnt id=hl-0-62><a class=lnlinks href=#hl-0-62>62</a>
</span><span class=lnt id=hl-0-63><a class=lnlinks href=#hl-0-63>63</a>
</span><span class=lnt id=hl-0-64><a class=lnlinks href=#hl-0-64>64</a>
</span><span class=lnt id=hl-0-65><a class=lnlinks href=#hl-0-65>65</a>
</span><span class=lnt id=hl-0-66><a class=lnlinks href=#hl-0-66>66</a>
</span><span class=lnt id=hl-0-67><a class=lnlinks href=#hl-0-67>67</a>
</span><span class=lnt id=hl-0-68><a class=lnlinks href=#hl-0-68>68</a>
</span><span class=lnt id=hl-0-69><a class=lnlinks href=#hl-0-69>69</a>
</span><span class=lnt id=hl-0-70><a class=lnlinks href=#hl-0-70>70</a>
</span><span class=lnt id=hl-0-71><a class=lnlinks href=#hl-0-71>71</a>
</span><span class=lnt id=hl-0-72><a class=lnlinks href=#hl-0-72>72</a>
</span><span class=lnt id=hl-0-73><a class=lnlinks href=#hl-0-73>73</a>
</span><span class=lnt id=hl-0-74><a class=lnlinks href=#hl-0-74>74</a>
</span><span class=lnt id=hl-0-75><a class=lnlinks href=#hl-0-75>75</a>
</span><span class=lnt id=hl-0-76><a class=lnlinks href=#hl-0-76>76</a>
</span><span class=lnt id=hl-0-77><a class=lnlinks href=#hl-0-77>77</a>
</span><span class=lnt id=hl-0-78><a class=lnlinks href=#hl-0-78>78</a>
</span><span class=lnt id=hl-0-79><a class=lnlinks href=#hl-0-79>79</a>
</span><span class=lnt id=hl-0-80><a class=lnlinks href=#hl-0-80>80</a>
</span><span class=lnt id=hl-0-81><a class=lnlinks href=#hl-0-81>81</a>
</span><span class=lnt id=hl-0-82><a class=lnlinks href=#hl-0-82>82</a>
</span><span class=lnt id=hl-0-83><a class=lnlinks href=#hl-0-83>83</a>
</span><span class=lnt id=hl-0-84><a class=lnlinks href=#hl-0-84>84</a>
</span><span class=lnt id=hl-0-85><a class=lnlinks href=#hl-0-85>85</a>
</span><span class=lnt id=hl-0-86><a class=lnlinks href=#hl-0-86>86</a>
</span><span class=lnt id=hl-0-87><a class=lnlinks href=#hl-0-87>87</a>
</span><span class=lnt id=hl-0-88><a class=lnlinks href=#hl-0-88>88</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* --------------------------------- Events ------------------------------------------ */</span>
</span></span><span class=line><span class=cl><span class=k>enum</span> <span class=nc>event</span> <span class=p>{</span> <span class=n>connect</span><span class=p>,</span> <span class=n>connected</span><span class=p>,</span> <span class=n>disconnect</span><span class=p>,</span> <span class=n>timeout</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>ostream</span> <span class=o>&amp;</span><span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>ostream</span> <span class=o>&amp;</span><span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>event</span> <span class=o>&amp;</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>event</span><span class=o>::</span><span class=nl>connect</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;connect&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>event</span><span class=o>::</span><span class=nl>connected</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;connected&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>event</span><span class=o>::</span><span class=nl>disconnect</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;disconnect&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>event</span><span class=o>::</span><span class=nl>timeout</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;timeout&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>State</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* --------------------------------- States ------------------------------------------ */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Idle</span> <span class=o>:</span> <span class=n>State</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Connecting</span> <span class=o>:</span> <span class=n>State</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span>                    <span class=n>m_trial</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>uint8_t</span>    <span class=n>m_max_trial</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Connected</span> <span class=o>:</span> <span class=n>State</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------- Transitions ---------------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>Idle</span><span class=o>::</span><span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Idle -&gt; &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>e</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>e</span> <span class=o>==</span> <span class=n>event</span><span class=o>::</span><span class=n>connect</span><span class=p>)</span> <span class=k>return</span> <span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Connecting</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>Connecting</span><span class=o>::</span><span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connecting -&gt; &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>e</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>event</span><span class=o>::</span><span class=nl>connected</span><span class=p>:</span> <span class=k>return</span> <span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Connected</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>event</span><span class=o>::</span><span class=nl>timeout</span><span class=p>:</span> <span class=k>return</span> <span class=o>++</span><span class=n>m_trial</span> <span class=o>&lt;</span> <span class=n>m_max_trial</span> <span class=o>?</span> <span class=k>nullptr</span> <span class=o>:</span> <span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Idle</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>Connected</span><span class=o>::</span><span class=n>on_event</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connected -&gt; &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>e</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>e</span> <span class=o>==</span> <span class=n>event</span><span class=o>::</span><span class=n>disconnect</span><span class=p>)</span> <span class=k>return</span> <span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Idle</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Bluetooth</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=n>m_curr_state</span> <span class=o>=</span> <span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Idle</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>dispatch</span><span class=p>(</span><span class=n>event</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>auto</span> <span class=n>new_state</span> <span class=o>=</span> <span class=n>m_curr_state</span><span class=o>-&gt;</span><span class=n>on_event</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>new_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>m_curr_state</span> <span class=o>=</span> <span class=n>move</span><span class=p>(</span><span class=n>new_state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Events</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>establish_connection</span><span class=p>(</span><span class=n>Events</span><span class=p>...</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span> <span class=p>(</span><span class=n>dispatch</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=p>...);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Bluetooth</span> <span class=n>bl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bl</span><span class=p>.</span><span class=n>establish_connection</span><span class=p>(</span><span class=n>event</span><span class=o>::</span><span class=n>connect</span><span class=p>,</span> <span class=n>event</span><span class=o>::</span><span class=n>timeout</span><span class=p>,</span> <span class=n>event</span><span class=o>::</span><span class=n>connected</span><span class=p>,</span> <span class=n>event</span><span class=o>::</span><span class=n>disconnect</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*  
</span></span></span><span class=line><span class=cl><span class=cm>Idle -&gt; connect
</span></span></span><span class=line><span class=cl><span class=cm>Connecting -&gt; timeout
</span></span></span><span class=line><span class=cl><span class=cm>Connecting -&gt; connected
</span></span></span><span class=line><span class=cl><span class=cm>Connected -&gt; disconnect
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Two subtle part here to take into the account is<ol><li>How we modelled triggers(i.e. events) & states, by considering state machine diagram.</li><li>And how we have fired steps to establish the connection using <a href=/posts/variadic-template-cpp-implementing-unsophisticated-tuple/>Variadic Template</a> Method & Fold expression.</li></ol></li><li>Rest of the code is self-explainable though.</li></ul><h3 id=functional-approach-to-state-design-pattern>Functional Approach to State Design Pattern<a hidden class=anchor aria-hidden=true href=#functional-approach-to-state-design-pattern>#</a></h3><ul><li>State Design Pattern is bizarre design patterns if you look at the classic definition of it. You will see something very different from how we actually build state machines nowadays so it&rsquo;s a completely different paradigm. Now we see more Modern & Functional approach to address this problem.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35>35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36>36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37>37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38>38</a>
</span><span class=lnt id=hl-1-39><a class=lnlinks href=#hl-1-39>39</a>
</span><span class=lnt id=hl-1-40><a class=lnlinks href=#hl-1-40>40</a>
</span><span class=lnt id=hl-1-41><a class=lnlinks href=#hl-1-41>41</a>
</span><span class=lnt id=hl-1-42><a class=lnlinks href=#hl-1-42>42</a>
</span><span class=lnt id=hl-1-43><a class=lnlinks href=#hl-1-43>43</a>
</span><span class=lnt id=hl-1-44><a class=lnlinks href=#hl-1-44>44</a>
</span><span class=lnt id=hl-1-45><a class=lnlinks href=#hl-1-45>45</a>
</span><span class=lnt id=hl-1-46><a class=lnlinks href=#hl-1-46>46</a>
</span><span class=lnt id=hl-1-47><a class=lnlinks href=#hl-1-47>47</a>
</span><span class=lnt id=hl-1-48><a class=lnlinks href=#hl-1-48>48</a>
</span><span class=lnt id=hl-1-49><a class=lnlinks href=#hl-1-49>49</a>
</span><span class=lnt id=hl-1-50><a class=lnlinks href=#hl-1-50>50</a>
</span><span class=lnt id=hl-1-51><a class=lnlinks href=#hl-1-51>51</a>
</span><span class=lnt id=hl-1-52><a class=lnlinks href=#hl-1-52>52</a>
</span><span class=lnt id=hl-1-53><a class=lnlinks href=#hl-1-53>53</a>
</span><span class=lnt id=hl-1-54><a class=lnlinks href=#hl-1-54>54</a>
</span><span class=lnt id=hl-1-55><a class=lnlinks href=#hl-1-55>55</a>
</span><span class=lnt id=hl-1-56><a class=lnlinks href=#hl-1-56>56</a>
</span><span class=lnt id=hl-1-57><a class=lnlinks href=#hl-1-57>57</a>
</span><span class=lnt id=hl-1-58><a class=lnlinks href=#hl-1-58>58</a>
</span><span class=lnt id=hl-1-59><a class=lnlinks href=#hl-1-59>59</a>
</span><span class=lnt id=hl-1-60><a class=lnlinks href=#hl-1-60>60</a>
</span><span class=lnt id=hl-1-61><a class=lnlinks href=#hl-1-61>61</a>
</span><span class=lnt id=hl-1-62><a class=lnlinks href=#hl-1-62>62</a>
</span><span class=lnt id=hl-1-63><a class=lnlinks href=#hl-1-63>63</a>
</span><span class=lnt id=hl-1-64><a class=lnlinks href=#hl-1-64>64</a>
</span><span class=lnt id=hl-1-65><a class=lnlinks href=#hl-1-65>65</a>
</span><span class=lnt id=hl-1-66><a class=lnlinks href=#hl-1-66>66</a>
</span><span class=lnt id=hl-1-67><a class=lnlinks href=#hl-1-67>67</a>
</span><span class=lnt id=hl-1-68><a class=lnlinks href=#hl-1-68>68</a>
</span><span class=lnt id=hl-1-69><a class=lnlinks href=#hl-1-69>69</a>
</span><span class=lnt id=hl-1-70><a class=lnlinks href=#hl-1-70>70</a>
</span><span class=lnt id=hl-1-71><a class=lnlinks href=#hl-1-71>71</a>
</span><span class=lnt id=hl-1-72><a class=lnlinks href=#hl-1-72>72</a>
</span><span class=lnt id=hl-1-73><a class=lnlinks href=#hl-1-73>73</a>
</span><span class=lnt id=hl-1-74><a class=lnlinks href=#hl-1-74>74</a>
</span><span class=lnt id=hl-1-75><a class=lnlinks href=#hl-1-75>75</a>
</span><span class=lnt id=hl-1-76><a class=lnlinks href=#hl-1-76>76</a>
</span><span class=lnt id=hl-1-77><a class=lnlinks href=#hl-1-77>77</a>
</span><span class=lnt id=hl-1-78><a class=lnlinks href=#hl-1-78>78</a>
</span><span class=lnt id=hl-1-79><a class=lnlinks href=#hl-1-79>79</a>
</span><span class=lnt id=hl-1-80><a class=lnlinks href=#hl-1-80>80</a>
</span><span class=lnt id=hl-1-81><a class=lnlinks href=#hl-1-81>81</a>
</span><span class=lnt id=hl-1-82><a class=lnlinks href=#hl-1-82>82</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* --------------------------------- Events ------------------------------------------ */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EventConnect</span> <span class=p>{</span> <span class=n>string</span> <span class=n>m_address</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EventConnected</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EventDisconnect</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EventTimeout</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Event</span> <span class=o>=</span> <span class=n>variant</span><span class=o>&lt;</span><span class=n>EventConnect</span><span class=p>,</span> <span class=n>EventConnected</span><span class=p>,</span> <span class=n>EventDisconnect</span><span class=p>,</span> <span class=n>EventTimeout</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* --------------------------------- States ------------------------------------------ */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Idle</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Connecting</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>                      <span class=n>m_address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span>                    <span class=n>m_trial</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>uint8_t</span>    <span class=n>m_max_trial</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Connected</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>State</span> <span class=o>=</span> <span class=n>variant</span><span class=o>&lt;</span><span class=n>Idle</span><span class=p>,</span> <span class=n>Connecting</span><span class=p>,</span> <span class=n>Connected</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------- Transitions ---------------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Transitions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>optional</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>()(</span><span class=n>Idle</span> <span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>EventConnect</span> <span class=o>&amp;</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Idle -&gt; Connect&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Connecting</span><span class=p>{</span><span class=n>e</span><span class=p>.</span><span class=n>m_address</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>optional</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>()(</span><span class=n>Connecting</span> <span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>EventConnected</span> <span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connecting -&gt; Connected&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Connected</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>optional</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>()(</span><span class=n>Connecting</span> <span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=k>const</span> <span class=n>EventTimeout</span> <span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connecting -&gt; Timeout&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>++</span><span class=n>s</span><span class=p>.</span><span class=n>m_trial</span> <span class=o>&lt;</span> <span class=n>Connecting</span><span class=o>::</span><span class=n>m_max_trial</span> <span class=o>?</span> <span class=nl>nullopt</span> <span class=p>:</span> <span class=n>optional</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Idle</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>optional</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>()(</span><span class=n>Connected</span> <span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>EventDisconnect</span> <span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connected -&gt; Disconnect&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Idle</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>State_t</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Event_t</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>optional</span><span class=o>&lt;</span><span class=n>State</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>()(</span><span class=n>State_t</span> <span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>Event_t</span> <span class=o>&amp;</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Unkown&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>nullopt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>StateVariant</span><span class=p>,</span> <span class=k>typename</span> <span class=n>EventVariant</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Transitions</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Bluetooth</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>StateVariant</span> <span class=n>m_curr_state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>dispatch</span><span class=p>(</span><span class=k>const</span> <span class=n>EventVariant</span> <span class=o>&amp;</span><span class=n>Event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>optional</span><span class=o>&lt;</span><span class=n>StateVariant</span><span class=o>&gt;</span> <span class=n>new_state</span> <span class=o>=</span> <span class=n>visit</span><span class=p>(</span><span class=n>Transitions</span><span class=p>{},</span> <span class=n>m_curr_state</span><span class=p>,</span> <span class=n>Event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>new_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>m_curr_state</span> <span class=o>=</span> <span class=o>*</span><span class=n>move</span><span class=p>(</span><span class=n>new_state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Events</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>establish_connection</span><span class=p>(</span><span class=n>Events</span><span class=p>...</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span> <span class=p>(</span><span class=n>dispatch</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=p>...);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Bluetooth</span><span class=o>&lt;</span><span class=n>State</span><span class=p>,</span> <span class=n>Event</span><span class=p>,</span> <span class=n>Transitions</span><span class=o>&gt;</span> <span class=n>bl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bl</span><span class=p>.</span><span class=n>establish_connection</span><span class=p>(</span><span class=n>EventConnect</span><span class=p>{</span><span class=s>&#34;AA:BB:CC:DD&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                            <span class=n>EventTimeout</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>                            <span class=n>EventConnected</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>                            <span class=n>EventDisconnect</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Idle -&gt; Connect
</span></span></span><span class=line><span class=cl><span class=cm>Connecting -&gt; Timeout
</span></span></span><span class=line><span class=cl><span class=cm>Connecting -&gt; Connected
</span></span></span><span class=line><span class=cl><span class=cm>Connected -&gt; Disconnect
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>A classical approach is not loosely coupled between events & states if you compare the above example. The changes in the sequence of events or adding new events will impact the condition part of states implemented in <code>on_event()</code>which violates the <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a>.</li><li>But in the case of Functional approach events & states are not related or coupled. Rather it works in combination defined in the transition class. This gives a lot of flexibility along with preserving the <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a> & <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a>.</li></ul><h3 id=modular-approach-to-state-design-pattern>Modular Approach to State Design Pattern<a hidden class=anchor aria-hidden=true href=#modular-approach-to-state-design-pattern>#</a></h3><ul><li>We have already seen the Functional approach to State Design Pattern with Modern C++ above which is very practical & scalable. But still, there are some of the devs who are not using C++17 yet.</li><li>So we will consider a modular approach to this by implementing the transition table with different example this time. I&rsquo;m going to model a phone call & phone can be in several different states. And I&rsquo;m going to model those states not as entire types but just as members.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36>36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37>37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38>38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39>39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40>40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41>41</a>
</span><span class=lnt id=hl-2-42><a class=lnlinks href=#hl-2-42>42</a>
</span><span class=lnt id=hl-2-43><a class=lnlinks href=#hl-2-43>43</a>
</span><span class=lnt id=hl-2-44><a class=lnlinks href=#hl-2-44>44</a>
</span><span class=lnt id=hl-2-45><a class=lnlinks href=#hl-2-45>45</a>
</span><span class=lnt id=hl-2-46><a class=lnlinks href=#hl-2-46>46</a>
</span><span class=lnt id=hl-2-47><a class=lnlinks href=#hl-2-47>47</a>
</span><span class=lnt id=hl-2-48><a class=lnlinks href=#hl-2-48>48</a>
</span><span class=lnt id=hl-2-49><a class=lnlinks href=#hl-2-49>49</a>
</span><span class=lnt id=hl-2-50><a class=lnlinks href=#hl-2-50>50</a>
</span><span class=lnt id=hl-2-51><a class=lnlinks href=#hl-2-51>51</a>
</span><span class=lnt id=hl-2-52><a class=lnlinks href=#hl-2-52>52</a>
</span><span class=lnt id=hl-2-53><a class=lnlinks href=#hl-2-53>53</a>
</span><span class=lnt id=hl-2-54><a class=lnlinks href=#hl-2-54>54</a>
</span><span class=lnt id=hl-2-55><a class=lnlinks href=#hl-2-55>55</a>
</span><span class=lnt id=hl-2-56><a class=lnlinks href=#hl-2-56>56</a>
</span><span class=lnt id=hl-2-57><a class=lnlinks href=#hl-2-57>57</a>
</span><span class=lnt id=hl-2-58><a class=lnlinks href=#hl-2-58>58</a>
</span><span class=lnt id=hl-2-59><a class=lnlinks href=#hl-2-59>59</a>
</span><span class=lnt id=hl-2-60><a class=lnlinks href=#hl-2-60>60</a>
</span><span class=lnt id=hl-2-61><a class=lnlinks href=#hl-2-61>61</a>
</span><span class=lnt id=hl-2-62><a class=lnlinks href=#hl-2-62>62</a>
</span><span class=lnt id=hl-2-63><a class=lnlinks href=#hl-2-63>63</a>
</span><span class=lnt id=hl-2-64><a class=lnlinks href=#hl-2-64>64</a>
</span><span class=lnt id=hl-2-65><a class=lnlinks href=#hl-2-65>65</a>
</span><span class=lnt id=hl-2-66><a class=lnlinks href=#hl-2-66>66</a>
</span><span class=lnt id=hl-2-67><a class=lnlinks href=#hl-2-67>67</a>
</span><span class=lnt id=hl-2-68><a class=lnlinks href=#hl-2-68>68</a>
</span><span class=lnt id=hl-2-69><a class=lnlinks href=#hl-2-69>69</a>
</span><span class=lnt id=hl-2-70><a class=lnlinks href=#hl-2-70>70</a>
</span><span class=lnt id=hl-2-71><a class=lnlinks href=#hl-2-71>71</a>
</span><span class=lnt id=hl-2-72><a class=lnlinks href=#hl-2-72>72</a>
</span><span class=lnt id=hl-2-73><a class=lnlinks href=#hl-2-73>73</a>
</span><span class=lnt id=hl-2-74><a class=lnlinks href=#hl-2-74>74</a>
</span><span class=lnt id=hl-2-75><a class=lnlinks href=#hl-2-75>75</a>
</span><span class=lnt id=hl-2-76><a class=lnlinks href=#hl-2-76>76</a>
</span><span class=lnt id=hl-2-77><a class=lnlinks href=#hl-2-77>77</a>
</span><span class=lnt id=hl-2-78><a class=lnlinks href=#hl-2-78>78</a>
</span><span class=lnt id=hl-2-79><a class=lnlinks href=#hl-2-79>79</a>
</span><span class=lnt id=hl-2-80><a class=lnlinks href=#hl-2-80>80</a>
</span><span class=lnt id=hl-2-81><a class=lnlinks href=#hl-2-81>81</a>
</span><span class=lnt id=hl-2-82><a class=lnlinks href=#hl-2-82>82</a>
</span><span class=lnt id=hl-2-83><a class=lnlinks href=#hl-2-83>83</a>
</span><span class=lnt id=hl-2-84><a class=lnlinks href=#hl-2-84>84</a>
</span><span class=lnt id=hl-2-85><a class=lnlinks href=#hl-2-85>85</a>
</span><span class=lnt id=hl-2-86><a class=lnlinks href=#hl-2-86>86</a>
</span><span class=lnt id=hl-2-87><a class=lnlinks href=#hl-2-87>87</a>
</span><span class=lnt id=hl-2-88><a class=lnlinks href=#hl-2-88>88</a>
</span><span class=lnt id=hl-2-89><a class=lnlinks href=#hl-2-89>89</a>
</span><span class=lnt id=hl-2-90><a class=lnlinks href=#hl-2-90>90</a>
</span><span class=lnt id=hl-2-91><a class=lnlinks href=#hl-2-91>91</a>
</span><span class=lnt id=hl-2-92><a class=lnlinks href=#hl-2-92>92</a>
</span><span class=lnt id=hl-2-93><a class=lnlinks href=#hl-2-93>93</a>
</span><span class=lnt id=hl-2-94><a class=lnlinks href=#hl-2-94>94</a>
</span><span class=lnt id=hl-2-95><a class=lnlinks href=#hl-2-95>95</a>
</span><span class=lnt id=hl-2-96><a class=lnlinks href=#hl-2-96>96</a>
</span><span class=lnt id=hl-2-97><a class=lnlinks href=#hl-2-97>97</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>enum</span> <span class=k>class</span> <span class=nc>State</span> <span class=p>{</span> <span class=n>OffHook</span><span class=p>,</span> <span class=n>Connecting</span><span class=p>,</span> <span class=n>Connected</span><span class=p>,</span> <span class=n>OnHold</span><span class=p>,</span> <span class=n>OnHook</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=n>State</span><span class=o>&amp;</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>State</span><span class=o>::</span><span class=nl>OffHook</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;off the hook&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>State</span><span class=o>::</span><span class=nl>Connecting</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;connecting&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>State</span><span class=o>::</span><span class=nl>Connected</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;connected&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>State</span><span class=o>::</span><span class=nl>OnHold</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;on hold&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>State</span><span class=o>::</span><span class=nl>OnHook</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;on the hook&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>enum</span> <span class=k>class</span> <span class=nc>Trigger</span> <span class=p>{</span> <span class=n>CallDialed</span><span class=p>,</span> <span class=n>HungUp</span><span class=p>,</span> <span class=n>CallConnected</span><span class=p>,</span> <span class=n>PlacedOnHold</span><span class=p>,</span> <span class=n>TakenOffHold</span><span class=p>,</span> <span class=n>LeftMessage</span><span class=p>,</span> <span class=n>StopUsingPhone</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=n>Trigger</span><span class=o>&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>CallDialed</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;call dialed&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>HungUp</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;hung up&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>CallConnected</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;call connected&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>PlacedOnHold</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;placed on hold&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>TakenOffHold</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;taken off hold&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>LeftMessage</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;left message&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>Trigger</span><span class=o>::</span><span class=nl>StopUsingPhone</span><span class=p>:</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;putting phone on hook&#34;</span><span class=p>;</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>map</span><span class=o>&lt;</span><span class=n>State</span><span class=p>,</span> <span class=n>vector</span><span class=o>&lt;</span><span class=n>pair</span><span class=o>&lt;</span><span class=n>Trigger</span><span class=p>,</span> <span class=n>State</span><span class=o>&gt;&gt;&gt;</span>    <span class=n>transition_table</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>transition_table</span><span class=p>[</span><span class=n>State</span><span class=o>::</span><span class=n>OffHook</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>CallDialed</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>Connecting</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>StopUsingPhone</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>OnHook</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>transition_table</span><span class=p>[</span><span class=n>State</span><span class=o>::</span><span class=n>Connecting</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>HungUp</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>OffHook</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>CallConnected</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>Connected</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>transition_table</span><span class=p>[</span><span class=n>State</span><span class=o>::</span><span class=n>Connected</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>LeftMessage</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>OffHook</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>HungUp</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>OffHook</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>PlacedOnHold</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>OnHold</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>transition_table</span><span class=p>[</span><span class=n>State</span><span class=o>::</span><span class=n>OnHold</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>TakenOffHold</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>Connected</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=n>Trigger</span><span class=o>::</span><span class=n>HungUp</span><span class=p>,</span> <span class=n>State</span><span class=o>::</span><span class=n>OffHook</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>State</span> <span class=n>currentState</span><span class=p>{</span><span class=n>State</span><span class=o>::</span><span class=n>OffHook</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>State</span> <span class=n>exitState</span><span class=p>{</span><span class=n>State</span><span class=o>::</span><span class=n>OnHook</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;The phone is currently &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>currentState</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Select a trigger:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=nl>item</span><span class=p>:</span> <span class=n>transition_table</span><span class=p>[</span><span class=n>currentState</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>i</span><span class=o>++</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;. &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>item</span><span class=p>.</span><span class=n>first</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=n>input</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>input</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>currentState</span> <span class=o>=</span> <span class=n>transition_table</span><span class=p>[</span><span class=n>currentState</span><span class=p>][</span><span class=n>input</span><span class=p>].</span><span class=n>second</span><span class=p>;</span> <span class=c1>// Caution: index out of range not checked
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>currentState</span> <span class=o>==</span> <span class=n>exitState</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;We are done using the phone&#34;</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>The phone is currently off the hook
</span></span></span><span class=line><span class=cl><span class=cm>Select a trigger:
</span></span></span><span class=line><span class=cl><span class=cm>0. call dialed
</span></span></span><span class=line><span class=cl><span class=cm>1. putting phone on hook
</span></span></span><span class=line><span class=cl><span class=cm>0 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; INPUT
</span></span></span><span class=line><span class=cl><span class=cm>The phone is currently connecting
</span></span></span><span class=line><span class=cl><span class=cm>Select a trigger:
</span></span></span><span class=line><span class=cl><span class=cm>0. hung up
</span></span></span><span class=line><span class=cl><span class=cm>1. call connected
</span></span></span><span class=line><span class=cl><span class=cm>1 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; INPUT
</span></span></span><span class=line><span class=cl><span class=cm>The phone is currently connected
</span></span></span><span class=line><span class=cl><span class=cm>Select a trigger:
</span></span></span><span class=line><span class=cl><span class=cm>0. left message
</span></span></span><span class=line><span class=cl><span class=cm>1. hung up
</span></span></span><span class=line><span class=cl><span class=cm>2. placed on hold
</span></span></span><span class=line><span class=cl><span class=cm>0 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; INPUT
</span></span></span><span class=line><span class=cl><span class=cm>The phone is currently off the hook
</span></span></span><span class=line><span class=cl><span class=cm>Select a trigger:
</span></span></span><span class=line><span class=cl><span class=cm>0. call dialed
</span></span></span><span class=line><span class=cl><span class=cm>1. putting phone on hook
</span></span></span><span class=line><span class=cl><span class=cm>1 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; INPUT
</span></span></span><span class=line><span class=cl><span class=cm>We are done using the phone
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>So as you can see, we have modelled state & triggers as enums with the overloaded streaming operator. A typical phone call process changes the states in the following fashion; if the phone is off the hook; it can connecting; connected to somebody, or it can on-hold. Once connected, you left the message & you put the phone back on the hook when you&rsquo;re done talking.</li><li>Now we need an essential part i.e. triggers to drive the show, you can think of them as events which cause you to transition from one state to another.</li><li>And to connect these states & triggers, we have done its mapping as <code>std::map</code> named as <code>transition_table</code>. You can consider it as rules of the game.</li><li>So this is how you can very quickly hand-roll your own state machine by simply defining a set of states. Similarly, a set of triggers & transition table which kind of relates the rules for going from one state to another state using a particular trigger. And then you orchestrate that state machine and you get your results.</li></ul><h2 id=benefits-of-state-design-pattern>Benefits of State Design Pattern<a hidden class=anchor aria-hidden=true href=#benefits-of-state-design-pattern>#</a></h2><ol><li>The State Design Pattern minimizes conditional complexity, eliminating the need for if/else-if and switch statements in objects that have different behaviour requirements unique to different state transitions.</li><li>As we have seen, If you are able to represent the <a href=/posts/inside-the-cpp-object-model/>object</a>&rsquo;s state machine diagram. It&rsquo;s fairly easy to convert the diagram into the Finite State Machine using Functional & Modular approach.</li><li>The State Design Pattern also improves Cohesion. Since state-specific behaviours aggregated into the separate classes & placed in one location in the code.</li><li>Moreover, the State Design Pattern also helps in unit testing as adding new behaviour/states won&rsquo;t affect existing behaviours/states, you do not need to retest the whole system. This is a very helpful case in agile development models.</li></ol><h2 id=summary-by-faqs>Summary by FAQs<a hidden class=anchor aria-hidden=true href=#summary-by-faqs>#</a></h2><p><strong>Difference between switch case statement & state machine implemented by switch case syntax.</strong></p><p>Ordinary switch case statement does not handle transition rather it just to particular activity based on case type.</p><p><strong>Most of the object&rsquo;s behaviour determined by its data member. Then why is this a separate design pattern?</strong></p><p>Well in the representation of the Gang of Four the State Design Pattern basically suggests that the state of the system kind of controls the way that it operates and it also ties to this idea of Finite State Machine. And as I said earlier State Design Pattern is a systematic & sophisticated way to implement Finite State Machine.</p><p><strong>Use cases of State Design Pattern.</strong></p><p>ATM machine, Timers, TV remote, Protocols, etc. Basically, anything that reflects different behaviour on different inputs.</p><p><strong>How to use state pattern rapidly & correctly?</strong></p><p>Functional approach seen above is the best way which treats states, events, transitions as a completely separate component.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://vishalchovatiya.github.io/tags/benefits-of-state-design-pattern/>Benefits-of-State-Design-Pattern</a></li><li><a href=https://vishalchovatiya.github.io/tags/classical-state-design-pattern/>Classical-State-Design-Pattern</a></li><li><a href=https://vishalchovatiya.github.io/tags/difference-between-switch-case-statement-state-machine-implemented-by-switch-case-syntax/>Difference-Between-Switch-Case-Statement-State-Machine-Implemented-by-Switch-Case-Syntax</a></li><li><a href=https://vishalchovatiya.github.io/tags/functional-approach-to-state-design-pattern/>Functional-Approach-to-State-Design-Pattern</a></li><li><a href=https://vishalchovatiya.github.io/tags/how-to-use-state-pattern-rapidly-correctly/>How-to-Use-State-Pattern-Rapidly-Correctly</a></li><li><a href=https://vishalchovatiya.github.io/tags/modular-approach-to-state-design-pattern/>Modular-Approach-to-State-Design-Pattern</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-design-pattern-c/>State-Design-Pattern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-design-pattern-examples-in-c/>State-Design-Pattern-Examples-in-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-design-pattern-in-modern-c/>State-Design-Pattern-in-Modern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-machine/>State-Machine</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-machine-design-pattern-c-example/>State-Machine-Design-Pattern-C-Example</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-machine-design-using-stdvisit-stdvariant/>State-Machine-Design-Using-Stdvisit-Stdvariant</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-pattern-c/>State-Pattern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-pattern-c-example/>State-Pattern-C-Example</a></li><li><a href=https://vishalchovatiya.github.io/tags/state-pattern-cpp/>State-Pattern-Cpp</a></li><li><a href=https://vishalchovatiya.github.io/tags/use-cases-of-state-design-pattern/>Use-Cases-of-State-Design-Pattern</a></li></ul><nav class=paginav><a class=prev href=https://vishalchovatiya.github.io/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/><span class=title>« Prev</span><br><span>Double Dispatch : Visitor Design Pattern in Modern C++</span>
</a><a class=next href=https://vishalchovatiya.github.io/posts/strategy-design-pattern-in-modern-cpp/><span class=title>Next »</span><br><span>Strategy Design Pattern in Modern C++</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on x" href="https://x.com/intent/tweet/?text=State%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f&amp;hashtags=benefits-of-state-design-pattern%2cclassical-state-design-pattern%2cdifference-between-switch-case-statement-state-machine-implemented-by-switch-case-syntax%2cfunctional-approach-to-state-design-pattern%2chow-to-use-state-pattern-rapidly-correctly%2cmodular-approach-to-state-design-pattern%2cstate-design-pattern-c%2cstate-design-pattern-examples-in-c%2cstate-design-pattern-in-modern-c%2cstate-machine%2cstate-machine-design-pattern-c-example%2cstate-machine-design-using-stdvisit-stdvariant%2cstate-pattern-c%2cstate-pattern-c-example%2cstate-pattern-cpp%2cuse-cases-of-state-design-pattern"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f&amp;title=State%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;summary=State%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;source=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f&title=State%20Design%20Pattern%20in%20Modern%20C%2b%2b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on whatsapp" href="https://api.whatsapp.com/send?text=State%20Design%20Pattern%20in%20Modern%20C%2b%2b%20-%20https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on telegram" href="https://telegram.me/share/url?text=State%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share State Design Pattern in Modern C++ on ycombinator" href="https://news.ycombinator.com/submitlink?t=State%20Design%20Pattern%20in%20Modern%20C%2b%2b&u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fstate-design-pattern-in-modern-cpp%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://vishalchovatiya.github.io/>Vishal Chovatiya</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>