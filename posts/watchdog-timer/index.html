<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Watchdog Timer(WDT) &amp; Window Watchdog Timer(WWDT) · Vishal Chovatiya
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Vishal Chovatiya">
<meta name="description" content="In the embedded systems/SoCs, Watchdog Timer(WDT) is the basic, subtle and essential circuit/ic. No matter, how good you write your firmware/software. There are always unexpected situations like your program may stick in an infinite loop, hung somewhere or hardware burn-out/failure. To combat these unexpected situations, we need some circuitry that keeps monitoring the main system/application and in case of unexpected events, it restarts the system. Even the windows-like operating system use the watchdog timer.">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Watchdog Timer(WDT) &amp; Window Watchdog Timer(WWDT)">
  <meta name="twitter:description" content="In the embedded systems/SoCs, Watchdog Timer(WDT) is the basic, subtle and essential circuit/ic. No matter, how good you write your firmware/software. There are always unexpected situations like your program may stick in an infinite loop, hung somewhere or hardware burn-out/failure. To combat these unexpected situations, we need some circuitry that keeps monitoring the main system/application and in case of unexpected events, it restarts the system. Even the windows-like operating system use the watchdog timer.">

<meta property="og:url" content="http://localhost:1313/posts/watchdog-timer/">
  <meta property="og:site_name" content="Vishal Chovatiya">
  <meta property="og:title" content="Watchdog Timer(WDT) &amp; Window Watchdog Timer(WWDT)">
  <meta property="og:description" content="In the embedded systems/SoCs, Watchdog Timer(WDT) is the basic, subtle and essential circuit/ic. No matter, how good you write your firmware/software. There are always unexpected situations like your program may stick in an infinite loop, hung somewhere or hardware burn-out/failure. To combat these unexpected situations, we need some circuitry that keeps monitoring the main system/application and in case of unexpected events, it restarts the system. Even the windows-like operating system use the watchdog timer.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-05-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-05-17T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/watchdog-timer/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">








 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>




<body class="preload-transitions colorscheme-light">
  

  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Vishal Chovatiya
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Latest</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/pages/start-here">Start Here</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/cpp/">C/C&#43;&#43;</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/linux-system-programming/">Linux System Programming</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/misc/">Misc</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/watchdog-timer/">
              Watchdog Timer(WDT) &amp; Window Watchdog Timer(WWDT)
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2020-05-17T00:00:00Z">
                May 17, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/embedded-system/">Embedded-System</a>
      <span class="separator">•</span>
    <a href="/categories/misc/">Misc</a></div>

          
        </div>
      </header>

      <div class="post-content">
        
          <img src="/images/watchdog-timer-block-diagram.png" alt="Featured image"/>
        
        <p>In the embedded systems/SoCs, Watchdog Timer(WDT) is the basic, subtle and essential circuit/ic. No matter, how good you write your firmware/software. There are always unexpected situations like your program may stick in an infinite loop, hung somewhere or hardware burn-out/failure. To combat these unexpected situations, we need some circuitry that keeps monitoring the main system/application and in case of unexpected events, it restarts the system. </p>
<p>Even the windows-like operating system use the watchdog timer. But with more sophisticated software &amp; hardware i.e. window’s Blue Screen of Death (BSoD).</p>
<p>WDT comes as an integral part of Microcontrollers/SoCs or you may also get it as a separate chip.</p>
<h2 id="what-is-watchdog-timer">
  What Is Watchdog Timer?
  <a class="heading-link" href="#what-is-watchdog-timer">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>A Watchdog Timer(WDT) is a piece of hardware that uses to automatically detect software anomalies. And reset the processor if any occur.</li>
<li>Generally speaking, a watchdog timer is kind of timer/counter that counts down from some preset value to zero.</li>
<li>The embedded software selects the counter&rsquo;s initial value and periodically restarts the timer before it reaches zero. </li>
<li>If WDT reaches to zero, software presumes to malfunction. And the processor&rsquo;s reset signal asserted. The processor will restart as if a human operator had cycled the power.</li>
</ul>
<h2 id="block-diagram">
  Block Diagram
  <a class="heading-link" href="#block-diagram">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><img src="/images/watchdog-timer-block-diagram.png"></p>
<ul>
<li>Above figure shows a typical arrangement of external WDT to CPU. </li>
<li>Depending upon vendors &amp; types, Watchdog Timer has numbers of CPU programmable memory-mapped registers.</li>
<li>CPU receives the reset signal from WDT to identify the timeout condition.</li>
<li>There could be many other interfaces as well(depending upon microcontroller or chip vendor) but I have taken a minimalistic example to show boiled down interfacing.</li>
</ul>
<h2 id="programming-procedure">
  Programming Procedure
  <a class="heading-link" href="#programming-procedure">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>Although this is a subjective matter as there are many SoCs in the market and they use a different type of watchdog timer but the overall concept is the same more or less. Following is a general procedure to program the WDT:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">uint32_t</span> timeout_cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x12345678</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    hw_init();
</span></span><span style="display:flex;"><span>    wdt_init(timeout_cnt);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (;;)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        extract_data_from_sensors(); <span style="color:#75715e">// task 1: may take 800 micro-seconds
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        handle_motor_control();      <span style="color:#75715e">// task 2: may take 6 milli-seconds
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        display_status();            <span style="color:#75715e">// task 3: may take 2 milli-seconds
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... some other tasks
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        re_set_wdt();                <span style="color:#75715e">// set timeout of 8 milli-seconds approximately
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>In bare-metal software, we generally have a single main loop comprising of all the tasks &amp; we simply put the watchdog reset mechanism at the end of this loop as you can see above.</li>
<li>But before reset mechanism kick-in, we have to initialize WDT register related to control, tick count, etc with proper values which usually carried out in hardware initialization phase or in the start-up of application.</li>
<li>Calculation of tick count includes
<ul>
<li>Approximate time consumed by all the tasks</li>
<li>Plus some buffer amount of time(for speed variation due to other parameters like temperature, etc).</li>
</ul>
</li>
<li>On top of this, WDT count register value(i.e. tick count) decided with the help of WDT input frequency(and Prescaler if used any).</li>
</ul>
<h2 id="how-does-watchdog-timer-work">
  How Does Watchdog Timer Work?
  <a class="heading-link" href="#how-does-watchdog-timer-work">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>As I said earlier, WDT is basically a timer. So it keeps counting down till zero. As long as all the tasks completed in approximate precomputed time before tick count reaches zero. WDT repeatedly reinitialize with tick count at the end of the loop(as shown in the code snippet above).</li>
<li>But in some unexpected situations, there might be chances that some task stuck, hangs or taking a longer time than usual. In such cases timer expires(means tick count reaches to zero) &amp; reset signal asserts to CPU. </li>
<li>CPU resets(as like you just power-on) and your code again start executing from <a href="/posts/crt-run-time-before-starting-main/" >main</a>(precisely program counter set to starting of 1st instruction of your code).</li>
<li>Although, this is not necessarily true that the reset signal directly driven to CPU. Because in most of the complex(or I would say advanced) embedded systems which have multicore &amp; separate reset/fault management unit. There has an interconnect circuitry to route this kind of signals to appropriate CPU or reset/fault management block to check criticality state of the system before to reset it.</li>
</ul>
<h2 id="issue-with-traditional-watchdog-timer">
  Issue With Traditional Watchdog Timer
  <a class="heading-link" href="#issue-with-traditional-watchdog-timer">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>Older/normal watchdogs are only watching upon overrun condition like some task taking longer time, hangs, stuck, etc.</li>
<li>But what if some component detached from the system, burn-out or giving false results without process or doing anything meaningful. In such cases, your watchdog timer will keep resetting too frequently.</li>
<li>This is also underrun &amp; an error-prone scenario that should be checked too. And hence the Window Watchdog Timer:</li>
</ul>
<h2 id="window-watchdog-timer">
  Window Watchdog Timer
  <a class="heading-link" href="#window-watchdog-timer">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><img src="/images/window-watchdog-timer-wwdt-vishal-chovatiya.png"></p>
<ul>
<li>Window Watchdog Timer not only checks for overrunning. But also look upon underrun condition with the help of two tick count registers rather than one.</li>
<li>Start/Low tick count register used to measure start point of window &amp; End/Low used to measure the endpoint of the window.</li>
<li>If all the task complete within this(marked in green above) time frame/window then only WDT re-sets. Otherwise, it asserts the reset signal. </li>
<li>See this <a href="https://www.microchip.com/design-centers/8-bit/peripherals/core-independent/windowed-watch-dog-timer"  class="external-link" target="_blank" rel="noopener">microchip</a> or <a href="https://www.maximintegrated.com/en/design/technical-documents/app-notes/1/1070.html"  class="external-link" target="_blank" rel="noopener">maxim</a>’s WWDT for example.</li>
</ul>
<h2 id="summary">
  Summary
  <a class="heading-link" href="#summary">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>What is a watchdog timer(WDT)?</strong></p>
<p>A watchdog timer is a fail-safe hardware mechanism that resets the microcontroller when its timer expires/reaches-zero.</p>
<p><strong>How does watchdog timer work?</strong></p>
<ul>
<li>Watchdog timer keeps counting down till zero.</li>
<li>As long as all the tasks completed in approximate precomputed time before tick count reaches zero.</li>
<li>WDT repeatedly reinitialize with tick count at the end of the loop(as shown in the code snippet example above).</li>
<li>If it reaches zero, software presumes to malfunction. And the processor’s reset signal asserted.</li>
</ul>
<p><strong>What is the purpose/function/application of the watchdog timer?</strong></p>
<p>Watchdog timer prevents software malfunction &amp; provide soft real-time behaviour for embedded systems/SoC.</p>
<p><strong>Watchdog timer role in modern embedded systems/SoCs?</strong></p>
<p>Watchdog timers in modern embedded systems/SoCs are way more complex than they have to be in earlier days:</p>
<ul>
<li>Have Prescaler to divide clock to increase tick count period,</li>
<li>Also, use window mode as we discussed above,</li>
<li>Uses more than one reset signal to indicate the type of fault to CPU/fault-generator,</li>
<li>Able to detect sleep mode of CPUs to shut down its operation,</li>
<li>Also tracks the state of system SFRs,</li>
<li>May have an interface to Power-On Reset (POR), Brown Out Reset (BOR), Low Power Brown Out Reset (LPBOR, etc) for some advanced functionality.</li>
</ul>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Vishal Chovatiya 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
