<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Prototype Design Pattern in Modern C&#43;&#43; · Vishal Chovatiya
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Vishal Chovatiya">
<meta name="description" content="Prototype Design Pattern is a Creational Design Pattern that helps in the prototyping(creating/copying cheaply) of an object using separate methods or polymorphic classes. You can consider the prototype as a template of an object before the actual object is constructed. In this article of the Creational Design Patterns, we&rsquo;re going to take a look at why we need a Prototype Design Pattern in C&#43;&#43; i.e. motivation, prototype factory &amp; leveraging prototype design pattern to implement virtual copy constructor.">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Prototype Design Pattern in Modern C&#43;&#43;">
  <meta name="twitter:description" content="Prototype Design Pattern is a Creational Design Pattern that helps in the prototyping(creating/copying cheaply) of an object using separate methods or polymorphic classes. You can consider the prototype as a template of an object before the actual object is constructed. In this article of the Creational Design Patterns, we’re going to take a look at why we need a Prototype Design Pattern in C&#43;&#43; i.e. motivation, prototype factory &amp; leveraging prototype design pattern to implement virtual copy constructor.">

<meta property="og:url" content="http://localhost:1313/posts/prototype-design-pattern-in-modern-cpp/">
  <meta property="og:site_name" content="Vishal Chovatiya">
  <meta property="og:title" content="Prototype Design Pattern in Modern C&#43;&#43;">
  <meta property="og:description" content="Prototype Design Pattern is a Creational Design Pattern that helps in the prototyping(creating/copying cheaply) of an object using separate methods or polymorphic classes. You can consider the prototype as a template of an object before the actual object is constructed. In this article of the Creational Design Patterns, we’re going to take a look at why we need a Prototype Design Pattern in C&#43;&#43; i.e. motivation, prototype factory &amp; leveraging prototype design pattern to implement virtual copy constructor.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-04-06T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-04-06T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/prototype-design-pattern-in-modern-cpp/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">








 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>




<body class="preload-transitions colorscheme-light">
  

  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Vishal Chovatiya
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Latest</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/pages/start-here">Start Here</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/cpp/">C/C&#43;&#43;</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/linux-system-programming/">Linux System Programming</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/misc/">Misc</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/prototype-design-pattern-in-modern-cpp/">
              Prototype Design Pattern in Modern C&#43;&#43;
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2020-04-06T00:00:00Z">
                April 6, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              8-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/cpp/">Cpp</a>
      <span class="separator">•</span>
    <a href="/categories/design-patterns/">Design-Patterns</a>
      <span class="separator">•</span>
    <a href="/categories/software-engineering/">Software-Engineering</a></div>

          
        </div>
      </header>

      <div class="post-content">
        
          <img src="/images/Prototype-Design-Pattern-in-Modern-C-vishal-chovatiya.webp" alt="Featured image"/>
        
        <p>Prototype Design Pattern is a Creational Design Pattern that <strong><em>helps in the prototyping(creating/copying cheaply) of an object using separate methods or polymorphic classes</em></strong>. You can consider the prototype as a <a href="/posts/c-template-a-quick-uptodate-look/" >template</a> of an object before the actual object is constructed. In this article of the Creational Design Patterns, we&rsquo;re going to take a look at why we need a Prototype Design Pattern in C++ i.e. motivation, prototype factory &amp; leveraging prototype design pattern to implement <a href="/posts/7-advanced-cpp-concepts-idiom-examples-you-should-know/#Virtual-Constructor" >virtual copy constructor</a>.</p>
<p>By the way, If you haven’t check out my other articles on Creational Design Patterns, then here is the list:</p>
<ol>
<li><a href="/posts//factory-design-pattern-in-modern-cpp/" >Factory</a></li>
<li><a href="/posts//builder-design-pattern-in-modern-cpp/" >Builder</a></li>
<li><a href="/posts//prototype-design-pattern-in-modern-cpp/" >Prototype</a></li>
<li><a href="/posts//singleton-design-pattern-in-modern-cpp/" >Singleton</a></li>
</ol>
<p>The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like <code>override</code>, <code>final</code>, <code>public</code>(while inheritance) just to make code compact &amp; consumable(most of the time) in single standard screen size. I also prefer <code>struct</code> instead of <code>class</code> just to save line by not writing &ldquo;<code>public:</code>&rdquo; sometimes and also miss <a href="/posts//part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/" >virtual destructor</a>, constructor, <a href="/posts//all-about-copy-constructor-in-cpp-with-example/" >copy constructor</a>, prefix <code>std::</code>, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.</p>
<p><strong><em>Note:</em></strong></p>
<ul>
<li>If you stumbled here directly, then I would suggest you go through <a href="/posts//what-is-design-pattern/" >What is design pattern?</a> first, even if it is trivial. I believe it will encourage you to explore more on this topic.</li>
<li>All of this code you encounter in this series of articles are compiled using C++20(though I have used <a href="/posts//21-new-features-of-modern-cpp-to-use-in-your-project/" >Modern C++</a> features up to C++17 in most cases). So if you don&rsquo;t have access to the latest compiler you can use <a href="https://wandbox.org/"  class="external-link" target="_blank" rel="noopener">https://wandbox.org/</a> which has preinstalled boost library as well.</li>
</ul>
<h2 id="intent">
  Intent
  <a class="heading-link" href="#intent">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<blockquote>
<p><strong><em>To create a new object cheaply with the help of an already constructed or pre-initialized stored object.</em></strong></p>
</blockquote>
<p><img src="/images/Prototype-Design-Pattern-Cell-Division-Vishal-Chovatiya.png"></p>
<ul>
<li>The prototype provides flexibility to create complex object cheaply. The concept is to copy an existing object rather than creating a new instance from scratch, something that may include costly operations.</li>
<li>The existing object then acts as a prototype &amp; newly copied object may change the same properties only if required. This approach saves costly resources and time, especially when the object creation is a heavy process.</li>
<li>So essentially the prototype is quite simply a partially or fully initialized object that you make a copy of. And then you subsequently use for your own benefit with variations.</li>
</ul>
<h2 id="motivation">
  Motivation
  <a class="heading-link" href="#motivation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Office</span> {
</span></span><span style="display:flex;"><span>	string 	    m_street;
</span></span><span style="display:flex;"><span>	string 	    m_city;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int32_t</span> 	    m_cubical;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Office(string s, string c, <span style="color:#66d9ef">int32_t</span> n)<span style="color:#f92672">:</span>m_street(s), m_city(c), m_cubical(n){}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Employee</span> {
</span></span><span style="display:flex;"><span>    string      m_name;
</span></span><span style="display:flex;"><span>    Office		m_office;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Employee(string n,  Office o)<span style="color:#f92672">:</span>m_name(n), m_office(o){}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	Employee john{ <span style="color:#e6db74">&#34;John Doe&#34;</span>, Office{<span style="color:#e6db74">&#34;123 East Dr&#34;</span>, <span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#ae81ff">123</span>} };
</span></span><span style="display:flex;"><span>    Employee jane{ <span style="color:#e6db74">&#34;Jane Doe&#34;</span>, Office{<span style="color:#e6db74">&#34;123 East Dr&#34;</span>, <span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#ae81ff">124</span>} };
</span></span><span style="display:flex;"><span>	Employee jack{ <span style="color:#e6db74">&#34;jack Doe&#34;</span>, Office{<span style="color:#e6db74">&#34;123 ORR&#34;</span>, <span style="color:#e6db74">&#34;Bangaluru&#34;</span>, <span style="color:#ae81ff">300</span>} };
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>This is not the right approach as you have to write the main office address again &amp; again for each employee detail. This is cumbersome &amp; become more when you want to create an employee list. Moreover, consider the situation when your main office moved to another address.</li>
</ul>
<h2 id="prototype-design-pattern-examples-in-c">
  Prototype Design Pattern Examples in C++
  <a class="heading-link" href="#prototype-design-pattern-examples-in-c">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>A more pragmatic approach would be like this :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Employee</span> {
</span></span><span style="display:flex;"><span>    string          m_name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> Office<span style="color:#f92672">*</span>   m_office;    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    Employee(string n,  Office <span style="color:#f92672">*</span>o)<span style="color:#f92672">:</span>m_name(n), m_office(o){}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> Office   LondonOffice{<span style="color:#e6db74">&#34;123 East Dr&#34;</span>, <span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#ae81ff">123</span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> Office   BangaluruOffice{<span style="color:#e6db74">&#34;RMZ Ecoworld ORR&#34;</span>, <span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#ae81ff">123</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	Employee john{ <span style="color:#e6db74">&#34;John Doe&#34;</span>, <span style="color:#f92672">&amp;</span>LondonOffice };
</span></span><span style="display:flex;"><span>    Employee jane{ <span style="color:#e6db74">&#34;Jane Doe&#34;</span>, <span style="color:#f92672">&amp;</span>LondonOffice };
</span></span><span style="display:flex;"><span>	Employee jack{ <span style="color:#e6db74">&#34;jack Doe&#34;</span>, <span style="color:#f92672">&amp;</span>BangaluruOffice };
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Above solution is suitable for our use case but sometimes we want to customize that office address. And when it comes to pointers &amp; references and any sort of indirection, ordinary copying using operator equals quite simply does not work.</li>
<li>A standard way to implement this is by implementing the <a href="/posts/all-about-copy-constructor-in-cpp-with-example/" >copy constructor</a></li>
</ul>
<h3 id="prototype-factory">
  Prototype Factory
  <a class="heading-link" href="#prototype-factory">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>So in the previous example of the Prototype Design Pattern, we basically had a global <a href="/posts/memory-layout-of-cpp-object/" >object</a> for office addresses and used their address for creating prototypes.</li>
<li>Now, this isn&rsquo;t particularly convenient to the consumers of your API because you might want to give them a prototype to work with. And you should explicit enough in terms of letting people know there is the only a unified way by which they create instances from a prototype and so that they cannot make individual instances by themselves.</li>
<li>And in this case, what you would build is off-course is a Prototype Factory:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Office</span> {
</span></span><span style="display:flex;"><span>    string      m_street;
</span></span><span style="display:flex;"><span>    string      m_city;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int32_t</span>     m_cubical;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Employee</span> {
</span></span><span style="display:flex;"><span>    string      m_name;
</span></span><span style="display:flex;"><span>    Office<span style="color:#f92672">*</span>     m_office;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Private constructor, so direct instance can not be created except for `class EmployeeFactory`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Employee(string n, Office <span style="color:#f92672">*</span>o) <span style="color:#f92672">:</span> m_name(n), m_office(o) {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">friend</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeFactory</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Employee(<span style="color:#66d9ef">const</span> Employee <span style="color:#f92672">&amp;</span>rhs) <span style="color:#f92672">:</span> m_name{rhs.m_name}, m_office{<span style="color:#66d9ef">new</span> Office{<span style="color:#f92672">*</span>rhs.m_office}} 
</span></span><span style="display:flex;"><span>    { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Employee<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Employee <span style="color:#f92672">&amp;</span>rhs) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span> <span style="color:#f92672">==</span> <span style="color:#f92672">&amp;</span>rhs) <span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>        m_name <span style="color:#f92672">=</span> rhs.m_name;
</span></span><span style="display:flex;"><span>        m_office <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Office{<span style="color:#f92672">*</span>rhs.m_office};
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">friend</span> ostream <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(ostream <span style="color:#f92672">&amp;</span>os, <span style="color:#66d9ef">const</span> Employee <span style="color:#f92672">&amp;</span>o) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> os <span style="color:#f92672">&lt;&lt;</span> o.m_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; works at &#34;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;&lt;</span> o.m_office<span style="color:#f92672">-&gt;</span>m_street <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">&lt;&lt;</span> o.m_office<span style="color:#f92672">-&gt;</span>m_city <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; seats @&#34;</span> <span style="color:#f92672">&lt;&lt;</span> o.m_office<span style="color:#f92672">-&gt;</span>m_cubical;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeFactory</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> Employee     main;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> Employee     aux;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> unique_ptr<span style="color:#f92672">&lt;</span>Employee<span style="color:#f92672">&gt;</span> NewEmployee(string n, <span style="color:#66d9ef">int32_t</span> c, Employee <span style="color:#f92672">&amp;</span>proto) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> e <span style="color:#f92672">=</span> make_unique<span style="color:#f92672">&lt;</span>Employee<span style="color:#f92672">&gt;</span>(proto);
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">-&gt;</span>m_name <span style="color:#f92672">=</span> n;
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">-&gt;</span>m_office<span style="color:#f92672">-&gt;</span>m_cubical <span style="color:#f92672">=</span> c;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> e;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> unique_ptr<span style="color:#f92672">&lt;</span>Employee<span style="color:#f92672">&gt;</span> NewMainOfficeEmployee(string name, <span style="color:#66d9ef">int32_t</span> cubical) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewEmployee</span>(name, cubical, main);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> unique_ptr<span style="color:#f92672">&lt;</span>Employee<span style="color:#f92672">&gt;</span> NewAuxOfficeEmployee(string name, <span style="color:#66d9ef">int32_t</span> cubical) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewEmployee</span>(name, cubical, aux);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Static Member Initialization 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Employee EmployeeFactory<span style="color:#f92672">::</span>main{<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#66d9ef">new</span> Office{<span style="color:#e6db74">&#34;123 East Dr&#34;</span>, <span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#ae81ff">123</span>}};
</span></span><span style="display:flex;"><span>Employee EmployeeFactory<span style="color:#f92672">::</span>aux{<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#66d9ef">new</span> Office{<span style="color:#e6db74">&#34;RMZ Ecoworld ORR&#34;</span>, <span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#ae81ff">123</span>}};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> jane <span style="color:#f92672">=</span> EmployeeFactory<span style="color:#f92672">::</span>NewMainOfficeEmployee(<span style="color:#e6db74">&#34;Jane Doe&#34;</span>, <span style="color:#ae81ff">125</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> jack <span style="color:#f92672">=</span> EmployeeFactory<span style="color:#f92672">::</span>NewAuxOfficeEmployee(<span style="color:#e6db74">&#34;jack Doe&#34;</span>, <span style="color:#ae81ff">123</span>);
</span></span><span style="display:flex;"><span>    cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#f92672">*</span>jane <span style="color:#f92672">&lt;&lt;</span> endl <span style="color:#f92672">&lt;&lt;</span> <span style="color:#f92672">*</span>jack <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Jane Doe works at 123 East Dr London seats @125
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">jack Doe works at RMZ Ecoworld ORR London seats @123
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><ul>
<li>The subtle thing to note here is the private constructor of <code>Employee</code> &amp; <code>friend EmployeeFactory</code>. This is how we enforce the client/API-user to create an instance of <code>Employee</code> only through <code>EmployeeFactory</code> .</li>
</ul>
<h3 id="leveraging-prototype-design-pattern-to-implement-virtual-copy-constructor">
  Leveraging Prototype Design Pattern to Implement Virtual Copy Constructor
  <a class="heading-link" href="#leveraging-prototype-design-pattern-to-implement-virtual-copy-constructor">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>In C++, Prototype is also useful to create a copy of an object without knowing its concrete type. Hence, it is also known as Virtual Copy Constructor.</li>
</ul>
<h4 id="problem">
  Problem
  <a class="heading-link" href="#problem">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<ul>
<li>C++ has the support of polymorphic object destruction using it&rsquo;s base class&rsquo;s <a href="/posts/part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/" >virtual destructor</a>. Equivalent support for creation and copying of objects is missing as С++ doesn&rsquo;t support virtual constructor &amp; virtual <a href="/posts/all-about-copy-constructor-in-cpp-with-example/" >copy constructors</a>.</li>
<li>Moreover, you can&rsquo;t create an object unless you know its static type, because the compiler must know the amount of space it needs to allocate. For the same reason, copy of an object also requires its type to known at compile-time.</li>
<li>Consider the following example as problem statement:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">animal</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>animal(){ cout<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">&#34;~animal</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">dog</span> <span style="color:#f92672">:</span> animal {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>dog(){ cout<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">&#34;~dog</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">:</span> animal {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>cat(){ cout<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">&#34;~cat</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">who_am_i</span>(animal <span style="color:#f92672">*</span>who) { <span style="color:#75715e">// not sure whether dog would be passed here or cat
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// How to `create` the object of same type i.e. pointed by who ?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// How to `copy` object of same type i.e. pointed by who ?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">delete</span> who; <span style="color:#75715e">// you can delete appropriate object pointed by who, thanks to virtual destructor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><ul>
<li>Just don&rsquo;t think of <a href="/posts/cpp-type-casting-with-example-for-c-developers/" >dynamic_cast&lt;&gt;</a>, its code smell.</li>
</ul>
<h4 id="solution">
  Solution
  <a class="heading-link" href="#solution">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<ul>
<li>The Virtual Constructor/Copy-Constructor technique allows polymorphic creation &amp; copying of objects in C++ by delegating the act of creation &amp; copying the object to the derived class through the use of virtual methods.</li>
<li>Following code is not only implements virtual <a href="/posts/all-about-copy-constructor-in-cpp-with-example/" >copy constructor</a> (i.e. <code>clone()) but also implement virtual constructor(i.e. </code>create()`.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">animal</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>animal() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>unique_ptr<span style="color:#f92672">&lt;</span>animal<span style="color:#f92672">&gt;</span> create() <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>unique_ptr<span style="color:#f92672">&lt;</span>animal<span style="color:#f92672">&gt;</span> clone() <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">dog</span> <span style="color:#f92672">:</span> animal {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>unique_ptr<span style="color:#f92672">&lt;</span>animal<span style="color:#f92672">&gt;</span> create() { <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>make_unique<span style="color:#f92672">&lt;</span>dog<span style="color:#f92672">&gt;</span>(); }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>unique_ptr<span style="color:#f92672">&lt;</span>animal<span style="color:#f92672">&gt;</span> clone() { <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>make_unique<span style="color:#f92672">&lt;</span>dog<span style="color:#f92672">&gt;</span>(<span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>); }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">:</span> animal {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>unique_ptr<span style="color:#f92672">&lt;</span>animal<span style="color:#f92672">&gt;</span> create() { <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>make_unique<span style="color:#f92672">&lt;</span>cat<span style="color:#f92672">&gt;</span>(); }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>unique_ptr<span style="color:#f92672">&lt;</span>animal<span style="color:#f92672">&gt;</span> clone() { <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>make_unique<span style="color:#f92672">&lt;</span>cat<span style="color:#f92672">&gt;</span>(<span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>); }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">who_am_i</span>(animal <span style="color:#f92672">*</span>who) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> new_who <span style="color:#f92672">=</span> who<span style="color:#f92672">-&gt;</span>create();<span style="color:#75715e">// `create` the object of same type i.e. pointed by who ?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> duplicate_who <span style="color:#f92672">=</span> who<span style="color:#f92672">-&gt;</span>clone(); <span style="color:#75715e">// `copy` object of same type i.e. pointed by who ?    
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">delete</span> who; 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="benefits-of-prototype-design-pattern">
  Benefits of Prototype Design Pattern
  <a class="heading-link" href="#benefits-of-prototype-design-pattern">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ol>
<li>Prototypes are useful when the object instantiation is expensive, thus avoid expensive &ldquo;creation from scratch&rdquo;, and support cheap cloning of a pre-initialized prototype.</li>
<li>The prototype provides the flexibility to create highly dynamic systems by defining new behaviour through object <a href="https://stackoverflow.com/questions/50113353/differentiating-composition-and-aggregation-programmatically"  class="external-link" target="_blank" rel="noopener">composition</a> &amp; specifying values for an object&rsquo;s data members at the time of instantiation unlike defining new classes.</li>
<li>You can simplify the system by producing complex objects more conveniently.</li>
<li>Especially in C++, Prototype Design Pattern is helpful in creating copy of an object without even knowing its type.</li>
</ol>
<h2 id="summary-by-faqs">
  Summary by FAQs
  <a class="heading-link" href="#summary-by-faqs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>What&rsquo;s the point of using the Prototype Design Pattern?</strong></p>
<ul>
<li>To create an object rapidly based on cloning a pre-configured object.</li>
<li>Useful to remove a bunch of boilerplate code.</li>
<li>Handly while working with object without knowing its type.</li>
<li>Prototype Design Pattern is an obvious choice while you are working with the <a href="/posts/command-design-pattern-in-modern-cpp/" >Command Design Pattern</a>. For example, in HTTP request most of the time header &amp; footer content remains the same, what changes are data. In such a scenario, you should not create an object from scratch. Rather leverage Prototype Design Pattern.</li>
</ul>
<p><strong>Is the Prototype Design Pattern Really Just Clone?</strong></p>
<p>It isn&rsquo;t if you combine it with the <a href="/posts/factory-design-pattern-in-modern-cpp/" >Factory Design Pattern</a>.</p>
<p><strong>Prototype design pattern to be used when creation is costly, but we do create in the clone.</strong></p>
<p>You must be wondering that in Prototype Factory we show above, we are creating instances in the copy constructor. Isn&rsquo;t that expensive. Yes, it is. But just think about HTTP request, its header consist version, encoding type, content type, server-type, etc. Initially, you need a find out these parameters using respective function calls. But once you got these, these are not going to change until connection closed. So there is no point in doing function calls to extract these params over &amp; over. What cost us here is not parameters but their functions to extract value.</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Vishal Chovatiya 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
