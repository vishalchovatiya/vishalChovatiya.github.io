<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Double Dispatch : Visitor Design Pattern in Modern C&#43;&#43; · Vishal Chovatiya
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Vishal Chovatiya">
<meta name="description" content="In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy &amp; loosely coupled. In this article of the design pattern series, we&rsquo;re going to take a look at Visitor Design Pattern in Modern C&#43;&#43; which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy.">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Double Dispatch : Visitor Design Pattern in Modern C&#43;&#43;">
  <meta name="twitter:description" content="In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy &amp; loosely coupled. In this article of the design pattern series, we’re going to take a look at Visitor Design Pattern in Modern C&#43;&#43; which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy.">

<meta property="og:url" content="http://localhost:1313/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/">
  <meta property="og:site_name" content="Vishal Chovatiya">
  <meta property="og:title" content="Double Dispatch : Visitor Design Pattern in Modern C&#43;&#43;">
  <meta property="og:description" content="In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy &amp; loosely coupled. In this article of the design pattern series, we’re going to take a look at Visitor Design Pattern in Modern C&#43;&#43; which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-04-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-04-02T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">








 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>




<body class="preload-transitions colorscheme-light">
  

  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Vishal Chovatiya
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Latest</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/pages/start-here">Start Here</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/cpp/">C/C&#43;&#43;</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/linux-system-programming/">Linux System Programming</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/misc/">Misc</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/">
              Double Dispatch : Visitor Design Pattern in Modern C&#43;&#43;
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2020-04-02T00:00:00Z">
                April 2, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              10-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/cpp/">Cpp</a>
      <span class="separator">•</span>
    <a href="/categories/design-patterns/">Design-Patterns</a>
      <span class="separator">•</span>
    <a href="/categories/software-engineering/">Software-Engineering</a></div>

          
        </div>
      </header>

      <div class="post-content">
        
          <img src="/images/Visitor-Design-Pattern-in-Modern-C-vishal-chovatiya.png" alt="Featured image"/>
        
        <p>In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy &amp; loosely coupled. In this article of the design pattern series, we&rsquo;re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is <strong><em>used to perform an operation on a group of similar kind of objects or hierarchy</em></strong>. In this article, we will not only see the classical example but also leverage the <a href="https://en.cppreference.com/w/cpp/utility/variant/visit"  class="external-link" target="_blank" rel="noopener">std::visit</a> from the standard library to cut-short the implementation time of the Visitor Design Pattern.</p>
<p>By the way, If you haven’t check out my other articles on Behavioural Design Patterns, then here is the list:</p>
<ol>
<li><a href="/posts//chain-of-responsibility-design-pattern-in-modern-cpp/" >Chain of responsibility</a></li>
<li><a href="/posts//command-design-pattern-in-modern-cpp/" >Command</a></li>
<li><a href="/posts//interpreter-design-pattern-in-modern-cpp/" >Interpreter</a></li>
<li><a href="/posts//iterator-design-pattern-in-modern-cpp/" >Iterator</a></li>
<li><a href="/posts//mediator-design-pattern-in-modern-cpp/" >Mediator</a></li>
<li><a href="/posts//memento-design-pattern-in-modern-cpp/" >Memento</a></li>
<li><a href="/posts//observer-design-pattern-in-modern-cpp/" >Observer</a></li>
<li><a href="/posts//state-design-pattern-in-modern-cpp/" >State</a></li>
<li><a href="/posts//strategy-design-pattern-in-modern-cpp/" >Strategy</a></li>
<li><a href="/posts//template-method-design-pattern-in-modern-cpp/" >Template Method</a></li>
<li><a href="/posts//double-dispatch-visitor-design-pattern-in-modern-cpp/" >Visitor</a></li>
</ol>
<p>The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like <code>override</code>, <code>final</code>, <code>public</code>(while inheritance) just to make code compact &amp; consumable(most of the time) in single standard screen size. I also prefer <code>struct</code> instead of <code>class</code> just to save line by not writing &ldquo;<code>public:</code>&rdquo; sometimes and also miss <a href="/posts//part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/" >virtual destructor</a>, constructor, <a href="/posts//all-about-copy-constructor-in-cpp-with-example/" >copy constructor</a>, prefix <code>std::</code>, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.</p>
<p><strong><em>Note:</em></strong></p>
<ul>
<li>If you stumbled here directly, then I would suggest you go through <a href="/posts//what-is-design-pattern/" >What is design pattern?</a> first, even if it is trivial. I believe it will encourage you to explore more on this topic.</li>
<li>All of this code you encounter in this series of articles are compiled using C++20(though I have used <a href="/posts//21-new-features-of-modern-cpp-to-use-in-your-project/" >Modern C++</a> features up to C++17 in most cases). So if you don&rsquo;t have access to the latest compiler you can use <a href="https://wandbox.org/"  class="external-link" target="_blank" rel="noopener">https://wandbox.org/</a> which has preinstalled boost library as well.</li>
</ul>
<h2 id="intent">
  Intent
  <a class="heading-link" href="#intent">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<blockquote>
<p><strong><em>To define a new operation on a group of similar kind of objects or hierarchy.</em></strong></p>
</blockquote>
<ul>
<li>The classical Visitor Design Pattern has some component which we call a visitor. That is allowed to traverse the entire inheritance hierarchy. But before that what you have to do is you have to implement a single method called <code>visit()</code>in the entire hierarchy once.</li>
<li>And from then on you don&rsquo;t have to touch the hierarchy anymore. So the hierarchy can exist on its own and you can create extra visitors sort of thing on the side which is perfectly consistent with both the <a href="/posts/open-closed-principle-in-cpp-solid-as-a-rock/" >Open-Closed Principle</a> as well as the <a href="/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/" >Single Responsibility Principle</a>.</li>
</ul>
<h2 id="visitor-design-pattern-examples-in-c">
  Visitor Design Pattern Examples in C++
  <a class="heading-link" href="#visitor-design-pattern-examples-in-c">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>This is a reasonably complex design pattern &amp; I do not want to confuse you by directly jumping on example. So we will come to the Visitor Design Pattern by exploring other available option. And then you will understand the importance of visitor despite the complexity.</li>
</ul>
<h3 id="intrusive-visitor">
  Intrusive Visitor
  <a class="heading-link" href="#intrusive-visitor">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>Let&rsquo;s suppose that you have a hierarchy of documents as follows:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Markdown</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">HTML</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    string          m_end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;/li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><ul>
<li>And you need to define some new operation on existing infrastructure. For example, we have a <code>Document</code> class as above and now you want that different documents(i.e. <code>HTML</code> &amp; <code>Markdown</code>) to be printable.</li>
<li>So you have this brand new concern of printing and you want to somehow propagate this through the entire hierarchy by making essentially every single class of your document to be independently printable somehow.</li>
<li>Now what you don&rsquo;t want to do is you don&rsquo;t want to go back into the existing code and modify each class(with new <a href="/posts/part-1-all-about-virtual-keyword-in-cpp-how-virtual-function-works-internally/" >virtual function</a>) in the hierarchy every time you have a new concern, because, unfortunately, this breaks an <a href="/posts/open-closed-principle-in-cpp-solid-as-a-rock/" >Open-Closed Principle</a>, rather we should use inheritance.</li>
<li>There&rsquo;s also the <a href="/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/" >Single Responsibility Principle</a> that you have to adhere to because if you are introducing a brand new concern such as printing then that should be a separate class. But still, let say we will do it:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span>() <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Markdown</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : m_content) 
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">HTML</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span>() {
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : m_content) {
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> m_end <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;/ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    string          m_end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;/li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Document <span style="color:#f92672">*</span>d <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HTML;
</span></span><span style="display:flex;"><span>    d<span style="color:#f92672">-&gt;</span>add_to_list(<span style="color:#e6db74">&#34;This is line&#34;</span>);
</span></span><span style="display:flex;"><span>    d<span style="color:#f92672">-&gt;</span>print();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>As you can see for only 2-3 class it&rsquo;s good even if it is violating some SOLID principles. But imagine if you have 20 classes as part of this hierarchy. It would be really difficult to go into 20 different files &amp; add a print method for every one of them.</li>
<li>Moreover, if there is more than one concern like save, process, etc., this approach becomes cumbersome. It would be much nicer to have each concern in a separate class that also goes towards the <a href="/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/" >Single Responsibility Principle</a>.</li>
</ul>
<h3 id="reflective-visitor">
  Reflective Visitor
  <a class="heading-link" href="#reflective-visitor">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Markdown</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">HTML</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    string          m_end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;/li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DocumentPrinter</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span>(Document <span style="color:#f92672">*</span>e) {        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">auto</span> md <span style="color:#f92672">=</span> <span style="color:#66d9ef">dynamic_cast</span><span style="color:#f92672">&lt;</span>Markdown <span style="color:#f92672">*&gt;</span>(e)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : md<span style="color:#f92672">-&gt;</span>m_content)
</span></span><span style="display:flex;"><span>                cout <span style="color:#f92672">&lt;&lt;</span> md<span style="color:#f92672">-&gt;</span>m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">auto</span> hd <span style="color:#f92672">=</span> <span style="color:#66d9ef">dynamic_cast</span><span style="color:#f92672">&lt;</span>HTML <span style="color:#f92672">*&gt;</span>(e)) {
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : hd<span style="color:#f92672">-&gt;</span>m_content) {
</span></span><span style="display:flex;"><span>                cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> hd<span style="color:#f92672">-&gt;</span>m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> hd<span style="color:#f92672">-&gt;</span>m_end <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;/ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Document <span style="color:#f92672">*</span>d <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HTML;
</span></span><span style="display:flex;"><span>    d<span style="color:#f92672">-&gt;</span>add_to_list(<span style="color:#e6db74">&#34;This is line&#34;</span>);
</span></span><span style="display:flex;"><span>    DocumentPrinter<span style="color:#f92672">::</span>print(d);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>As mentioned above, we created a separate class having printing functionality for the entire hierarchy just to adhere <a href="/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/" >Single Responsibility Principle</a>. But in this approach, we have to identify types for a particular class(using <a href="/posts/cpp-type-casting-with-example-for-c-developers/" ><code>dynamic_cast&lt;&gt;()</code></a>) as we have to work on individual <a href="/posts/memory-layout-of-cpp-object/" >object</a> of hierarchy independently.</li>
<li>This is not an approach which scales efficiently, especially as you expand the set of classes that you&rsquo;re processing, you will end up having a long list of <code>if/else-if</code> along with paying performance cost on <a href="https://en.wikipedia.org/wiki/Run-time_type_information"  class="external-link" target="_blank" rel="noopener">RTTI</a>.</li>
</ul>
<h3 id="classic-visitor">
  Classic Visitor
  <a class="heading-link" href="#classic-visitor">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>So far the approaches that have been sort of half measures what we really want is we really want a mechanism that will allow us to extend the entire hierarchies functionality in various different ways without being intrusive and certainly without having massive <code>if/else-if</code> statements full of <a href="/posts/cpp-type-casting-with-example-for-c-developers/" ><code>dynamic_cast&lt;&gt;()</code></a> in them.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">/* --------------------------- Added Visitor Classes ----------------------------- */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DocumentVisitor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Markdown</span><span style="color:#f92672">*</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HTML</span><span style="color:#f92672">*</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DocumentPrinter</span> <span style="color:#f92672">:</span> DocumentVisitor {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Markdown</span><span style="color:#f92672">*</span> md);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HTML</span><span style="color:#f92672">*</span> hd);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* -------------------------------------------------------------------------------- */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(DocumentVisitor<span style="color:#f92672">*</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;--------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Markdown</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(DocumentVisitor<span style="color:#f92672">*</span> dv) { dv<span style="color:#f92672">-&gt;</span>visit(<span style="color:#66d9ef">this</span>); } <span style="color:#75715e">// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;---------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">HTML</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(DocumentVisitor<span style="color:#f92672">*</span> dv) { dv<span style="color:#f92672">-&gt;</span>visit(<span style="color:#66d9ef">this</span>); } <span style="color:#75715e">// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;---------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    string          m_end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;/li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* -------------------------- Added Visitor Methods ------------------------------- */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> DocumentPrinter<span style="color:#f92672">::</span>visit(Markdown<span style="color:#f92672">*</span> md) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : md<span style="color:#f92672">-&gt;</span>m_content)
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> md<span style="color:#f92672">-&gt;</span>m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> DocumentPrinter<span style="color:#f92672">::</span>visit(HTML<span style="color:#f92672">*</span> hd) {
</span></span><span style="display:flex;"><span>    cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : hd<span style="color:#f92672">-&gt;</span>m_content) 
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> hd<span style="color:#f92672">-&gt;</span>m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> hd<span style="color:#f92672">-&gt;</span>m_end <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;/ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* -------------------------------------------------------------------------------- */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Document <span style="color:#f92672">*</span>d <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HTML;
</span></span><span style="display:flex;"><span>    d<span style="color:#f92672">-&gt;</span>add_to_list(<span style="color:#e6db74">&#34;This is line&#34;</span>);
</span></span><span style="display:flex;"><span>    d<span style="color:#f92672">-&gt;</span>visit(<span style="color:#66d9ef">new</span> DocumentPrinter);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>So as you can see we have added two-layer of indirection to achieve what we wanted without violating the <a href="/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/" >Single Responsibility Principle</a> &amp; <a href="/posts/open-closed-principle-in-cpp-solid-as-a-rock/" >Open-Closed Principle</a>. Thanks to Double Dispatch in C++[TODO].</li>
<li>If you see all the classes involved in the process, it may seem a bit complicated. But call stack may help you to understand it easily.</li>
</ul>
<p><img src="/images/Double-Dispatch-in-C-Visitor-Design-Pattern-www_vishalhovatiy_com-1024x659.png"></p>
<ul>
<li>From <code>d-&gt;visit(new DocumentPrinter)</code>, we call <code>visit()</code>method, which will dispatch to the appropriate overridden visit i.e. `HTML::visit(DocumentVisitor* dv).</li>
<li>From the overridden <code>HTML::visit(DocumentVisitor*)</code>, we call <code>dv-&gt;visit(this)</code>, which will again dispatch to the appropriate overridden method(considering the type of <code>this</code> pointer) i.e. <code>DocumentPrinter::visit(HTML*)</code>.</li>
</ul>
<h2 id="visitor-design-pattern-in-modern-c">
  Visitor Design Pattern in Modern C++
  <a class="heading-link" href="#visitor-design-pattern-in-modern-c">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Markdown</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">HTML</span> <span style="color:#f92672">:</span> Document {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_to_list</span>(<span style="color:#66d9ef">const</span> string <span style="color:#f92672">&amp;</span>line) { m_content.push_back(line); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string          m_start <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    string          m_end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;/li&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>    m_content;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* ------------------------------------ Visitor ------------------------------------- */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DocumentPrinter</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">operator</span>()(Markdown <span style="color:#f92672">&amp;</span>md) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : md.m_content)
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> md.m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">operator</span>()(HTML <span style="color:#f92672">&amp;</span>hd){
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;&amp;</span>item : hd.m_content)
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> hd.m_start <span style="color:#f92672">&lt;&lt;</span> item <span style="color:#f92672">&lt;&lt;</span> hd.m_end <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;&lt;/ul&gt;&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* ---------------------------------------------------------------------------------- */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> document <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>variant<span style="color:#f92672">&lt;</span>Markdown, HTML<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    HTML hd;
</span></span><span style="display:flex;"><span>    hd.add_to_list(<span style="color:#e6db74">&#34;This is line&#34;</span>);
</span></span><span style="display:flex;"><span>    document d <span style="color:#f92672">=</span> hd;
</span></span><span style="display:flex;"><span>    DocumentPrinter dp;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>visit(dp, d);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>So for those of you who are not familiar with the <code>std::variant</code>, you can consider it as a union(a type-safe union). And line <code>std::variant&lt;Markdown, HTML&gt;</code>, suggest that you can use/assign/access either <code>Markdown</code> or <code>HTML</code> at a time.</li>
<li>And <a href="/posts/21-new-features-of-modern-cpp-to-use-in-your-project/" >Modern C++</a> provides us <code>std::visit</code> which accept callable i.e. <code>DocumentPrinter</code> in our case having overloaded function operator and <code>std::variant</code> as the second argument. You also make use of <a href="/posts/learn-lambda-function-in-cpp-with-example/" >lambda functions</a> rather using functor i.e. <code>DocumentPrinter</code>.</li>
</ul>
<h2 id="benefits-of-visitor-design-pattern">
  Benefits of Visitor Design Pattern
  <a class="heading-link" href="#benefits-of-visitor-design-pattern">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ol>
<li>Adhering <a href="/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/" >Single Responsibility Principle</a> meaning separating type-specific logic in the separate entity/class. In our case, <code>DocumentPrinter</code> only handles the printing for different document types.</li>
<li>Adhering <a href="/posts/open-closed-principle-in-cpp-solid-as-a-rock/" >Open-Closed Principle</a> meaning new functionality can be added without touching any class headers once we inserted <code>visit()</code> method for hierarchy, For example, if you want to add <code>scan()</code>method for each different Document, you can create <code>DocumentScanner</code> &amp; rest of the edit goes as same <code>DocumentPrinter</code>.</li>
<li>This will be much useful when you already have done the unit-testing for your entire hierarchy. Now you do not want to touch that &amp; wants to add new functionality.</li>
<li>Performance over <code>dynamic_cast</code>, <code>typeid()</code>and check for <code>enum</code>/<code>string</code> comparison.</li>
</ol>
<h2 id="summary-by-faqs">
  Summary by FAQs
  <a class="heading-link" href="#summary-by-faqs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>When should I use the Visitor Design Pattern?</strong></p>
<p>Visitor Design Pattern is quite useful when your requirement keeps changing which also affects multiple classes in the inheritance hierarchy.</p>
<p><strong>What is the typical use case of the Visitor Design Pattern?</strong></p>
<ul>
<li>In replacement of <code>dynamic_cast&lt;&gt;</code>, `typeid(), etc.</li>
<li>To process the collection of different types of objects.</li>
<li>Filtering different type of objects from collections.</li>
</ul>
<p><strong>Difference between Visitor vs Decorator Design Pattern?</strong></p>
<p><a href="/posts/decorator-design-pattern-in-modern-cpp/" >Decorator</a>(Structural Design Pattern) works on an object by enhances existing functionality. While<br>
Visitor(<a href="/posts/chain-of-responsibility-design-pattern-in-modern-cpp/" >Behavioral Design Pattern</a>) works on a hierarchy of classes where you want to run different method based on concrete type but avoiding <a href="/posts/cpp-type-casting-with-example-for-c-developers/" >dynamic_cast&lt;&gt;()</a> or <a href="https://blog.toonormal.com/2014/01/25/c-typeof-vs-decltype/"  class="external-link" target="_blank" rel="noopener">typeof()</a> operators.</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Vishal Chovatiya 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
