<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Double Dispatch : Visitor Design Pattern in Modern C++ | Vishal Chovatiya</title>
<meta name=keywords content="classic-visitor,difference-between-visitor-vs-decorator-design-pattern,double-dispatch-visitor-pattern-visitor-design-pattern-in-modern-c,intrusive-visitor,reflective-visitor,use-case-of-the-visitor-design-pattern,visitor-design-pattern-c-example,visitor-design-pattern-c-stack-overflow,visitor-design-pattern-cpp,visitor-design-pattern-example,visitor-design-pattern-implementation-in-c,visitor-design-pattern-in-c,visitor-design-pattern-pros-and-cons,visitor-design-pattern-using-stdvisit-stdvariant,visitor-pattern-c,visitor-pattern-double-dispatch,when-should-i-use-the-visitor-design-pattern"><meta name=description content="In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy & loosely coupled. In this article of the design pattern series, we&rsquo;re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy."><meta name=author content="Vishal Chovatiya"><link rel=canonical href=https://vishalchovatiya.github.io/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://vishalchovatiya.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://vishalchovatiya.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://vishalchovatiya.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://vishalchovatiya.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://vishalchovatiya.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://vishalchovatiya.github.io/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Double Dispatch : Visitor Design Pattern in Modern C++"><meta property="og:description" content="In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy & loosely coupled. In this article of the design pattern series, we&rsquo;re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy."><meta property="og:type" content="article"><meta property="og:url" content="https://vishalchovatiya.github.io/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/"><meta property="og:image" content="https://vishalchovatiya.github.io/images/Visitor-Design-Pattern-in-Modern-C-vishal-chovatiya.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-02T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-02T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://vishalchovatiya.github.io/images/Visitor-Design-Pattern-in-Modern-C-vishal-chovatiya.png"><meta name=twitter:title content="Double Dispatch : Visitor Design Pattern in Modern C++"><meta name=twitter:description content="In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy & loosely coupled. In this article of the design pattern series, we&rsquo;re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://vishalchovatiya.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Double Dispatch : Visitor Design Pattern in Modern C++","item":"https://vishalchovatiya.github.io/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Double Dispatch : Visitor Design Pattern in Modern C++","name":"Double Dispatch : Visitor Design Pattern in Modern C\u002b\u002b","description":"In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy \u0026amp; loosely coupled. In this article of the design pattern series, we\u0026rsquo;re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy.","keywords":["classic-visitor","difference-between-visitor-vs-decorator-design-pattern","double-dispatch-visitor-pattern-visitor-design-pattern-in-modern-c","intrusive-visitor","reflective-visitor","use-case-of-the-visitor-design-pattern","visitor-design-pattern-c-example","visitor-design-pattern-c-stack-overflow","visitor-design-pattern-cpp","visitor-design-pattern-example","visitor-design-pattern-implementation-in-c","visitor-design-pattern-in-c","visitor-design-pattern-pros-and-cons","visitor-design-pattern-using-stdvisit-stdvariant","visitor-pattern-c","visitor-pattern-double-dispatch","when-should-i-use-the-visitor-design-pattern"],"articleBody":"In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy \u0026 loosely coupled. In this article of the design pattern series, we’re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is used to perform an operation on a group of similar kind of objects or hierarchy. In this article, we will not only see the classical example but also leverage the std::visit from the standard library to cut-short the implementation time of the Visitor Design Pattern.\nBy the way, If you haven’t check out my other articles on Behavioural Design Patterns, then here is the list:\nChain of responsibility Command Interpreter Iterator Mediator Memento Observer State Strategy Template Method Visitor The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like override, final, public(while inheritance) just to make code compact \u0026 consumable(most of the time) in single standard screen size. I also prefer struct instead of class just to save line by not writing “public:” sometimes and also miss virtual destructor, constructor, copy constructor, prefix std::, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.\nNote:\nIf you stumbled here directly, then I would suggest you go through What is design pattern? first, even if it is trivial. I believe it will encourage you to explore more on this topic. All of this code you encounter in this series of articles are compiled using C++20(though I have used Modern C++ features up to C++17 in most cases). So if you don’t have access to the latest compiler you can use https://wandbox.org/ which has preinstalled boost library as well. Intent To define a new operation on a group of similar kind of objects or hierarchy.\nThe classical Visitor Design Pattern has some component which we call a visitor. That is allowed to traverse the entire inheritance hierarchy. But before that what you have to do is you have to implement a single method called visit()in the entire hierarchy once. And from then on you don’t have to touch the hierarchy anymore. So the hierarchy can exist on its own and you can create extra visitors sort of thing on the side which is perfectly consistent with both the Open-Closed Principle as well as the Single Responsibility Principle. Visitor Design Pattern Examples in C++ This is a reasonably complex design pattern \u0026 I do not want to confuse you by directly jumping on example. So we will come to the Visitor Design Pattern by exploring other available option. And then you will understand the importance of visitor despite the complexity. Intrusive Visitor Let’s suppose that you have a hierarchy of documents as follows: struct Document { virtual void add_to_list(const string \u0026line) = 0; }; struct Markdown : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } string m_start = \"* \"; list\u003cstring\u003e m_content; }; struct HTML : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } string m_start = \"\"; string m_end = \"\"; list\u003cstring\u003e m_content; }; And you need to define some new operation on existing infrastructure. For example, we have a Document class as above and now you want that different documents(i.e. HTML \u0026 Markdown) to be printable. So you have this brand new concern of printing and you want to somehow propagate this through the entire hierarchy by making essentially every single class of your document to be independently printable somehow. Now what you don’t want to do is you don’t want to go back into the existing code and modify each class(with new virtual function) in the hierarchy every time you have a new concern, because, unfortunately, this breaks an Open-Closed Principle, rather we should use inheritance. There’s also the Single Responsibility Principle that you have to adhere to because if you are introducing a brand new concern such as printing then that should be a separate class. But still, let say we will do it: struct Document { virtual void add_to_list(const string \u0026line) = 0; virtual void print() = 0; }; struct Markdown : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } void print() { for (auto \u0026\u0026item : m_content) cout \u003c\u003c m_start \u003c\u003c item \u003c\u003c endl; } string m_start = \"* \"; list\u003cstring\u003e m_content; }; struct HTML : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } void print() { cout \u003c\u003c \"\" \u003c\u003c endl; for (auto \u0026\u0026item : m_content) { cout \u003c\u003c \"\\t\" \u003c\u003c m_start \u003c\u003c item \u003c\u003c m_end \u003c\u003c endl; } cout \u003c\u003c \"\" \u003c\u003c endl; } string m_start = \"\"; string m_end = \"\"; list\u003cstring\u003e m_content; }; int main() { Document *d = new HTML; d-\u003eadd_to_list(\"This is line\"); d-\u003eprint(); return EXIT_SUCCESS; } As you can see for only 2-3 class it’s good even if it is violating some SOLID principles. But imagine if you have 20 classes as part of this hierarchy. It would be really difficult to go into 20 different files \u0026 add a print method for every one of them. Moreover, if there is more than one concern like save, process, etc., this approach becomes cumbersome. It would be much nicer to have each concern in a separate class that also goes towards the Single Responsibility Principle. Reflective Visitor struct Document { virtual void add_to_list(const string \u0026line) = 0; }; struct Markdown : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } string m_start = \"* \"; list\u003cstring\u003e m_content; }; struct HTML : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } string m_start = \"\"; string m_end = \"\"; list\u003cstring\u003e m_content; }; struct DocumentPrinter { static void print(Document *e) { if (auto md = dynamic_cast\u003cMarkdown *\u003e(e)) { for (auto \u0026\u0026item : md-\u003em_content) cout \u003c\u003c md-\u003em_start \u003c\u003c item \u003c\u003c endl; } else if (auto hd = dynamic_cast\u003cHTML *\u003e(e)) { cout \u003c\u003c \"\" \u003c\u003c endl; for (auto \u0026\u0026item : hd-\u003em_content) { cout \u003c\u003c \"\\t\" \u003c\u003c hd-\u003em_start \u003c\u003c item \u003c\u003c hd-\u003em_end \u003c\u003c endl; } cout \u003c\u003c \"\" \u003c\u003c endl; } } }; int main() { Document *d = new HTML; d-\u003eadd_to_list(\"This is line\"); DocumentPrinter::print(d); return EXIT_SUCCESS; } As mentioned above, we created a separate class having printing functionality for the entire hierarchy just to adhere Single Responsibility Principle. But in this approach, we have to identify types for a particular class(using dynamic_cast\u003c\u003e()) as we have to work on individual object of hierarchy independently. This is not an approach which scales efficiently, especially as you expand the set of classes that you’re processing, you will end up having a long list of if/else-if along with paying performance cost on RTTI. Classic Visitor So far the approaches that have been sort of half measures what we really want is we really want a mechanism that will allow us to extend the entire hierarchies functionality in various different ways without being intrusive and certainly without having massive if/else-if statements full of dynamic_cast\u003c\u003e() in them. /* --------------------------- Added Visitor Classes ----------------------------- */ struct DocumentVisitor { virtual void visit(class Markdown*) = 0; virtual void visit(class HTML*) = 0; }; struct DocumentPrinter : DocumentVisitor { void visit(class Markdown* md); void visit(class HTML* hd); }; /* -------------------------------------------------------------------------------- */ struct Document { virtual void add_to_list(const string \u0026line) = 0; virtual void visit(DocumentVisitor*) = 0; // \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c-------------------------- }; struct Markdown : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } void visit(DocumentVisitor* dv) { dv-\u003evisit(this); } // \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c--------------- string m_start = \"* \"; list\u003cstring\u003e m_content; }; struct HTML : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } void visit(DocumentVisitor* dv) { dv-\u003evisit(this); } // \u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c--------------- string m_start = \"\"; string m_end = \"\"; list\u003cstring\u003e m_content; }; /* -------------------------- Added Visitor Methods ------------------------------- */ void DocumentPrinter::visit(Markdown* md) { for (auto \u0026\u0026item : md-\u003em_content) cout \u003c\u003c md-\u003em_start \u003c\u003c item \u003c\u003c endl; } void DocumentPrinter::visit(HTML* hd) { cout \u003c\u003c \"\" \u003c\u003c endl; for (auto \u0026\u0026item : hd-\u003em_content) cout \u003c\u003c \"\\t\" \u003c\u003c hd-\u003em_start \u003c\u003c item \u003c\u003c hd-\u003em_end \u003c\u003c endl; cout \u003c\u003c \"\" \u003c\u003c endl; } /* -------------------------------------------------------------------------------- */ int main() { Document *d = new HTML; d-\u003eadd_to_list(\"This is line\"); d-\u003evisit(new DocumentPrinter); return EXIT_SUCCESS; } So as you can see we have added two-layer of indirection to achieve what we wanted without violating the Single Responsibility Principle \u0026 Open-Closed Principle. Thanks to Double Dispatch in C++[TODO]. If you see all the classes involved in the process, it may seem a bit complicated. But call stack may help you to understand it easily. From d-\u003evisit(new DocumentPrinter), we call visit()method, which will dispatch to the appropriate overridden visit i.e. `HTML::visit(DocumentVisitor* dv). From the overridden HTML::visit(DocumentVisitor*), we call dv-\u003evisit(this), which will again dispatch to the appropriate overridden method(considering the type of this pointer) i.e. DocumentPrinter::visit(HTML*). Visitor Design Pattern in Modern C++ struct Document { virtual void add_to_list(const string \u0026line) = 0; }; struct Markdown : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } string m_start = \"* \"; list\u003cstring\u003e m_content; }; struct HTML : Document { void add_to_list(const string \u0026line) { m_content.push_back(line); } string m_start = \"\"; string m_end = \"\"; list\u003cstring\u003e m_content; }; /* ------------------------------------ Visitor ------------------------------------- */ struct DocumentPrinter { void operator()(Markdown \u0026md) { for (auto \u0026\u0026item : md.m_content) cout \u003c\u003c md.m_start \u003c\u003c item \u003c\u003c endl; } void operator()(HTML \u0026hd){ cout \u003c\u003c \"\" \u003c\u003c endl; for (auto \u0026\u0026item : hd.m_content) cout \u003c\u003c \"\\t\" \u003c\u003c hd.m_start \u003c\u003c item \u003c\u003c hd.m_end \u003c\u003c endl; cout \u003c\u003c \"\" \u003c\u003c endl; } }; /* ---------------------------------------------------------------------------------- */ using document = std::variant\u003cMarkdown, HTML\u003e; int main() { HTML hd; hd.add_to_list(\"This is line\"); document d = hd; DocumentPrinter dp; std::visit(dp, d); return EXIT_SUCCESS; } So for those of you who are not familiar with the std::variant, you can consider it as a union(a type-safe union). And line std::variant, suggest that you can use/assign/access either Markdown or HTML at a time. And Modern C++ provides us std::visit which accept callable i.e. DocumentPrinter in our case having overloaded function operator and std::variant as the second argument. You also make use of lambda functions rather using functor i.e. DocumentPrinter. Benefits of Visitor Design Pattern Adhering Single Responsibility Principle meaning separating type-specific logic in the separate entity/class. In our case, DocumentPrinter only handles the printing for different document types. Adhering Open-Closed Principle meaning new functionality can be added without touching any class headers once we inserted visit() method for hierarchy, For example, if you want to add scan()method for each different Document, you can create DocumentScanner \u0026 rest of the edit goes as same DocumentPrinter. This will be much useful when you already have done the unit-testing for your entire hierarchy. Now you do not want to touch that \u0026 wants to add new functionality. Performance over dynamic_cast, typeid()and check for enum/string comparison. Summary by FAQs When should I use the Visitor Design Pattern?\nVisitor Design Pattern is quite useful when your requirement keeps changing which also affects multiple classes in the inheritance hierarchy.\nWhat is the typical use case of the Visitor Design Pattern?\nIn replacement of dynamic_cast\u003c\u003e, `typeid(), etc. To process the collection of different types of objects. Filtering different type of objects from collections. Difference between Visitor vs Decorator Design Pattern?\nDecorator(Structural Design Pattern) works on an object by enhances existing functionality. While\nVisitor(Behavioral Design Pattern) works on a hierarchy of classes where you want to run different method based on concrete type but avoiding dynamic_cast\u003c\u003e() or typeof() operators.\n","wordCount":"1915","inLanguage":"en","image":"https://vishalchovatiya.github.io/images/Visitor-Design-Pattern-in-Modern-C-vishal-chovatiya.png","datePublished":"2020-04-02T00:00:00Z","dateModified":"2020-04-02T00:00:00Z","author":{"@type":"Person","name":"Vishal Chovatiya"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vishalchovatiya.github.io/posts/double-dispatch-visitor-design-pattern-in-modern-cpp/"},"publisher":{"@type":"Organization","name":"Vishal Chovatiya","logo":{"@type":"ImageObject","url":"https://vishalchovatiya.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://vishalchovatiya.github.io/ accesskey=h title="Vishal Chovatiya (Alt + H)"><img src=https://vishalchovatiya.github.io/apple-touch-icon.png alt aria-label=logo height=35>Vishal Chovatiya</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://vishalchovatiya.github.io/pages/vishal-chovatiya title="About Me"><span>About Me</span></a></li><li><a href=https://vishalchovatiya.github.io/pages/start-here title="Start Here"><span>Start Here</span></a></li><li><a href=https://vishalchovatiya.github.io/posts/ title=Latest><span>Latest</span></a></li><li><a href=https://vishalchovatiya.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://vishalchovatiya.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://vishalchovatiya.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Double Dispatch : Visitor Design Pattern in Modern C++</h1><div class=post-meta><span title='2020-04-02 00:00:00 +0000 UTC'>April 2, 2020</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1915 words&nbsp;·&nbsp;Vishal Chovatiya&nbsp;|&nbsp;<a href=https://github.com/vishalchovatiya/blog/vishalchovatiya/content/posts/double-dispatch-visitor-design-pattern-in-modern-cpp.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://vishalchovatiya.github.io/images/Visitor-Design-Pattern-in-Modern-C-vishal-chovatiya.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#intent>Intent</a></li><li><a href=#visitor-design-pattern-examples-in-c>Visitor Design Pattern Examples in C++</a><ul><li><a href=#intrusive-visitor>Intrusive Visitor</a></li><li><a href=#reflective-visitor>Reflective Visitor</a></li><li><a href=#classic-visitor>Classic Visitor</a></li></ul></li><li><a href=#visitor-design-pattern-in-modern-c>Visitor Design Pattern in Modern C++</a></li><li><a href=#benefits-of-visitor-design-pattern>Benefits of Visitor Design Pattern</a></li><li><a href=#summary-by-faqs>Summary by FAQs</a></li></ul></nav></div></details></div><div class=post-content><p>In software engineering, Behavioural Design Patterns deal with the assignment of responsibilities between objects. That in turn, make the interaction between the objects easy & loosely coupled. In this article of the design pattern series, we&rsquo;re going to take a look at Visitor Design Pattern in Modern C++ which is also known as a classic technique for recovering lost type information(using Double Dispatch[TODO]). Visitor Design Pattern is <strong><em>used to perform an operation on a group of similar kind of objects or hierarchy</em></strong>. In this article, we will not only see the classical example but also leverage the <a href=https://en.cppreference.com/w/cpp/utility/variant/visit>std::visit</a> from the standard library to cut-short the implementation time of the Visitor Design Pattern.</p><p>By the way, If you haven’t check out my other articles on Behavioural Design Patterns, then here is the list:</p><ol><li><a href=/posts//chain-of-responsibility-design-pattern-in-modern-cpp/>Chain of responsibility</a></li><li><a href=/posts//command-design-pattern-in-modern-cpp/>Command</a></li><li><a href=/posts//interpreter-design-pattern-in-modern-cpp/>Interpreter</a></li><li><a href=/posts//iterator-design-pattern-in-modern-cpp/>Iterator</a></li><li><a href=/posts//mediator-design-pattern-in-modern-cpp/>Mediator</a></li><li><a href=/posts//memento-design-pattern-in-modern-cpp/>Memento</a></li><li><a href=/posts//observer-design-pattern-in-modern-cpp/>Observer</a></li><li><a href=/posts//state-design-pattern-in-modern-cpp/>State</a></li><li><a href=/posts//strategy-design-pattern-in-modern-cpp/>Strategy</a></li><li><a href=/posts//template-method-design-pattern-in-modern-cpp/>Template Method</a></li><li><a href=/posts//double-dispatch-visitor-design-pattern-in-modern-cpp/>Visitor</a></li></ol><p>The code snippets you see throughout this series of articles are simplified not sophisticated. So you often see me not using keywords like <code>override</code>, <code>final</code>, <code>public</code>(while inheritance) just to make code compact & consumable(most of the time) in single standard screen size. I also prefer <code>struct</code> instead of <code>class</code> just to save line by not writing &ldquo;<code>public:</code>&rdquo; sometimes and also miss <a href=/posts//part-3-all-about-virtual-keyword-in-c-how-virtual-destructor-works/>virtual destructor</a>, constructor, <a href=/posts//all-about-copy-constructor-in-cpp-with-example/>copy constructor</a>, prefix <code>std::</code>, deleting dynamic memory, intentionally. I also consider myself a pragmatic person who wants to convey an idea in the simplest way possible rather than the standard way or using Jargons.</p><p><strong><em>Note:</em></strong></p><ul><li>If you stumbled here directly, then I would suggest you go through <a href=/posts//what-is-design-pattern/>What is design pattern?</a> first, even if it is trivial. I believe it will encourage you to explore more on this topic.</li><li>All of this code you encounter in this series of articles are compiled using C++20(though I have used <a href=/posts//21-new-features-of-modern-cpp-to-use-in-your-project/>Modern C++</a> features up to C++17 in most cases). So if you don&rsquo;t have access to the latest compiler you can use <a href=https://wandbox.org/>https://wandbox.org/</a> which has preinstalled boost library as well.</li></ul><h2 id=intent>Intent<a hidden class=anchor aria-hidden=true href=#intent>#</a></h2><blockquote><p><strong><em>To define a new operation on a group of similar kind of objects or hierarchy.</em></strong></p></blockquote><ul><li>The classical Visitor Design Pattern has some component which we call a visitor. That is allowed to traverse the entire inheritance hierarchy. But before that what you have to do is you have to implement a single method called <code>visit()</code>in the entire hierarchy once.</li><li>And from then on you don&rsquo;t have to touch the hierarchy anymore. So the hierarchy can exist on its own and you can create extra visitors sort of thing on the side which is perfectly consistent with both the <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a> as well as the <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a>.</li></ul><h2 id=visitor-design-pattern-examples-in-c>Visitor Design Pattern Examples in C++<a hidden class=anchor aria-hidden=true href=#visitor-design-pattern-examples-in-c>#</a></h2><ul><li>This is a reasonably complex design pattern & I do not want to confuse you by directly jumping on example. So we will come to the Visitor Design Pattern by exploring other available option. And then you will understand the importance of visitor despite the complexity.</li></ul><h3 id=intrusive-visitor>Intrusive Visitor<a hidden class=anchor aria-hidden=true href=#intrusive-visitor>#</a></h3><ul><li>Let&rsquo;s suppose that you have a hierarchy of documents as follows:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Markdown</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;* &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>HTML</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;&lt;li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_end</span> <span class=o>=</span> <span class=s>&#34;&lt;/li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><ul><li>And you need to define some new operation on existing infrastructure. For example, we have a <code>Document</code> class as above and now you want that different documents(i.e. <code>HTML</code> & <code>Markdown</code>) to be printable.</li><li>So you have this brand new concern of printing and you want to somehow propagate this through the entire hierarchy by making essentially every single class of your document to be independently printable somehow.</li><li>Now what you don&rsquo;t want to do is you don&rsquo;t want to go back into the existing code and modify each class(with new <a href=/posts/part-1-all-about-virtual-keyword-in-cpp-how-virtual-function-works-internally/>virtual function</a>) in the hierarchy every time you have a new concern, because, unfortunately, this breaks an <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a>, rather we should use inheritance.</li><li>There&rsquo;s also the <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a> that you have to adhere to because if you are introducing a brand new concern such as printing then that should be a separate class. But still, let say we will do it:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>print</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Markdown</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>m_content</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;* &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>HTML</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>m_content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>m_end</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;/ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;&lt;li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_end</span> <span class=o>=</span> <span class=s>&#34;&lt;/li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Document</span> <span class=o>*</span><span class=n>d</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HTML</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>add_to_list</span><span class=p>(</span><span class=s>&#34;This is line&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>print</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>As you can see for only 2-3 class it&rsquo;s good even if it is violating some SOLID principles. But imagine if you have 20 classes as part of this hierarchy. It would be really difficult to go into 20 different files & add a print method for every one of them.</li><li>Moreover, if there is more than one concern like save, process, etc., this approach becomes cumbersome. It would be much nicer to have each concern in a separate class that also goes towards the <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a>.</li></ul><h3 id=reflective-visitor>Reflective Visitor<a hidden class=anchor aria-hidden=true href=#reflective-visitor>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Markdown</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;* &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>HTML</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;&lt;li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_end</span> <span class=o>=</span> <span class=s>&#34;&lt;/li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DocumentPrinter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>void</span> <span class=nf>print</span><span class=p>(</span><span class=n>Document</span> <span class=o>*</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>auto</span> <span class=n>md</span> <span class=o>=</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>Markdown</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>md</span><span class=o>-&gt;</span><span class=n>m_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>md</span><span class=o>-&gt;</span><span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>auto</span> <span class=n>hd</span> <span class=o>=</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>HTML</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>hd</span><span class=o>-&gt;</span><span class=n>m_content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>hd</span><span class=o>-&gt;</span><span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>hd</span><span class=o>-&gt;</span><span class=n>m_end</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;/ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Document</span> <span class=o>*</span><span class=n>d</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HTML</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>add_to_list</span><span class=p>(</span><span class=s>&#34;This is line&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>DocumentPrinter</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>As mentioned above, we created a separate class having printing functionality for the entire hierarchy just to adhere <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a>. But in this approach, we have to identify types for a particular class(using <a href=/posts/cpp-type-casting-with-example-for-c-developers/><code>dynamic_cast&lt;>()</code></a>) as we have to work on individual <a href=/posts/memory-layout-of-cpp-object/>object</a> of hierarchy independently.</li><li>This is not an approach which scales efficiently, especially as you expand the set of classes that you&rsquo;re processing, you will end up having a long list of <code>if/else-if</code> along with paying performance cost on <a href=https://en.wikipedia.org/wiki/Run-time_type_information>RTTI</a>.</li></ul><h3 id=classic-visitor>Classic Visitor<a hidden class=anchor aria-hidden=true href=#classic-visitor>#</a></h3><ul><li>So far the approaches that have been sort of half measures what we really want is we really want a mechanism that will allow us to extend the entire hierarchies functionality in various different ways without being intrusive and certainly without having massive <code>if/else-if</code> statements full of <a href=/posts/cpp-type-casting-with-example-for-c-developers/><code>dynamic_cast&lt;>()</code></a> in them.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* --------------------------- Added Visitor Classes ----------------------------- */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DocumentVisitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=k>class</span> <span class=nc>Markdown</span><span class=o>*</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=k>class</span> <span class=nc>HTML</span><span class=o>*</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DocumentPrinter</span> <span class=o>:</span> <span class=n>DocumentVisitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=k>class</span> <span class=nc>Markdown</span><span class=o>*</span> <span class=n>md</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=k>class</span> <span class=nc>HTML</span><span class=o>*</span> <span class=n>hd</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=cm>/* -------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=n>DocumentVisitor</span><span class=o>*</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;--------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Markdown</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=n>DocumentVisitor</span><span class=o>*</span> <span class=n>dv</span><span class=p>)</span> <span class=p>{</span> <span class=n>dv</span><span class=o>-&gt;</span><span class=n>visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span> <span class=c1>// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;---------------
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;* &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>HTML</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>visit</span><span class=p>(</span><span class=n>DocumentVisitor</span><span class=o>*</span> <span class=n>dv</span><span class=p>)</span> <span class=p>{</span> <span class=n>dv</span><span class=o>-&gt;</span><span class=n>visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span> <span class=c1>// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;---------------
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;&lt;li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_end</span> <span class=o>=</span> <span class=s>&#34;&lt;/li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* -------------------------- Added Visitor Methods ------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>DocumentPrinter</span><span class=o>::</span><span class=n>visit</span><span class=p>(</span><span class=n>Markdown</span><span class=o>*</span> <span class=n>md</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>md</span><span class=o>-&gt;</span><span class=n>m_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>md</span><span class=o>-&gt;</span><span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>DocumentPrinter</span><span class=o>::</span><span class=n>visit</span><span class=p>(</span><span class=n>HTML</span><span class=o>*</span> <span class=n>hd</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>hd</span><span class=o>-&gt;</span><span class=n>m_content</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>hd</span><span class=o>-&gt;</span><span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>hd</span><span class=o>-&gt;</span><span class=n>m_end</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;/ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* -------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Document</span> <span class=o>*</span><span class=n>d</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HTML</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>add_to_list</span><span class=p>(</span><span class=s>&#34;This is line&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>visit</span><span class=p>(</span><span class=k>new</span> <span class=n>DocumentPrinter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>So as you can see we have added two-layer of indirection to achieve what we wanted without violating the <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a> & <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a>. Thanks to Double Dispatch in C++[TODO].</li><li>If you see all the classes involved in the process, it may seem a bit complicated. But call stack may help you to understand it easily.</li></ul><p><img loading=lazy src=/images/Double-Dispatch-in-C-Visitor-Design-Pattern-www_vishalhovatiy_com-1024x659.png alt></p><ul><li>From <code>d->visit(new DocumentPrinter)</code>, we call <code>visit()</code>method, which will dispatch to the appropriate overridden visit i.e. `HTML::visit(DocumentVisitor* dv).</li><li>From the overridden <code>HTML::visit(DocumentVisitor*)</code>, we call <code>dv->visit(this)</code>, which will again dispatch to the appropriate overridden method(considering the type of <code>this</code> pointer) i.e. <code>DocumentPrinter::visit(HTML*)</code>.</li></ul><h2 id=visitor-design-pattern-in-modern-c>Visitor Design Pattern in Modern C++<a hidden class=anchor aria-hidden=true href=#visitor-design-pattern-in-modern-c>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Markdown</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;* &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>HTML</span> <span class=o>:</span> <span class=n>Document</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>add_to_list</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>line</span><span class=p>)</span> <span class=p>{</span> <span class=n>m_content</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>line</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_start</span> <span class=o>=</span> <span class=s>&#34;&lt;li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span>          <span class=n>m_end</span> <span class=o>=</span> <span class=s>&#34;&lt;/li&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span>    <span class=n>m_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* ------------------------------------ Visitor ------------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DocumentPrinter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>operator</span><span class=p>()(</span><span class=n>Markdown</span> <span class=o>&amp;</span><span class=n>md</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>md</span><span class=p>.</span><span class=n>m_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>md</span><span class=p>.</span><span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>operator</span><span class=p>()(</span><span class=n>HTML</span> <span class=o>&amp;</span><span class=n>hd</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=nl>item</span> <span class=p>:</span> <span class=n>hd</span><span class=p>.</span><span class=n>m_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>hd</span><span class=p>.</span><span class=n>m_start</span> <span class=o>&lt;&lt;</span> <span class=n>item</span> <span class=o>&lt;&lt;</span> <span class=n>hd</span><span class=p>.</span><span class=n>m_end</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&lt;/ul&gt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=cm>/* ---------------------------------------------------------------------------------- */</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>document</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>Markdown</span><span class=p>,</span> <span class=n>HTML</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>HTML</span> <span class=n>hd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>hd</span><span class=p>.</span><span class=n>add_to_list</span><span class=p>(</span><span class=s>&#34;This is line&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>document</span> <span class=n>d</span> <span class=o>=</span> <span class=n>hd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DocumentPrinter</span> <span class=n>dp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>visit</span><span class=p>(</span><span class=n>dp</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>So for those of you who are not familiar with the <code>std::variant</code>, you can consider it as a union(a type-safe union). And line <code>std::variant&lt;Markdown, HTML></code>, suggest that you can use/assign/access either <code>Markdown</code> or <code>HTML</code> at a time.</li><li>And <a href=/posts/21-new-features-of-modern-cpp-to-use-in-your-project/>Modern C++</a> provides us <code>std::visit</code> which accept callable i.e. <code>DocumentPrinter</code> in our case having overloaded function operator and <code>std::variant</code> as the second argument. You also make use of <a href=/posts/learn-lambda-function-in-cpp-with-example/>lambda functions</a> rather using functor i.e. <code>DocumentPrinter</code>.</li></ul><h2 id=benefits-of-visitor-design-pattern>Benefits of Visitor Design Pattern<a hidden class=anchor aria-hidden=true href=#benefits-of-visitor-design-pattern>#</a></h2><ol><li>Adhering <a href=/posts/single-responsibility-principle-in-cpp-solid-as-a-rock/>Single Responsibility Principle</a> meaning separating type-specific logic in the separate entity/class. In our case, <code>DocumentPrinter</code> only handles the printing for different document types.</li><li>Adhering <a href=/posts/open-closed-principle-in-cpp-solid-as-a-rock/>Open-Closed Principle</a> meaning new functionality can be added without touching any class headers once we inserted <code>visit()</code> method for hierarchy, For example, if you want to add <code>scan()</code>method for each different Document, you can create <code>DocumentScanner</code> & rest of the edit goes as same <code>DocumentPrinter</code>.</li><li>This will be much useful when you already have done the unit-testing for your entire hierarchy. Now you do not want to touch that & wants to add new functionality.</li><li>Performance over <code>dynamic_cast</code>, <code>typeid()</code>and check for <code>enum</code>/<code>string</code> comparison.</li></ol><h2 id=summary-by-faqs>Summary by FAQs<a hidden class=anchor aria-hidden=true href=#summary-by-faqs>#</a></h2><p><strong>When should I use the Visitor Design Pattern?</strong></p><p>Visitor Design Pattern is quite useful when your requirement keeps changing which also affects multiple classes in the inheritance hierarchy.</p><p><strong>What is the typical use case of the Visitor Design Pattern?</strong></p><ul><li>In replacement of <code>dynamic_cast&lt;></code>, `typeid(), etc.</li><li>To process the collection of different types of objects.</li><li>Filtering different type of objects from collections.</li></ul><p><strong>Difference between Visitor vs Decorator Design Pattern?</strong></p><p><a href=/posts/decorator-design-pattern-in-modern-cpp/>Decorator</a>(Structural Design Pattern) works on an object by enhances existing functionality. While<br>Visitor(<a href=/posts/chain-of-responsibility-design-pattern-in-modern-cpp/>Behavioral Design Pattern</a>) works on a hierarchy of classes where you want to run different method based on concrete type but avoiding <a href=/posts/cpp-type-casting-with-example-for-c-developers/>dynamic_cast&lt;>()</a> or <a href=https://blog.toonormal.com/2014/01/25/c-typeof-vs-decltype/>typeof()</a> operators.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://vishalchovatiya.github.io/tags/classic-visitor/>Classic-Visitor</a></li><li><a href=https://vishalchovatiya.github.io/tags/difference-between-visitor-vs-decorator-design-pattern/>Difference-Between-Visitor-vs-Decorator-Design-Pattern</a></li><li><a href=https://vishalchovatiya.github.io/tags/double-dispatch-visitor-pattern-visitor-design-pattern-in-modern-c/>Double-Dispatch-Visitor-Pattern-Visitor-Design-Pattern-in-Modern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/intrusive-visitor/>Intrusive-Visitor</a></li><li><a href=https://vishalchovatiya.github.io/tags/reflective-visitor/>Reflective-Visitor</a></li><li><a href=https://vishalchovatiya.github.io/tags/use-case-of-the-visitor-design-pattern/>Use-Case-of-the-Visitor-Design-Pattern</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-c-example/>Visitor-Design-Pattern-C-Example</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-c-stack-overflow/>Visitor-Design-Pattern-C-Stack-Overflow</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-cpp/>Visitor-Design-Pattern-Cpp</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-example/>Visitor-Design-Pattern-Example</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-implementation-in-c/>Visitor-Design-Pattern-Implementation-in-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-in-c/>Visitor-Design-Pattern-in-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-pros-and-cons/>Visitor-Design-Pattern-Pros-and-Cons</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-design-pattern-using-stdvisit-stdvariant/>Visitor-Design-Pattern-Using-Stdvisit-Stdvariant</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-pattern-c/>Visitor-Pattern-C</a></li><li><a href=https://vishalchovatiya.github.io/tags/visitor-pattern-double-dispatch/>Visitor-Pattern-Double-Dispatch</a></li><li><a href=https://vishalchovatiya.github.io/tags/when-should-i-use-the-visitor-design-pattern/>When-Should-I-Use-the-Visitor-Design-Pattern</a></li></ul><nav class=paginav><a class=prev href=https://vishalchovatiya.github.io/posts/observer-design-pattern-in-modern-cpp/><span class=title>« Prev</span><br><span>Observer Design Pattern in Modern C++</span>
</a><a class=next href=https://vishalchovatiya.github.io/posts/state-design-pattern-in-modern-cpp/><span class=title>Next »</span><br><span>State Design Pattern in Modern C++</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on x" href="https://x.com/intent/tweet/?text=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f&amp;hashtags=classic-visitor%2cdifference-between-visitor-vs-decorator-design-pattern%2cdouble-dispatch-visitor-pattern-visitor-design-pattern-in-modern-c%2cintrusive-visitor%2creflective-visitor%2cuse-case-of-the-visitor-design-pattern%2cvisitor-design-pattern-c-example%2cvisitor-design-pattern-c-stack-overflow%2cvisitor-design-pattern-cpp%2cvisitor-design-pattern-example%2cvisitor-design-pattern-implementation-in-c%2cvisitor-design-pattern-in-c%2cvisitor-design-pattern-pros-and-cons%2cvisitor-design-pattern-using-stdvisit-stdvariant%2cvisitor-pattern-c%2cvisitor-pattern-double-dispatch%2cwhen-should-i-use-the-visitor-design-pattern"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f&amp;title=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;summary=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;source=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f&title=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on whatsapp" href="https://api.whatsapp.com/send?text=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b%20-%20https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on telegram" href="https://telegram.me/share/url?text=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b&amp;url=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Double Dispatch : Visitor Design Pattern in Modern C++ on ycombinator" href="https://news.ycombinator.com/submitlink?t=Double%20Dispatch%20%3a%20Visitor%20Design%20Pattern%20in%20Modern%20C%2b%2b&u=https%3a%2f%2fvishalchovatiya.github.io%2fposts%2fdouble-dispatch-visitor-design-pattern-in-modern-cpp%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://vishalchovatiya.github.io/>Vishal Chovatiya</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>